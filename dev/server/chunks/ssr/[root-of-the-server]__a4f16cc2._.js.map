{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///Users/vata/HydroX-exchange/frontend/src/lucid-lace.js"],"sourcesContent":["import { Lucid, Blockfrost } from '@lucid-evolution/lucid';\n\n// 초기화된 Lucid를 전역에 캐시\nlet _lucid = null;\nlet _lucidNetwork = null;\n\n/**\n * 현재 초기화된 Lucid 인스턴스 반환 (지갑 연결 후에만 유효)\n */\nexport function getLucid() {\n\treturn _lucid;\n}\n\n/**\n * 설정: 실제 프로젝트 키로 교체하세요.\n * Mainnet 키를 사용하면 Mainnet으로, Preview 키를 사용하면 Preview로 연결됩니다.\n */\nconst BLOCKFROST_KEYS = {\n\tMainnet: 'YOUR_MAINNET_BLOCKFROST_KEY', // <-- 여기에 Mainnet 키 넣기\n\tPreview: 'previewxYyB0Uj87BX2fEUwMVgsMuq8OYdvaOFe'\n};\nconst BLOCKFROST_ENDPOINTS = {\n\tMainnet: 'https://cardano-mainnet.blockfrost.io/api/v0',\n\tPreview: 'https://cardano-preview.blockfrost.io/api/v0'\n};\n\n/**\n * Lucid 초기화 (Preview 네트워크, 필요시 키/네트워크 교체)\n */\nexport async function initLucid(network = 'Preview') {\n\tif (_lucid && _lucidNetwork === network) return _lucid;\n\n\tconst key = BLOCKFROST_KEYS[network];\n\tif (!key || key.startsWith('YOUR_')) {\n\t\tthrow new Error(`Blockfrost key for ${network} is not configured in lucid-lace.js`);\n\t}\n\n\t_lucid = await Lucid(\n\t\tnew Blockfrost(BLOCKFROST_ENDPOINTS[network], key),\n\t\tnetwork\n\t);\n\t_lucidNetwork = network;\n\treturn _lucid;\n}\n\n/**\n * Lace에 연결하고 실제 네트워크를 감지하여 Lucid 초기화 후 주소 반환\n */\nexport async function connectLace() {\n\tif (!window.cardano?.lace) {\n\t\tthrow new Error('Lace 지갑이 설치되지 않았습니다.');\n\t}\n\n\tconst walletApi = await window.cardano.lace.enable();\n\n\t// 지갑의 네트워크 id 감지 (CIP-30 getNetworkId)\n\tlet networkId = null;\n\ttry {\n\t\tnetworkId = await walletApi.getNetworkId();\n\t} catch (e) {\n\t\t// 일부 환경에서는 지원되지 않을 수 있으므로 실패 시 Preview로 기본 처리\n\t\tnetworkId = null;\n\t}\n\n\tconst network = networkId === 1 ? 'Mainnet' : 'Preview';\n\n\tconst lucid = await initLucid(network);\n\tlucid.selectWallet.fromAPI(walletApi);\n\n\tconst address = await lucid.wallet().address();\n\treturn { address, network };\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;;;;;;AAEA,qBAAqB;AACrB,IAAI,SAAS;AACb,IAAI,gBAAgB;AAKb,SAAS;IACf,OAAO;AACR;AAEA;;;CAGC,GACD,MAAM,kBAAkB;IACvB,SAAS;IACT,SAAS;AACV;AACA,MAAM,uBAAuB;IAC5B,SAAS;IACT,SAAS;AACV;AAKO,eAAe,UAAU,UAAU,SAAS;IAClD,IAAI,UAAU,kBAAkB,SAAS,OAAO;IAEhD,MAAM,MAAM,eAAe,CAAC,QAAQ;IACpC,IAAI,CAAC,OAAO,IAAI,UAAU,CAAC,UAAU;QACpC,MAAM,IAAI,MAAM,CAAC,mBAAmB,EAAE,QAAQ,mCAAmC,CAAC;IACnF;IAEA,SAAS,MAAM,IAAA,mKAAK,EACnB,IAAI,wKAAU,CAAC,oBAAoB,CAAC,QAAQ,EAAE,MAC9C;IAED,gBAAgB;IAChB,OAAO;AACR;AAKO,eAAe;IACrB,IAAI,CAAC,OAAO,OAAO,EAAE,MAAM;QAC1B,MAAM,IAAI,MAAM;IACjB;IAEA,MAAM,YAAY,MAAM,OAAO,OAAO,CAAC,IAAI,CAAC,MAAM;IAElD,uCAAuC;IACvC,IAAI,YAAY;IAChB,IAAI;QACH,YAAY,MAAM,UAAU,YAAY;IACzC,EAAE,OAAO,GAAG;QACX,8CAA8C;QAC9C,YAAY;IACb;IAEA,MAAM,UAAU,cAAc,IAAI,YAAY;IAE9C,MAAM,QAAQ,MAAM,UAAU;IAC9B,MAAM,YAAY,CAAC,OAAO,CAAC;IAE3B,MAAM,UAAU,MAAM,MAAM,MAAM,GAAG,OAAO;IAC5C,OAAO;QAAE;QAAS;IAAQ;AAC3B"}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file:///Users/vata/HydroX-exchange/frontend/src/lib/api.ts"],"sourcesContent":["// API Gateway endpoint\r\nconst API_BASE = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8080';\r\nconst WS_BASE = process.env.NEXT_PUBLIC_WS_URL || 'ws://localhost:8080';\r\n\r\n// Types\r\nexport interface Ticker {\r\n  symbol: string;\r\n  last_price: number;\r\n  price_change: number;\r\n  price_change_percent: number;\r\n  high_24h: number;\r\n  low_24h: number;\r\n  volume_24h: number;\r\n  quote_volume_24h: number;\r\n  mark_price: number;\r\n}\r\n\r\nexport interface Kline {\r\n  time: number;\r\n  open: number;\r\n  high: number;\r\n  low: number;\r\n  close: number;\r\n  volume: number;\r\n}\r\n\r\nexport interface Trade {\r\n  price: number;\r\n  amount: number;\r\n  side: string;\r\n  time: number;\r\n}\r\n\r\nexport interface Position {\r\n  id: string;\r\n  user_id: string;\r\n  address: string;\r\n  symbol: string;\r\n  side: string;\r\n  amount: number;        // BTC size\r\n  entry_price: number;\r\n  collateral: number;    // USDM margin\r\n  leverage: number;\r\n  is_open: boolean;\r\n  created_at: string;\r\n  closed_at?: string;\r\n  close_price?: number;\r\n  realized_pnl?: number;\r\n  // On-chain UTxO reference\r\n  tx_hash?: string;\r\n  output_index?: number;\r\n}\r\n\r\nexport interface PositionWithPnL extends Position {\r\n  unrealized_pnl: number;\r\n  pnl_percent: number;\r\n  liquidation_price: number;\r\n  mark_price: number;\r\n}\r\n\r\nexport interface ClosePositionResponse {\r\n  status: string;\r\n  position_id: string;\r\n  close_price: number;\r\n  realized_pnl: number;\r\n  pnl_percent: number;\r\n}\r\n\r\nexport interface Order {\r\n  id: string;\r\n  user_id: string;\r\n  symbol: string;\r\n  side: string;\r\n  type: string;\r\n  price: number;\r\n  amount: number;\r\n  filled: number;\r\n  status: string;\r\n  time_in_force: string;\r\n  reduce_only: boolean;\r\n  created_at: string;\r\n}\r\n\r\nexport interface Balance {\r\n  asset: string;\r\n  available: number;\r\n  locked: number;\r\n  total: number;\r\n}\r\n\r\nexport interface Vault {\r\n  id: string;\r\n  name: string;\r\n  address: string;\r\n  tvl: number;\r\n  apy: number;\r\n  capacity: number;\r\n  min_deposit: number;\r\n  lock_period_days: number;\r\n  management_fee: number;\r\n  performance_fee: number;\r\n  status: string;\r\n  depositors: number;\r\n  daily_change: number;\r\n  weekly_change: number;\r\n  monthly_change: number;\r\n}\r\n\r\nexport interface VaultPerformance {\r\n  date: string;\r\n  value: number;\r\n}\r\n\r\nexport interface VaultTransaction {\r\n  id: string;\r\n  type: string;\r\n  amount: number;\r\n  address: string;\r\n  status: string;\r\n  created_at: string;\r\n}\r\n\r\nexport interface UserVaultInfo {\r\n  balance: number;\r\n  shares: number;\r\n}\r\n\r\nexport interface User {\r\n  id: string;\r\n  wallet_address: string;\r\n  created_at: string;\r\n}\r\n\r\n// Helper function for API calls\r\nasync function fetchAPI<T>(endpoint: string, options?: RequestInit): Promise<T> {\r\n  const url = `${API_BASE}${endpoint}`;\r\n  \r\n  const defaultHeaders: HeadersInit = {\r\n    'Content-Type': 'application/json',\r\n  };\r\n\r\n  // Add user ID if available\r\n  if (typeof window !== 'undefined') {\r\n    const userId = localStorage.getItem('hydrox_user_id');\r\n    if (userId) {\r\n      (defaultHeaders as Record<string, string>)['X-User-ID'] = userId;\r\n    }\r\n  }\r\n\r\n  const response = await fetch(url, {\r\n    ...options,\r\n    headers: {\r\n      ...defaultHeaders,\r\n      ...options?.headers,\r\n    },\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error(`API Error: ${response.status}`);\r\n  }\r\n\r\n  return response.json();\r\n}\r\n\r\n// Market API\r\nexport const marketApi = {\r\n  getAllMarkets: () => fetchAPI<Ticker[]>('/api/v1/markets'),\r\n  \r\n  getTicker: (symbol: string) => \r\n    fetchAPI<Ticker>(`/api/v1/markets/${symbol}/ticker`),\r\n  \r\n  getKlines: (symbol: string, interval: string = '1h') =>\r\n    fetchAPI<Kline[]>(`/api/v1/markets/${symbol}/klines?interval=${interval}`),\r\n  \r\n  getTrades: (symbol: string) =>\r\n    fetchAPI<Trade[]>(`/api/v1/markets/${symbol}/trades`),\r\n};\r\n\r\n// Trading API (now routed through Account service)\r\nexport const tradingApi = {\r\n  // Get positions (basic)\r\n  getPositions: (address: string) =>\r\n    fetchAPI<Position[]>(`/api/v1/account/positions/${address}`),\r\n\r\n  // Get positions with real-time PnL\r\n  getPositionsWithPnL: (address: string) =>\r\n    fetchAPI<PositionWithPnL[]>(`/api/v1/account/positions/${address}/with-pnl`),\r\n\r\n  // Create a new position\r\n  createPosition: (position: {\r\n    address: string;\r\n    symbol: string;\r\n    side: string;\r\n    entry_price: number;\r\n    amount: number;\r\n    collateral: number;\r\n    leverage: number;\r\n    tx_hash: string;      // On-chain UTxO reference\r\n    output_index: number;\r\n  }) =>\r\n    fetchAPI<{ status: string; position_id: string; position: Position }>(\r\n      '/api/v1/account/position',\r\n      {\r\n        method: 'POST',\r\n        body: JSON.stringify(position),\r\n      }\r\n    ),\r\n\r\n  // Close a position\r\n  closePosition: (positionId: string, address: string) =>\r\n    fetchAPI<ClosePositionResponse>(`/api/v1/account/position/${positionId}/close`, {\r\n      method: 'POST',\r\n      body: JSON.stringify({ address }),\r\n    }),\r\n\r\n  // Get position history (closed positions)\r\n  getPositionHistory: (address: string) =>\r\n    fetchAPI<Position[]>(`/api/v1/account/positions/${address}/history`),\r\n\r\n  getOrders: () => fetchAPI<Order[]>('/api/v1/orders'),\r\n\r\n  createOrder: (order: {\r\n    symbol: string;\r\n    side: string;\r\n    type: string;\r\n    price?: number;\r\n    amount: number;\r\n    leverage: number;\r\n    time_in_force: string;\r\n    reduce_only: boolean;\r\n  }) =>\r\n    fetchAPI<{ id: string; status: string }>('/api/v1/orders', {\r\n      method: 'POST',\r\n      body: JSON.stringify(order),\r\n    }),\r\n\r\n  cancelOrder: (orderId: string) =>\r\n    fetchAPI<{ status: string }>(`/api/v1/orders/${orderId}`, {\r\n      method: 'DELETE',\r\n    }),\r\n\r\n  getOrderHistory: () => fetchAPI<Order[]>('/api/v1/orders/history'),\r\n\r\n  getBalances: () => fetchAPI<Balance[]>('/api/v1/balances'),\r\n};\r\n\r\n// Vault API\r\nexport const vaultApi = {\r\n  getVaults: () => fetchAPI<Vault[]>('/api/v1/vaults'),\r\n  \r\n  getVault: (vaultId: string) => fetchAPI<Vault>(`/api/v1/vaults/${vaultId}`),\r\n  \r\n  getPerformance: (vaultId: string) =>\r\n    fetchAPI<VaultPerformance[]>(`/api/v1/vaults/${vaultId}/performance`),\r\n  \r\n  getTransactions: (vaultId: string) =>\r\n    fetchAPI<VaultTransaction[]>(`/api/v1/vaults/${vaultId}/transactions`),\r\n  \r\n  deposit: (vaultId: string, amount: number) =>\r\n    fetchAPI<{ status: string }>(`/api/v1/vaults/${vaultId}/deposit`, {\r\n      method: 'POST',\r\n      body: JSON.stringify({ amount }),\r\n    }),\r\n  \r\n  withdraw: (vaultId: string, amount: number) =>\r\n    fetchAPI<{ status: string }>(`/api/v1/vaults/${vaultId}/withdraw`, {\r\n      method: 'POST',\r\n      body: JSON.stringify({ amount }),\r\n    }),\r\n  \r\n  getUserInfo: (vaultId: string) =>\r\n    fetchAPI<UserVaultInfo>(`/api/v1/vaults/${vaultId}/user`),\r\n};\r\n\r\n// User API\r\nexport const userApi = {\r\n  connect: (walletAddress: string) =>\r\n    fetchAPI<{ user_id: string; wallet_address: string; status: string }>(\r\n      '/api/v1/auth/connect',\r\n      {\r\n        method: 'POST',\r\n        body: JSON.stringify({ wallet_address: walletAddress }),\r\n      }\r\n    ),\r\n\r\n  disconnect: () =>\r\n    fetchAPI<{ status: string }>('/api/v1/auth/disconnect', {\r\n      method: 'POST',\r\n    }),\r\n\r\n  getProfile: () => fetchAPI<User>('/api/v1/users/profile'),\r\n\r\n  getBalances: () => fetchAPI<Balance[]>('/api/v1/users/balances'),\r\n};\r\n\r\n// Account API - On-chain balance queries\r\nexport const accountApi = {\r\n  // Get all balances for a wallet address (USDM, ADA, etc.)\r\n  getBalances: (address: string) =>\r\n    fetchAPI<Balance[]>(`/api/v1/account/balances/${address}`),\r\n\r\n  // Get USDM balance specifically\r\n  getUSDMBalance: async (address: string): Promise<number> => {\r\n    try {\r\n      const balances = await fetchAPI<Balance[]>(`/api/v1/account/balances/${address}`);\r\n      const usdm = balances.find(b => b.asset === 'USDM');\r\n      return usdm?.available ?? 0;\r\n    } catch (error) {\r\n      console.error('Failed to fetch USDM balance:', error);\r\n      return 0;\r\n    }\r\n  },\r\n};\r\n\r\n// Vault Script Info - On-chain vault balance queries\r\nexport interface VaultScriptInfo {\r\n  script_address: string;\r\n  total_usdm: number;\r\n  total_ada: number;\r\n}\r\n\r\nexport const vaultScriptApi = {\r\n  // Get USDM and ADA balance at the vault script address\r\n  getVaultInfo: () => fetchAPI<VaultScriptInfo>('/api/v1/vault/info'),\r\n};\r\n\r\n// Contract Config API\r\nexport interface ContractConfig {\r\n  network: string;\r\n  position_script_addr: string;\r\n  vault_script_addr: string;\r\n  usdm_policy_id: string;\r\n  usdm_asset_name: string;\r\n  position_script_hash?: string;\r\n  vault_script_hash?: string;\r\n}\r\n\r\nlet cachedConfig: ContractConfig | null = null;\r\n\r\nexport const configApi = {\r\n  getContractConfig: async (): Promise<ContractConfig> => {\r\n    if (cachedConfig) return cachedConfig;\r\n    cachedConfig = await fetchAPI<ContractConfig>('/api/v1/config/contracts');\r\n    console.log(\"Loaded contract config from API:\", cachedConfig);\r\n    return cachedConfig;\r\n  },\r\n  // Clear cache to force reload (useful after backend restart)\r\n  clearCache: () => {\r\n    cachedConfig = null;\r\n  },\r\n};\r\n\r\n// Oracle API - Signed price feeds for on-chain verification\r\nexport interface OraclePriceFeed {\r\n  symbol: string;      // Asset symbol (e.g., \"BTC\")\r\n  price: number;       // Price scaled by 1e6 (e.g., $97000 = 97000000000)\r\n  timestamp: number;   // POSIX seconds\r\n  signature: string;   // Ed25519 signature in hex\r\n}\r\n\r\nexport interface SignedPriceResponse {\r\n  success: boolean;\r\n  data?: OraclePriceFeed;\r\n  error?: string;\r\n}\r\n\r\nexport interface OraclePublicKeyResponse {\r\n  public_key: string;  // Hex-encoded Ed25519 public key\r\n}\r\n\r\n// Options for oracle price request (for detailed logging)\r\nexport interface OraclePriceOptions {\r\n  address?: string;      // Wallet address requesting the price\r\n  action?: 'close' | 'liquidate';  // Action type\r\n  side?: 'Long' | 'Short';         // Position side\r\n  positionId?: string;   // Position ID being closed\r\n}\r\n\r\nexport const oracleApi = {\r\n  // Get the oracle's Ed25519 public key (for vault datum)\r\n  getPublicKey: () =>\r\n    fetchAPI<OraclePublicKeyResponse>('/api/v1/oracle/pubkey'),\r\n\r\n  // Get a signed price feed for a symbol (for close position TX)\r\n  // Options param adds logging context on the oracle service\r\n  getSignedPrice: async (symbol: string, options?: OraclePriceOptions): Promise<OraclePriceFeed> => {\r\n    // Build query params for logging on oracle service\r\n    const params = new URLSearchParams();\r\n    if (options?.address) params.set('address', options.address);\r\n    if (options?.action) params.set('action', options.action);\r\n    if (options?.side) params.set('side', options.side);\r\n    if (options?.positionId) params.set('position_id', options.positionId);\r\n\r\n    const queryString = params.toString();\r\n    const url = `/api/v1/oracle/price/${symbol}${queryString ? '?' + queryString : ''}`;\r\n\r\n    const response = await fetchAPI<SignedPriceResponse>(url);\r\n    if (!response.success || !response.data) {\r\n      throw new Error(response.error || 'Failed to get signed price');\r\n    }\r\n    return response.data;\r\n  },\r\n};\r\n\r\n// WebSocket connection manager\r\nexport class WSClient {\r\n  private ws: WebSocket | null = null;\r\n  private reconnectAttempts = 0;\r\n  private maxReconnectAttempts = 5;\r\n  private listeners: Map<string, Set<(data: unknown) => void>> = new Map();\r\n  private subscriptions: Set<string> = new Set();\r\n\r\n  connect() {\r\n    if (this.ws?.readyState === WebSocket.OPEN) return;\r\n\r\n    this.ws = new WebSocket(`${WS_BASE}/ws`);\r\n\r\n    this.ws.onopen = () => {\r\n      console.log('[WS] Connected');\r\n      this.reconnectAttempts = 0;\r\n      // Resubscribe to all channels\r\n      this.subscriptions.forEach(channel => {\r\n        this.send({ method: 'SUBSCRIBE', params: [channel] });\r\n      });\r\n    };\r\n\r\n    this.ws.onmessage = (event) => {\r\n      try {\r\n        const message = JSON.parse(event.data);\r\n        const channel = message.channel || message.type;\r\n        \r\n        if (channel && this.listeners.has(channel)) {\r\n          this.listeners.get(channel)?.forEach(callback => {\r\n            callback(message.data || message);\r\n          });\r\n        }\r\n      } catch (e) {\r\n        console.error('[WS] Parse error:', e);\r\n      }\r\n    };\r\n\r\n    this.ws.onclose = () => {\r\n      console.log('[WS] Disconnected');\r\n      if (this.reconnectAttempts < this.maxReconnectAttempts) {\r\n        this.reconnectAttempts++;\r\n        setTimeout(() => this.connect(), 1000 * this.reconnectAttempts);\r\n      }\r\n    };\r\n\r\n    this.ws.onerror = (error) => {\r\n      console.error('[WS] Error:', error);\r\n    };\r\n  }\r\n\r\n  disconnect() {\r\n    this.ws?.close();\r\n    this.ws = null;\r\n    this.subscriptions.clear();\r\n  }\r\n\r\n  private send(data: unknown) {\r\n    if (this.ws?.readyState === WebSocket.OPEN) {\r\n      this.ws.send(JSON.stringify(data));\r\n    }\r\n  }\r\n\r\n  subscribe(channel: string, callback: (data: unknown) => void) {\r\n    if (!this.listeners.has(channel)) {\r\n      this.listeners.set(channel, new Set());\r\n    }\r\n    this.listeners.get(channel)?.add(callback);\r\n    \r\n    if (!this.subscriptions.has(channel)) {\r\n      this.subscriptions.add(channel);\r\n      this.send({ method: 'SUBSCRIBE', params: [channel] });\r\n    }\r\n\r\n    // Return unsubscribe function\r\n    return () => {\r\n      this.listeners.get(channel)?.delete(callback);\r\n      if (this.listeners.get(channel)?.size === 0) {\r\n        this.listeners.delete(channel);\r\n        this.subscriptions.delete(channel);\r\n        this.send({ method: 'UNSUBSCRIBE', params: [channel] });\r\n      }\r\n    };\r\n  }\r\n}\r\n\r\n// Singleton WebSocket client\r\nlet wsClient: WSClient | null = null;\r\n\r\nexport function getWSClient(): WSClient {\r\n  if (!wsClient) {\r\n    wsClient = new WSClient();\r\n  }\r\n  return wsClient;\r\n}\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 375, "column": 0}, "map": {"version":3,"sources":["file:///Users/vata/HydroX-exchange/frontend/src/contexts/WalletContext.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { createContext, useContext, useState, useEffect, useCallback, ReactNode } from \"react\";\r\nimport { connectLace, getLucid } from \"@/lucid-lace\";\r\nimport {\r\n  Data,\r\n  fromText,\r\n  Constr,\r\n  getAddressDetails,\r\n  validatorToScriptHash,\r\n  type SpendingValidator,\r\n  type UTxO,\r\n  type Data as DataType\r\n} from \"@lucid-evolution/lucid\";\r\nimport { configApi, tradingApi, oracleApi } from \"@/lib/api\";\r\n\r\n// Vault compiled code from plutus.json (PlutusV3) - Updated 2024-12-30 with final PnL fix (size*price_diff/(entry_price*100))\r\nconst VAULT_COMPILED_CODE = \"590c2401010029800aba2aba1aba0aab9faab9eaab9dab9a488888896600264653001300800198041804800cdc3a400530080024888966002600460106ea800e3300130093754007370e90024dc3a40013008375400891111991192cc004c01401226464b30013016002801c590131bad301400130103754017159800980480244c8c966002602c0050038b2026375a602800260206ea802e2b30013006004899192cc004c05800a00716404c6eb4c050004c040dd5005c56600266e1d2006004899194c004c966002602600315980099b8948010c0480062d1300c301200140451640506ea8c054006602c003375a602a0049112cc004c06400a264b3001300b3015375400313232323298009bae301d0019bae301d0049bad301d0039bad301d0024888966002604400b00f8b203e180e800980e000980d800980b1baa0018b202830180028b202c180a80098081baa00b8b201c4038807100e0acc004c010c038dd5000c660026024601e6ea80066e952000912cc004c018c040dd500144c8c8c8c8ca60026eb8c0640066eb8c0640166eb4c0640126eb4c06400e6eb8c0640092222259800980f803402e2c80e060320026030002602e002602c00260226ea800a2c807a460266028602860286028003230133014301400191809980a180a180a000c8c04cc050006601c6ea80292222222232332259800980780244c96600266e24dd69804180d9baa00c0018992cc004c044c06cdd5000c4c8c8c9660026028603c6ea8006264b30013371266e00c01cdd5980598101baa300b3020375400800c600e6eacc02cc080dd5000c4c966002602e60406ea8006264660220022b3001337106eb4c034c088dd50099bad300d3022375400315980099b8f375c601c60446ea8004dd7180718111baa0138acc004cdc79bae3010302237540026eb8c040c088dd5009c528c59020459020459020181218109baa0018b203e300d302037540031640786044603e6ea80062c80e8cc01cdd61805980f1baa01623375e6044603e6ea8004008c080c074dd51804180e9baa001301f301c3754003164068660066eb0c078c06cdd50098074590191bad301d301a375402b159800980980244c96600266e2120000018acc004cdc48009bad3006301b3754019132598009808980d9baa00189919912cc004cdc38029bad300a301f3754021159800980a191980080099198008009bac300e3021375403244b30010018a5eb8226644b30013375e604e60486ea800801e26604c004660080080031330040040014088604a002604c00281188966002003148002266e012002330020023025001408914a316407513259800980a980f9baa001899192cc004c060c084dd5000c4c8cc04800456600266e1cdd6980718119baa001337026eb4c038c08cdd500a004c56600266e24cdc080298051bab300e3023375400666e0ccdc10048029bad300e3023375402915980099b8f375c601e60466ea8004dd7180798119baa0148acc004cdc79bae3011302337540026eb8c044c08cdd500a4528c59021459021459021459021181298111baa0018b2040300e30213754002604660406ea80062c80f0cc020dd61806180f9baa01723375e604660406ea800400d01d1810180e9baa3008301d375400260086eacc020c074dd51804180e9baa001301f301c3754003164068660066eb0c078c06cdd50098074590194590191bad301d301a375402b159800980800244c9660026466446600400400244b30010018a508acc004cdc79bae30210010038a518998010011811000a038407c6eb0c07cc080c080c080c080c080c080c080c080c070dd500a1bae301e301b3754019132598009808980d9baa00189919192cc004c050c078dd5000c4c8c966002602e60406ea8006264660220022b30013371e6eb8c094c088dd50009bae30253022375402715980099b87375a601a60446ea8004dd6980698111baa0138acc004cdc39bad300f3022375400201115980099b8f375c601c60446ea8004dd7180718111baa0138acc004cdc79bae3010302237540026eb8c040c088dd5009c56600266e1cc024dd5980698111baa00330093756601a60446ea8c034c088dd50034528c59020459020459020459020459020459020181218109baa0018b203e300d302037540026044603e6ea80062c80e8cc01cdd61805980f1baa01623375e6044603e6ea8004008c080c074dd51804180e9baa001301f301c3754003164068660066eb0c078c06cdd50098074590191bad301d301a375402b132329800980a980d9baa301f001980f9810000cdd6980f8012444b3001325980099b89480000062b3001337120029044074660026eb8c030c080dd5008ccdc51bae30233020375400666e2a600294690084dd6980598101baa0035e4a600294690084dd6980698101baa0035e4a6eb8c030c080dd5001ae5516407916407866e04cdc1992cc004c064c07cdd5000c4dd6981198101baa0018a400080f0c088c07cdd51811180f9baa30223023302330233023302330233023301f375402e9068079bad300c301f375400513259800980a980f9baa001899192cc004c060c084dd5000c4c966002603060446ea8006264646464646464653001375c605c003375c605c011375a605c00f375a605c00d375a605c00b32598009816000c56600266e252004302b0018b44c094c0ac00502a45902d1baa302e0049bad302e0039bad302e00248888888966002606e013132325980099b87017375a6070005159800acc004066200319800800d28528a06640cd132598009815981a9baa00189919192cc004c0b8c0e0dd5000c4c8c966002606260746ea8006264660560022b30013371e6eb8c0fcc0f0dd50009bae303f303c375405b15980099b87375a604e60786ea8004dd69813981e1baa02d8acc004cdc39bad3029303c37540026eb4c0a4c0f0dd5016c56600266e3cdd71814181e1baa001375c605060786ea80b62b30013371e6eb8c0a8c0f0dd50009bae302a303c375405b1980098119bab3027303c3754604e60786ea801a60466eacc09cc0f0dd5001cc08cdd59813981e1baa3027303c37540389112cc00408e2b30013370e00466e0400c08629462c81ea2b30013371266e0000d6600266e200040862003102140f400514a31640f481e91640e91640e91640e91640e91640e8607c60766ea80062c81c8c09cc0e8dd5000981e181c9baa0018b206e330213758604a60706ea80c08cdd7981e181c9baa001002303a303737546044606e6ea8004c0e4c0d8dd5000c590341980e9bac30383035375405a0511640cd1640cc605a60666ea8c0dcc0e0004c8c96600266e25200000189981b9ba8001330379800a51a60103d87a8000a60103d879800040cc97ae089981b9ba83370290000009981bcc005285300103d87a8000a60103d879800040cc97ae040cc66e0ccdc11bad302030343754024b3001302d30333754604460686ea804a266e04004dd69810981a1baa012899b81375a604260686ea804800503219b82375a604260686ea804920c801375a603c60666ea805a2c81a0605c002605a0026058002605600260540026052002605000260466ea80062c8108c094c088dd5000c59020180718109baa300c30213754002604660406ea80062c80f0cc88cc0280088c966002603860446ea8006266e3cdd7181318119baa0010038a504084604a60446ea8c094c088dd5180698111baa00137586044603e6ea805cdd71806980f9baa0108b203a180f800980d1baa015406080c10181119801801119baf301e301b3754002004464b300130133019375400314800226eb4c074c068dd5000a03032598009809980c9baa0018a6103d87a8000899198008009bab301e301b375400444b30010018a6103d87a8000899192cc004cdc8a45045553444d000018acc004cdc7a441045553444d000018980719810180f00125eb82298103d87a80004071133004004302200340706eb8c070004c07c00501d203032330010010022259800800c5300103d87a8000899192cc004cdc8a451c2a76795ed9cb3fbea561af69342b5fcaa988871ca2c425ecd5593fd1000018acc004cdc7a4411c2a76795ed9cb3fbea561af69342b5fcaa988871ca2c425ecd5593fd100001898069980f980e80125eb82298103d87a8000406d1330040043021003406c6eb8c06c004c07800501c111919800800801912cc0040062980103d87a80008992cc004c010006260186603c00297ae089980180198100012034301e00140708b201a3010004301030110044590070c020004c00cdd5004452689b2b200201\";\r\n\r\n// Helper function to get vault compiled code\r\nasync function getVaultCompiledCode(): Promise<string> {\r\n  return VAULT_COMPILED_CODE;\r\n}\r\n\r\n// Position datum schema for Lucid-Evolution\r\nconst PositionDatumSchema = Data.Object({\r\n  owner: Data.Bytes(),\r\n  symbol: Data.Bytes(),\r\n  side: Data.Integer(),\r\n  entry_price: Data.Integer(),\r\n  amount: Data.Integer(),\r\n  collateral: Data.Integer(),\r\n  leverage: Data.Integer(),\r\n  open_time: Data.Integer(),\r\n});\r\ntype PositionDatum = Data.Static<typeof PositionDatumSchema>;\r\n\r\nexport interface OpenPositionParams {\r\n  symbol: string;\r\n  side: \"Long\" | \"Short\";\r\n  entryPrice: number;\r\n  amount: number;       // BTC amount\r\n  collateral: number;   // USDM amount\r\n  leverage: number;\r\n}\r\n\r\nexport interface ClosePositionParams {\r\n  positionId: string;\r\n  symbol: string;       // e.g., \"BTC\" for oracle price lookup\r\n  side?: 'Long' | 'Short';  // Position side (for logging)\r\n  // UTxO reference for exact matching\r\n  txHash: string;       // Transaction hash where position was created\r\n  outputIndex: number;  // Output index in that transaction\r\n}\r\n\r\nexport interface ClosePositionResult {\r\n  txHash: string;\r\n  closePrice: number;\r\n  realizedPnl: number;\r\n  pnlPercent: number;\r\n}\r\n\r\nexport interface VaultDepositResult {\r\n  txHash: string;\r\n  amount: number;\r\n  shares: number;\r\n}\r\n\r\nexport interface VaultWithdrawResult {\r\n  txHash: string;\r\n  amount: number;\r\n  sharesBurned: number;\r\n}\r\n\r\ninterface WalletContextType {\r\n  walletAddress: string | null;\r\n  network: string | null;\r\n  isConnecting: boolean;\r\n  isLaceAvailable: boolean;\r\n  connectWallet: () => Promise<void>;\r\n  disconnectWallet: () => void;\r\n  openPosition: (params: OpenPositionParams) => Promise<string>;\r\n  closePosition: (params: ClosePositionParams) => Promise<ClosePositionResult>;\r\n  depositToVault: (amount: number) => Promise<VaultDepositResult>;\r\n  withdrawFromVault: (shares: number) => Promise<VaultWithdrawResult>;\r\n}\r\n\r\nconst WalletContext = createContext<WalletContextType | undefined>(undefined);\r\n\r\nexport function WalletProvider({ children }: { children: ReactNode }) {\r\n  const [walletAddress, setWalletAddress] = useState<string | null>(null);\r\n  const [network, setNetwork] = useState<string | null>(null);\r\n  const [isConnecting, setIsConnecting] = useState(false);\r\n  const [isLaceAvailable, setIsLaceAvailable] = useState(false);\r\n\r\n  // Check if Lace wallet is installed and auto-reconnect if previously connected\r\n  useEffect(() => {\r\n    const checkWalletAvailability = async () => {\r\n      if (typeof window !== \"undefined\" && window.cardano?.lace) {\r\n        setIsLaceAvailable(true);\r\n\r\n        // Check if we should auto-reconnect\r\n        const wasConnected = localStorage.getItem(\"hydrox_wallet_connected\");\r\n        if (wasConnected === \"true\" && !walletAddress && !isConnecting) {\r\n          console.log(\"Auto-reconnecting wallet...\");\r\n          try {\r\n            const result = await connectLace();\r\n            setWalletAddress(result.address);\r\n            setNetwork(result.network);\r\n            console.log(\"Auto-reconnected:\", result.address);\r\n          } catch (err) {\r\n            console.error(\"Auto-reconnect failed:\", err);\r\n            // Clear the flag if auto-reconnect fails\r\n            localStorage.removeItem(\"hydrox_wallet_connected\");\r\n          }\r\n        }\r\n        return true;\r\n      }\r\n      return false;\r\n    };\r\n\r\n    // Check immediately\r\n    checkWalletAvailability();\r\n\r\n    // Lace may take time to inject, check multiple times with increasing delays\r\n    const delays = [100, 300, 500, 1000, 2000, 3000];\r\n    const timeoutIds: ReturnType<typeof setTimeout>[] = [];\r\n\r\n    delays.forEach((delay) => {\r\n      timeoutIds.push(setTimeout(() => {\r\n        checkWalletAvailability();\r\n      }, delay));\r\n    });\r\n\r\n    // Also set up an interval as fallback (but stop after wallet is found)\r\n    const intervalId = setInterval(() => {\r\n      if (isLaceAvailable) {\r\n        clearInterval(intervalId);\r\n        return;\r\n      }\r\n      checkWalletAvailability();\r\n    }, 2000);\r\n\r\n    return () => {\r\n      timeoutIds.forEach(clearTimeout);\r\n      clearInterval(intervalId);\r\n    };\r\n  }, [walletAddress, isConnecting, isLaceAvailable]);\r\n\r\n  const connectWallet = useCallback(async () => {\r\n    if (!isLaceAvailable) {\r\n      throw new Error(\"Lace wallet is not installed. Please install Lace wallet extension.\");\r\n    }\r\n\r\n    setIsConnecting(true);\r\n\r\n    try {\r\n      // Use Lucid to connect and get bech32 address\r\n      const result = await connectLace();\r\n      setWalletAddress(result.address);\r\n      setNetwork(result.network);\r\n      // Save connection state to localStorage for auto-reconnect on page refresh\r\n      localStorage.setItem(\"hydrox_wallet_connected\", \"true\");\r\n    } catch (error: unknown) {\r\n      console.error(\"Error connecting wallet:\", error);\r\n      const err = error as { code?: number; message?: string };\r\n      if (err.code === 4001 || err.message?.includes(\"reject\")) {\r\n        throw new Error(\"Wallet connection was rejected.\");\r\n      } else if (err.message?.includes(\"timeout\")) {\r\n        throw new Error(\"Connection timeout. Please try again.\");\r\n      } else if (err.message?.includes(\"Blockfrost\")) {\r\n        throw new Error(\"Blockfrost configuration error. Please check settings.\");\r\n      } else {\r\n        throw new Error(err.message || \"Failed to connect wallet\");\r\n      }\r\n    } finally {\r\n      setIsConnecting(false);\r\n    }\r\n  }, [isLaceAvailable]);\r\n\r\n  const disconnectWallet = useCallback(() => {\r\n    setWalletAddress(null);\r\n    setNetwork(null);\r\n    // Clear auto-reconnect flag\r\n    localStorage.removeItem(\"hydrox_wallet_connected\");\r\n  }, []);\r\n\r\n  // Open position using Lucid to build TX\r\n  const openPosition = useCallback(async (params: OpenPositionParams): Promise<string> => {\r\n    const lucid = getLucid();\r\n    if (!lucid || !walletAddress) {\r\n      throw new Error(\"Wallet not connected. Please connect your wallet first.\");\r\n    }\r\n\r\n    try {\r\n      // Get contract config from backend\r\n      const config = await configApi.getContractConfig();\r\n      console.log(\"Contract config:\", config);\r\n\r\n      // Get payment key hash from wallet address\r\n      const addressDetails = getAddressDetails(walletAddress);\r\n      const ownerPkh = addressDetails.paymentCredential?.hash;\r\n      if (!ownerPkh) {\r\n        throw new Error(\"Could not extract payment key hash from address\");\r\n      }\r\n\r\n      // Get vault script hash for datum\r\n      // Extract hash from vault script address (addr_test1wq... -> script hash)\r\n      const vaultAddrDetails = getAddressDetails(config.vault_script_addr);\r\n      const vaultScriptHash = vaultAddrDetails.paymentCredential?.hash || \"\";\r\n\r\n      // Create position datum matching on-chain PositionDatum:\r\n      // [trader, collateral, entry_price, size, is_long(Bool), leverage, timestamp, vault_script_hash]\r\n      // is_long: Bool = Constr(1,[]) for True (Long), Constr(0,[]) for False (Short)\r\n      const isLongBool = params.side === \"Long\" ? new Constr(1, []) : new Constr(0, []);\r\n\r\n      const datumConstr = new Constr(0, [\r\n        ownerPkh,                                                    // trader: VerificationKeyHash\r\n        BigInt(Math.round(params.collateral)),                       // collateral: Int (USDM, no decimals)\r\n        BigInt(Math.round(params.entryPrice * 1_000_000)),           // entry_price: Int (scaled 1e6)\r\n        BigInt(Math.round(params.amount * 100_000_000)),             // size: Int (scaled 1e8 for BTC)\r\n        isLongBool,                                                   // is_long: Bool\r\n        BigInt(params.leverage),                                      // leverage: Int\r\n        BigInt(Math.floor(Date.now() / 1000)),                       // timestamp: Int (POSIX seconds)\r\n        vaultScriptHash,                                              // vault_script_hash: ByteArray\r\n      ]);\r\n\r\n      console.log(\"Position datum fields:\", {\r\n        trader: ownerPkh,\r\n        collateral: params.collateral,\r\n        entry_price: params.entryPrice * 1_000_000,\r\n        size: params.amount * 100_000_000,\r\n        is_long: params.side === \"Long\",\r\n        leverage: params.leverage,\r\n        timestamp: Math.floor(Date.now() / 1000),\r\n        vault_script_hash: vaultScriptHash,\r\n      });\r\n\r\n      console.log(\"Building TX with datum\");\r\n\r\n      // USDM asset unit = policy_id + asset_name\r\n      const usdmUnit = config.usdm_policy_id + config.usdm_asset_name;\r\n\r\n      // Collateral amount in USDM (no decimals - USDM is stored as whole units)\r\n      const collateralAmount = BigInt(Math.round(params.collateral));\r\n\r\n      console.log(\"USDM unit:\", usdmUnit);\r\n      console.log(\"Collateral amount:\", collateralAmount.toString());\r\n\r\n      // Build the transaction with USDM collateral\r\n      // lucid-evolution uses pay.ToContract\r\n      const tx = await lucid\r\n        .newTx()\r\n        .pay.ToContract(\r\n          config.position_script_addr,\r\n          { kind: \"inline\", value: Data.to(datumConstr) },\r\n          {\r\n            lovelace: BigInt(1_500_000), // ~1.5 ADA - minimum for UTxO with datum + token\r\n            [usdmUnit]: collateralAmount  // USDM collateral\r\n          }\r\n        )\r\n        .complete();\r\n\r\n      console.log(\"TX built, signing...\");\r\n\r\n      // Sign and submit with lucid-evolution\r\n      const signedTx = await tx.sign.withWallet().complete();\r\n      const txHash = await signedTx.submit();\r\n\r\n      console.log(\"Transaction submitted:\", txHash);\r\n\r\n      // The position UTxO is the first output (index 0) of this transaction\r\n      const outputIndex = 0;\r\n      console.log(\"Position UTxO reference:\", txHash, \"#\", outputIndex);\r\n\r\n      // Save position to DB after successful on-chain submission\r\n      // Include tx_hash and output_index for later UTxO matching\r\n      try {\r\n        await tradingApi.createPosition({\r\n          address: walletAddress,\r\n          symbol: params.symbol,\r\n          side: params.side,\r\n          entry_price: params.entryPrice,\r\n          amount: params.amount,\r\n          collateral: params.collateral,\r\n          leverage: params.leverage,\r\n          tx_hash: txHash,\r\n          output_index: outputIndex,\r\n        });\r\n        console.log(\"Position saved to DB with UTxO reference\");\r\n      } catch (dbError) {\r\n        console.error(\"Failed to save position to DB:\", dbError);\r\n        // Don't throw - TX already succeeded on-chain\r\n      }\r\n\r\n      return txHash;\r\n    } catch (error) {\r\n      console.error(\"Error opening position:\", error);\r\n      throw error;\r\n    }\r\n  }, [walletAddress]);\r\n\r\n  // Close position with oracle-signed price - full on-chain transaction\r\n  const closePosition = useCallback(async (params: ClosePositionParams): Promise<ClosePositionResult> => {\r\n    const lucid = getLucid();\r\n    if (!lucid || !walletAddress) {\r\n      throw new Error(\"Wallet not connected. Please connect your wallet first.\");\r\n    }\r\n\r\n    try {\r\n      // 1. Get contract config\r\n      const config = await configApi.getContractConfig();\r\n      console.log(\"Contract config:\", config);\r\n\r\n      // 2. Get signed oracle price for the symbol (with logging context)\r\n      console.log(`Fetching signed oracle price for ${params.symbol}...`);\r\n      const oracleFeed = await oracleApi.getSignedPrice(params.symbol, {\r\n        address: walletAddress,\r\n        action: 'close',\r\n        side: params.side,\r\n        positionId: params.positionId,\r\n      });\r\n      console.log(\"Oracle price feed:\", oracleFeed);\r\n\r\n      // 3. Find the position UTxO at the script address\r\n      const positionUtxos = await lucid.utxosAt(config.position_script_addr);\r\n      console.log(`Found ${positionUtxos.length} UTxOs at position script`);\r\n\r\n      // Get trader's payment key hash\r\n      const addressDetails = getAddressDetails(walletAddress);\r\n      const traderPkh = addressDetails.paymentCredential?.hash;\r\n      if (!traderPkh) {\r\n        throw new Error(\"Could not extract payment key hash from address\");\r\n      }\r\n\r\n      // Find the specific position UTxO by txHash#outputIndex\r\n      // NEW datum format: [trader, collateral, entry_price, size, is_long(Bool), leverage, timestamp, vault_script_hash]\r\n      let positionUtxo: UTxO | null = null;\r\n      let positionDatumData: unknown[] | null = null;\r\n\r\n      console.log(\"Looking for UTxO:\", params.txHash, \"#\", params.outputIndex);\r\n      console.log(\"Looking for trader PKH:\", traderPkh);\r\n\r\n      for (const utxo of positionUtxos) {\r\n        // Match by txHash and outputIndex\r\n        if (utxo.txHash !== params.txHash || utxo.outputIndex !== params.outputIndex) {\r\n          continue;\r\n        }\r\n\r\n        console.log(\"Found target UTxO:\", utxo.txHash, utxo.outputIndex);\r\n\r\n        if (!utxo.datum) {\r\n          throw new Error(\"Position UTxO found but has no datum\");\r\n        }\r\n\r\n        try {\r\n          const datum = Data.from(utxo.datum);\r\n          const datumFields = (datum as { fields: unknown[] }).fields;\r\n\r\n          // Verify this position belongs to the trader\r\n          if (datumFields[0] !== traderPkh) {\r\n            throw new Error(\"Position does not belong to this wallet\");\r\n          }\r\n\r\n          // Verify vault_script_hash matches\r\n          const positionVaultHash = datumFields?.[7] as string;\r\n          if (positionVaultHash !== config.vault_script_hash) {\r\n            throw new Error(\"Position belongs to a different vault\");\r\n          }\r\n\r\n          positionUtxo = utxo;\r\n          positionDatumData = datumFields;\r\n          console.log(\"Parsed datum:\", JSON.stringify(datum, (_, v) => typeof v === 'bigint' ? v.toString() : v));\r\n          break;\r\n        } catch (parseErr) {\r\n          console.log(\"Failed to parse datum:\", parseErr);\r\n          throw parseErr;\r\n        }\r\n      }\r\n\r\n      if (!positionUtxo || !positionDatumData) {\r\n        throw new Error(\"Position UTxO not found on-chain. It may have already been closed.\");\r\n      }\r\n\r\n      // 4. Extract position data from datum for PnL calculation\r\n      // On-chain PositionDatum fields: [trader, collateral, entry_price, size, is_long(Bool), leverage, timestamp, vault_script_hash]\r\n      // Note: is_long is a Bool (Constr(0,[]) = False, Constr(1,[]) = True)\r\n      console.log(\"Position datum fields:\", positionDatumData);\r\n      console.log(\"Field types:\", positionDatumData.map((f, i) => `[${i}]: ${typeof f} = ${f}`));\r\n\r\n      // Use BigInt for precise on-chain matching arithmetic\r\n      const collateralBig = BigInt(positionDatumData[1] as bigint);\r\n      const entryPriceBig = BigInt(positionDatumData[2] as bigint);  // scaled by 1e6\r\n      const sizeBig = BigInt(positionDatumData[3] as bigint);        // position size\r\n      // is_long is a Constr: Constr(1,[]) = True (Long), Constr(0,[]) = False (Short)\r\n      const isLongConstr = positionDatumData[4] as { index: number };\r\n      const isLong = isLongConstr.index === 1;\r\n      const leverageBig = BigInt(positionDatumData[5] as bigint);\r\n\r\n      console.log(\"Parsed values (BigInt):\", {\r\n        collateral: collateralBig.toString(),\r\n        entryPrice: entryPriceBig.toString(),\r\n        size: sizeBig.toString(),\r\n        isLong,\r\n        leverage: leverageBig.toString()\r\n      });\r\n\r\n      // Calculate PnL exactly as on-chain does (using BigInt for exact match):\r\n      // let price_diff = if is_long { current_price - entry_price } else { entry_price - current_price }\r\n      // let pnl_scaled = size * price_diff\r\n      // let pnl = pnl_scaled / (entry_price * 100)\r\n      // NOTE: leverage is NOT multiplied here because size already includes leverage effect\r\n      // The 100 factor converts from (1e8 size scale / 1e6 price scale) to USDM units\r\n      const currentPriceBig = BigInt(oracleFeed.price);  // scaled by 1e6\r\n      const priceDiffBig = isLong\r\n        ? currentPriceBig - entryPriceBig\r\n        : entryPriceBig - currentPriceBig;\r\n\r\n      // On-chain: pnl = (size * price_diff) / (entry_price * 100)\r\n      // size already has leverage baked in, so we do NOT multiply by leverage here\r\n      const pnlScaledBig = sizeBig * priceDiffBig;\r\n      const pnlBig = pnlScaledBig / (entryPriceBig * BigInt(100));  // BigInt division (truncates toward zero)\r\n\r\n      // Determine if profit or loss\r\n      const isProfit = pnlBig >= BigInt(0);\r\n      const pnlAmountAbs = pnlBig >= BigInt(0) ? pnlBig : -pnlBig;\r\n\r\n      console.log(\"PnL calculation (BigInt):\", {\r\n        currentPrice: currentPriceBig.toString(),\r\n        priceDiff: priceDiffBig.toString(),\r\n        pnlScaled: pnlScaledBig.toString(),\r\n        pnl: pnlBig.toString(),\r\n        isProfit,\r\n        pnlAmountAbs: pnlAmountAbs.toString()\r\n      });\r\n\r\n      // Convert to Number for display purposes only\r\n      const collateral = Number(collateralBig);\r\n      const leverage = Number(leverageBig);\r\n      const closePrice = Number(currentPriceBig) / 1_000_000;\r\n      const entryPrice = Number(entryPriceBig) / 1_000_000;\r\n      const realizedPnl = Number(pnlBig);\r\n      const pnlPercent = collateral > 0 ? (realizedPnl / collateral) * 100 : 0;\r\n\r\n      console.log(`Position details: entry=${entryPrice}, close=${closePrice}, collateral=${collateral}, leverage=${leverage}x`);\r\n      console.log(`PnL calculation: ${isLong ? \"Long\" : \"Short\"}, realized=${realizedPnl.toFixed(2)} USDM (${pnlPercent.toFixed(2)}%)`);\r\n\r\n      // 5. Build ClosePosition redeemer with oracle price feed\r\n      // OraclePriceFeed: Constr(0, [symbol: ByteArray, price: Int, timestamp: Int, signature: ByteArray])\r\n      // ClosePosition: Constr(1, [OraclePriceFeed])\r\n      // Note: In Lucid-evolution, ByteArray fields should be hex strings (not wrapped in fromText for hex data)\r\n      const symbolHex = fromText(oracleFeed.symbol);  // \"BTC\" -> \"425443\"\r\n\r\n      console.log(\"Building redeemer with:\");\r\n      console.log(\"  symbol (hex):\", symbolHex);\r\n      console.log(\"  price:\", oracleFeed.price);\r\n      console.log(\"  timestamp:\", oracleFeed.timestamp);\r\n      console.log(\"  signature:\", oracleFeed.signature.substring(0, 32) + \"...\");\r\n\r\n      const oracleFeedConstr = new Constr(0, [\r\n        symbolHex,                              // symbol as ByteArray (hex string)\r\n        BigInt(oracleFeed.price),              // price as Int\r\n        BigInt(oracleFeed.timestamp),          // timestamp as Int\r\n        oracleFeed.signature,                   // signature as ByteArray (hex string)\r\n      ]);\r\n\r\n      const closeRedeemer = Data.to(new Constr(1, [oracleFeedConstr]));\r\n      console.log(\"Close redeemer CBOR:\", closeRedeemer);\r\n\r\n      // 6. Load the position validator script (PlutusV3) - Updated 2024-12-30 with final PnL fix (size*price_diff/(entry_price*100))\r\n      const positionCompiledCode = \"590af701010029800aba2aba1aba0aab9faab9eaab9dab9a488888896600264653001300800198041804800cdc3a400530080024888966002600460106ea800e3300130093754007370e90024dc3a4001300837540089111199119912cc004c0180162b3001301137540190028b20248acc004c028016264b30013016001899801180a800801c5901318089baa00c8acc004c01c016264b30013016001899801180a800801c5901318089baa00c8acc004cdc3a400c00b1323259800980b80140122c80a0dd6980a80098089baa00c8b201e403c807900f0acc004c010c038dd5000c660026024601e6ea8006460266028602860286028602860286028003374a900048c04cc050c050c050c050c050c050c050c05000644646600200200644b30010018a508acc004cdc79bae30160010038a51899801001180b800a022405123013301430143014301400191809980a180a000c8c04cc050c050c050006460266028003230133014301430143014301400198071baa00a9b8848001222222222222323322598009809802c566002660166eb0c030c078dd500b1bae3021301e375401f15980099b894832004dd69803980f1baa00f8acc004cdc4a40046eb4c018c078dd5007c56600266e24dd69803180f1baa00f48320062b30013004375a6010603c6ea803e264b30013014301e375400315980099b89375a6010603e6ea8040c008dd59804180f9baa3008301f37546044603e6ea800629462c80ea2c80e8cc008dd61810980f1baa0160118b20388b20388b20388b20388b20388cc004888c96600266e2520000018acc004cdc4800a41101d19800801ccdc51bae30253022375400866e2a600294690084dd6980598111baa0045e4a600294690084dd6980698111baa0045e4a6eb8c030c088dd50022e5516408116408066e04cdc1800a41a01e6eb4c030c084dd5001c8c9660026032603e6ea800626eb4c08cc080dd5000c5200040786044603e6ea8c088c07cdd51807980f9baa001912cc004c054c07cdd500144c8c8c8c8ca60026eb8c0a00066eb8c0a00166eb4c0a00126eb4c0a000e6eb8c0a000922222598009817003402e2c81586050002604e002604c002604a00260406ea800a2c80f2446600a004464b3001301b3021375400313371e6eb8c094c088dd5000801c5282040302430213754604860426ea8c028c084dd5000a4444b3001301b0098992cc004cc040dd6180898119baa01b375c604c60466ea8052264b300130193023375400313259800980d98121baa001899198030008acc0066002009375c6020604c6ea8006600e03c80422646644b3001301e302837540031325980099b8959800981198149baa302d302e004899b80001003899b810015980099b880010038800c400d028205032330010013758602c60566ea808c89660020031480022646644b30013024302e375400515980099b8f375c6064605e6ea8008dd7181918179baa020899b80001301237566030605e6ea800e2002816a20028168c0c0c0b4dd5181818169baa001330030033031002302f00140b514a31640a060186eacc048c0a4dd5180918149baa302c3029375400316409c6eb4c0a8004cc02cdd6181518139baa01f01a32325980099b89480000062660546ea0004cc0aa6002946980103d87a8000a60103d8798000409897ae08998151ba8337029000000998154c005285300103d87a8000a60103d8798000409897ae0409866e0ccdc11bad301130273754030b30013020302637546026604e6ea8062266e04004dd6980918139baa018899b81375a6024604e6ea806000502519b82375a6024604e6ea806120c801375a601e604c6ea80122c8120c0a0c094dd5000c59023180798121baa300d30243754604e60486ea80062c8110cc008dd6181318119baa01b375c602660466ea80522c8108c094c088dd500ec56600260300131332259800980c98119baa0018992cc004c06cc090dd5000c4c8cc01800456600330010049bae301030263754003300701e402115980099912cc004c084c09cdd5180a18141baa019899b89002001899b8900100240986eb4c03cc098dd5002192cc004c080c098dd5180998139baa018899b81375a6024604e6ea8060006266e00dd6980918139baa018001409466e0ccdc119b82375a601e604c6ea805d2010375a6022604c6ea805ccdc119b82375a6020604c6ea805cdd6980718131baa01748052264b3001301c3026375400313232598009807800c566002601e66e0400800629462c813a2c8138cdc199b820014802920c801300a37566020604e6ea8c040c09cdd5181518139baa0018b204a3300a37586052604c6ea80780662c81222c8120c0a0c094dd5000c59023180798121baa300d30243754604e60486ea80062c8110c094c088dd500e998009bac3025302237540346eb8c048c088dd5009c4c966002660206eb0c044c08cdd500d9bae3026302337540291598009804800c4c966002603260466ea80062646464b3001301c302637540031325980099b893370060166eacc044c0a0dd5180898141baa004006300b3756602260506ea8006264b3001301f3028375400313259800980f98149baa001899191919191919194c004dd7181a800cdd7181a8044dd6981a803cdd6981a8034dd6981a802cc966002606600315980099b8948010c0c80062d1302c303200140c51640d06ea8c0d40126eb4c0d400e6eb4c0d40092222222259800981f004c56600266e1cdd69811981d1baa011337006eb4c08cc0e8dd501580c456600266e3cdd7181e981d1baa011375c607a60746ea80ae2b30013370e6eb4c094c0e8dd50089bad3025303a375405715980099b87375a604860746ea8044dd69812181d1baa02b8acc00566002606660726ea8c098c0e8dd5008c4c0ccc0e4dd51813181d1baa02b8cc004c0ccc0e4dd51813181d1baa02ba50a5140e081c22b30013370e6eb4c088c0e8dd50089bad3022303a375405715980099b8f375c605460746ea8044dd71815181d1baa02b8a518b20708b20708b20708b20708b20708b20708b20708b2076181a800981a0009819800981900098188009818000981780098151baa0018b2050302c3029375400316409c602660506ea80062c8130c0a8c09cdd5000c59025198059bac30113026375403c466ebcc0a8c09cdd5000801181418129baa300e30253754002604e60486ea80062c8110cc01cdd6181318119baa01b0168b20428b2042375a604a60446ea807502020402038223300300223375e6044603e6ea80040088c966002602e603a6ea80062900044dd69810980f1baa001407064b30013017301d375400314c0103d87a8000899198008009bab3022301f375400444b30010018a6103d87a8000899192cc004cdc8a45045553444d000018acc004cdc7a441045553444d000018980899812181100125eb82298103d87a80004081133004004302600340806eb8c080004c08c005021203832330010010022259800800c5300103d87a8000899192cc004cdc8a451c2a76795ed9cb3fbea561af69342b5fcaa988871ca2c425ecd5593fd1000018acc004cdc7a4411c2a76795ed9cb3fbea561af69342b5fcaa988871ca2c425ecd5593fd1000018980819811981080125eb82298103d87a8000407d1330040043025003407c6eb8c07c004c088005020111919800800801912cc0040062980103d87a80008992cc004c0100062601e6604400297ae08998018019812001203c302200140808b201a2259800980318081baa0028991919194c004dd7180c000cdd7180c0024dd6980c001cdd6980c00124444b3001301d005804c5901a0c060004c05c004c058004c044dd500145900f18080021808180880222c8038601000260066ea802229344d9590011\";\r\n\r\n      // Create script object for Lucid-Evolution (supports PlutusV3!)\r\n      const positionScript: SpendingValidator = {\r\n        type: \"PlutusV3\",\r\n        script: positionCompiledCode,\r\n      };\r\n\r\n      // DEBUG: Calculate and verify script hash\r\n      const calculatedPositionHash = validatorToScriptHash(positionScript);\r\n      console.log(`Position script hash (calculated by Lucid): ${calculatedPositionHash}`);\r\n      console.log(`Position script hash (expected):            cfc0eb68637023ddd7a580207eec35f59c6da69076816496fd726f67`);\r\n      console.log(`Position script hash MATCH: ${calculatedPositionHash === \"cfc0eb68637023ddd7a580207eec35f59c6da69076816496fd726f67\"}`);\r\n      console.log(`Position compiled code length: ${positionCompiledCode.length}`);\r\n      console.log(`Position compiled code starts with: ${positionCompiledCode.substring(0, 20)}`);\r\n\r\n      // 7. Find Vault UTxO - Position script needs vault input in tx.inputs (not reference)\r\n      const vaultUtxos = await lucid.utxosAt(config.vault_script_addr);\r\n      console.log(`Found ${vaultUtxos.length} UTxOs at vault script`);\r\n\r\n      if (vaultUtxos.length === 0) {\r\n        throw new Error(\"Vault UTxO not found. Cannot close position without vault.\");\r\n      }\r\n\r\n      // Find the main vault UTxO (the one with datum)\r\n      const vaultUtxo = vaultUtxos.find(u => u.datum);\r\n      if (!vaultUtxo || !vaultUtxo.datum) {\r\n        throw new Error(\"Vault UTxO with datum not found.\");\r\n      }\r\n      console.log(\"Vault UTxO:\", vaultUtxo.txHash, vaultUtxo.outputIndex);\r\n\r\n      // 8. Build the transaction\r\n      const usdmUnit = config.usdm_policy_id + config.usdm_asset_name;\r\n\r\n      // Use BigInt throughout to match on-chain calculations exactly\r\n      // returnAmountBig: collateral +/- PnL (all in BigInt)\r\n      let returnAmountBig: bigint;\r\n      if (isProfit) {\r\n        returnAmountBig = collateralBig + pnlAmountAbs;\r\n      } else {\r\n        // Loss: capped at collateral\r\n        const cappedLoss = pnlAmountAbs > collateralBig ? collateralBig : pnlAmountAbs;\r\n        returnAmountBig = collateralBig - cappedLoss;\r\n      }\r\n      if (returnAmountBig < BigInt(0)) {\r\n        returnAmountBig = BigInt(0);\r\n      }\r\n\r\n      // Get the assets from the position UTxO\r\n      const positionLovelace = positionUtxo.assets[\"lovelace\"] || BigInt(0);\r\n\r\n      // Parse vault datum to preserve for continuing output\r\n      const vaultDatumParsed = Data.from(vaultUtxo.datum);\r\n      const vaultDatumFields = (vaultDatumParsed as { fields: unknown[] }).fields;\r\n\r\n      // Vault USDM balance calculation (keep as BigInt)\r\n      const vaultUsdmBig = vaultUtxo.assets[usdmUnit] || BigInt(0);\r\n      const vaultLovelace = vaultUtxo.assets[\"lovelace\"] || BigInt(0);\r\n\r\n      // New vault USDM: if profit, vault pays trader. if loss, vault receives from position\r\n      let newVaultUsdmBig: bigint;\r\n      if (isProfit) {\r\n        newVaultUsdmBig = vaultUsdmBig - pnlAmountAbs;\r\n      } else {\r\n        // Loss: vault receives the loss (capped at collateral)\r\n        const cappedLoss = pnlAmountAbs > collateralBig ? collateralBig : pnlAmountAbs;\r\n        newVaultUsdmBig = vaultUsdmBig + cappedLoss;\r\n      }\r\n\r\n      console.log(`Building TX: consuming position UTxO AND vault UTxO`);\r\n      console.log(`  Position has: ${positionLovelace} lovelace, ${collateralBig} USDM`);\r\n      console.log(`  Vault has: ${vaultUsdmBig} USDM`);\r\n      console.log(`  PnL: ${isProfit ? \"+\" : \"-\"}${pnlAmountAbs} USDM (${isProfit ? \"profit\" : \"loss\"})`);\r\n      console.log(`  Returning to trader: ${returnAmountBig} USDM + ADA`);\r\n      console.log(`  New vault USDM: ${newVaultUsdmBig}`);\r\n\r\n      // Build SettlePnL redeemer for vault\r\n      // SettlePnL: Constr(3, [pnl_amount: Int, is_profit: Bool, oracle_feed: OraclePriceFeed])\r\n      // Bool: Constr(1, []) = True, Constr(0, []) = False\r\n      const isProfitConstr = new Constr(isProfit ? 1 : 0, []);\r\n      const settlePnLRedeemer = Data.to(new Constr(3, [\r\n        pnlAmountAbs,  // Already BigInt from calculation\r\n        isProfitConstr,\r\n        oracleFeedConstr,  // Same oracle feed as position close\r\n      ]));\r\n      console.log(\"SettlePnL redeemer built\");\r\n\r\n      // Load vault script\r\n      const vaultCompiledCode = await getVaultCompiledCode();\r\n      const vaultScript: SpendingValidator = {\r\n        type: \"PlutusV3\",\r\n        script: vaultCompiledCode,\r\n      };\r\n\r\n      // DEBUG: Calculate and verify vault script hash\r\n      const calculatedVaultHash = validatorToScriptHash(vaultScript);\r\n      console.log(`Vault script hash (calculated by Lucid): ${calculatedVaultHash}`);\r\n      console.log(`Vault script hash (expected):            cd1e8b34087ffa8099f9c74b11d2df722862601d14e1c8c9e26274f5`);\r\n      console.log(`Vault script hash MATCH: ${calculatedVaultHash === \"cd1e8b34087ffa8099f9c74b11d2df722862601d14e1c8c9e26274f5\"}`);\r\n\r\n      // Create continuing vault datum (unchanged for SettlePnL)\r\n      const continuingVaultDatum = new Constr(0, [\r\n        vaultDatumFields[0] as DataType,  // admin\r\n        vaultDatumFields[1] as DataType,  // total_shares (unchanged)\r\n        vaultDatumFields[2] as DataType,  // min_deposit\r\n        vaultDatumFields[3] as DataType,  // oracle_pubkey\r\n        vaultDatumFields[4] as DataType,  // position_script_hash\r\n      ]);\r\n\r\n      // Build transaction: consume BOTH position and vault UTxOs\r\n      // Prepare trader output - only include USDM if returnAmountBig > 0\r\n      const traderOutput: Record<string, bigint> = {\r\n        lovelace: positionLovelace,\r\n      };\r\n      if (returnAmountBig > BigInt(0)) {\r\n        traderOutput[usdmUnit] = returnAmountBig;\r\n      }\r\n\r\n      const tx = await lucid\r\n        .newTx()\r\n        .collectFrom([positionUtxo], closeRedeemer)\r\n        .collectFrom([vaultUtxo], settlePnLRedeemer)\r\n        .attach.SpendingValidator(positionScript)\r\n        .attach.SpendingValidator(vaultScript)\r\n        .pay.ToAddress(walletAddress, traderOutput)\r\n        .pay.ToContract(\r\n          config.vault_script_addr,\r\n          { kind: \"inline\", value: Data.to(continuingVaultDatum as DataType) },\r\n          {\r\n            lovelace: vaultLovelace,\r\n            [usdmUnit]: newVaultUsdmBig,\r\n          }\r\n        )\r\n        .addSignerKey(traderPkh)\r\n        // Set validity based on oracle timestamp to pass age check on-chain\r\n        // On-chain checks: current_time - oracle_timestamp <= 300 seconds\r\n        // Lucid uses milliseconds, so convert oracle timestamp (seconds) to ms\r\n        .validFrom(oracleFeed.timestamp * 1000)  // Oracle timestamp as lower bound\r\n        .validTo(oracleFeed.timestamp * 1000 + 300000)  // Oracle timestamp + 5 minutes\r\n        .complete();\r\n\r\n      console.log(\"TX built, signing...\");\r\n\r\n      // Sign and submit\r\n      const signedTx = await tx.sign.withWallet().complete();\r\n      const txHash = await signedTx.submit();\r\n\r\n      console.log(\"Transaction submitted:\", txHash);\r\n\r\n      // Update backend DB after successful on-chain close\r\n      try {\r\n        await tradingApi.closePosition(params.positionId, walletAddress);\r\n        console.log(\"Position marked as closed in DB\");\r\n      } catch (dbError) {\r\n        console.error(\"Failed to update position in DB:\", dbError);\r\n      }\r\n\r\n      const closeResult: ClosePositionResult = {\r\n        txHash,\r\n        closePrice,\r\n        realizedPnl,\r\n        pnlPercent,\r\n      };\r\n\r\n      console.log(\"Position closed successfully:\", closeResult);\r\n      return closeResult;\r\n    } catch (error) {\r\n      console.error(\"Error closing position:\", error);\r\n      throw error;\r\n    }\r\n  }, [walletAddress]);\r\n\r\n  // Deposit USDM to Vault (LP)\r\n  // If vault is empty, this initializes the vault with VaultDatum\r\n  const depositToVault = useCallback(async (amount: number): Promise<VaultDepositResult> => {\r\n    const lucid = getLucid();\r\n    if (!lucid || !walletAddress) {\r\n      throw new Error(\"Wallet not connected. Please connect your wallet first.\");\r\n    }\r\n\r\n    try {\r\n      const config = await configApi.getContractConfig();\r\n      console.log(\"Depositing to vault:\", amount, \"USDM\");\r\n\r\n      // Get depositor's payment key hash\r\n      const addressDetails = getAddressDetails(walletAddress);\r\n      const depositorPkh = addressDetails.paymentCredential?.hash;\r\n      if (!depositorPkh) {\r\n        throw new Error(\"Could not extract payment key hash from address\");\r\n      }\r\n\r\n      // Check if vault already has UTxO (initialized)\r\n      const vaultUtxos = await lucid.utxosAt(config.vault_script_addr);\r\n      console.log(`Found ${vaultUtxos.length} UTxOs at vault`);\r\n\r\n      const usdmUnit = config.usdm_policy_id + config.usdm_asset_name;\r\n      const depositAmount = BigInt(Math.round(amount));\r\n\r\n      // Get oracle pubkey and position script hash from API config\r\n      // These values come from root .env via backend gateway\r\n      const oraclePubkey = \"ae349591d0cf933849d4c9a667cca669ad2386c4fc4b33e97324164fde0f03ac\";\r\n      const positionScriptHash = config.position_script_hash;\r\n      if (!positionScriptHash) {\r\n        throw new Error(\"position_script_hash not configured in backend. Check .env\");\r\n      }\r\n      console.log(\"Using position_script_hash from config:\", positionScriptHash);\r\n\r\n      let tx;\r\n      let newShares: number;\r\n\r\n      if (vaultUtxos.length === 0) {\r\n        // INITIALIZE VAULT: First deposit creates the vault UTxO\r\n        console.log(\"Initializing vault with first deposit...\");\r\n\r\n        // VaultDatum: [admin, total_shares, min_deposit, oracle_pubkey, position_script_hash]\r\n        const vaultDatum = new Constr(0, [\r\n          depositorPkh,                    // admin: VerificationKeyHash\r\n          depositAmount,                   // total_shares: Int (1:1 for first deposit)\r\n          BigInt(100),                     // min_deposit: Int (100 USDM minimum)\r\n          oraclePubkey,                    // oracle_pubkey: ByteArray\r\n          positionScriptHash,              // position_script_hash: ByteArray\r\n        ]);\r\n\r\n        console.log(\"VaultDatum:\", {\r\n          admin: depositorPkh,\r\n          total_shares: depositAmount.toString(),\r\n          min_deposit: 100,\r\n          oracle_pubkey: oraclePubkey,\r\n          position_script_hash: positionScriptHash,\r\n        });\r\n\r\n        tx = await lucid\r\n          .newTx()\r\n          .pay.ToContract(\r\n            config.vault_script_addr,\r\n            { kind: \"inline\", value: Data.to(vaultDatum) },\r\n            {\r\n              lovelace: BigInt(2_000_000), // ~2 ADA for UTxO\r\n              [usdmUnit]: depositAmount,\r\n            }\r\n          )\r\n          .complete();\r\n\r\n        newShares = amount; // 1:1 for first deposit\r\n      } else {\r\n        // ADD TO EXISTING VAULT: Deposit more liquidity\r\n        console.log(\"Adding liquidity to existing vault...\");\r\n\r\n        const vaultUtxo = vaultUtxos.find(u => u.datum);\r\n        if (!vaultUtxo || !vaultUtxo.datum) {\r\n          throw new Error(\"Vault UTxO with datum not found\");\r\n        }\r\n\r\n        // Parse existing vault datum\r\n        const existingDatum = Data.from(vaultUtxo.datum);\r\n        const datumFields = (existingDatum as { fields: unknown[] }).fields;\r\n\r\n        const currentShares = Number(datumFields[1] as bigint);\r\n        const currentUsdm = Number(vaultUtxo.assets[usdmUnit] || BigInt(0));\r\n\r\n        // Calculate new shares: (deposit * total_shares) / total_usdm\r\n        newShares = currentUsdm > 0 ? (amount * currentShares) / currentUsdm : amount;\r\n        const newTotalShares = BigInt(Math.round(currentShares + newShares));\r\n\r\n        // Create updated VaultDatum with proper type casting\r\n        const updatedVaultDatum = new Constr(0, [\r\n          datumFields[0] as DataType,      // admin (unchanged)\r\n          newTotalShares,                  // total_shares (increased)\r\n          datumFields[2] as DataType,      // min_deposit (unchanged)\r\n          datumFields[3] as DataType,      // oracle_pubkey (unchanged)\r\n          datumFields[4] as DataType,      // position_script_hash (unchanged)\r\n        ]);\r\n\r\n        // DepositLiquidity redeemer: Constr(0, [amount])\r\n        const depositRedeemer = Data.to(new Constr(0, [depositAmount]));\r\n\r\n        // Load vault script\r\n        const vaultCompiledCode = await getVaultCompiledCode();\r\n        const vaultScript: SpendingValidator = {\r\n          type: \"PlutusV3\",\r\n          script: vaultCompiledCode,\r\n        };\r\n\r\n        const newVaultLovelace = (vaultUtxo.assets[\"lovelace\"] || BigInt(0));\r\n        const newVaultUsdm = BigInt(currentUsdm) + depositAmount;\r\n\r\n        tx = await lucid\r\n          .newTx()\r\n          .collectFrom([vaultUtxo], depositRedeemer)\r\n          .attach.SpendingValidator(vaultScript)\r\n          .pay.ToContract(\r\n            config.vault_script_addr,\r\n            { kind: \"inline\", value: Data.to(updatedVaultDatum as DataType) },\r\n            {\r\n              lovelace: newVaultLovelace,\r\n              [usdmUnit]: newVaultUsdm,\r\n            }\r\n          )\r\n          .complete();\r\n      }\r\n\r\n      console.log(\"TX built, signing...\");\r\n      const signedTx = await tx.sign.withWallet().complete();\r\n      const txHash = await signedTx.submit();\r\n\r\n      console.log(\"Vault deposit submitted:\", txHash);\r\n\r\n      return {\r\n        txHash,\r\n        amount,\r\n        shares: newShares,\r\n      };\r\n    } catch (error) {\r\n      console.error(\"Error depositing to vault:\", error);\r\n      throw error;\r\n    }\r\n  }, [walletAddress]);\r\n\r\n  // Withdraw USDM from Vault by burning shares\r\n  const withdrawFromVault = useCallback(async (shares: number): Promise<VaultWithdrawResult> => {\r\n    const lucid = getLucid();\r\n    if (!lucid || !walletAddress) {\r\n      throw new Error(\"Wallet not connected. Please connect your wallet first.\");\r\n    }\r\n\r\n    try {\r\n      const config = await configApi.getContractConfig();\r\n      console.log(\"Withdrawing from vault:\", shares, \"shares\");\r\n\r\n      const vaultUtxos = await lucid.utxosAt(config.vault_script_addr);\r\n      const vaultUtxo = vaultUtxos.find(u => u.datum);\r\n\r\n      if (!vaultUtxo || !vaultUtxo.datum) {\r\n        throw new Error(\"Vault UTxO not found\");\r\n      }\r\n\r\n      const usdmUnit = config.usdm_policy_id + config.usdm_asset_name;\r\n\r\n      // Parse existing vault datum\r\n      const existingDatum = Data.from(vaultUtxo.datum);\r\n      const datumFields = (existingDatum as { fields: unknown[] }).fields;\r\n\r\n      const totalShares = Number(datumFields[1] as bigint);\r\n      const totalUsdm = Number(vaultUtxo.assets[usdmUnit] || BigInt(0));\r\n\r\n      // Calculate withdrawal amount: (shares * total_usdm) / total_shares\r\n      const withdrawAmount = Math.floor((shares * totalUsdm) / totalShares);\r\n      const sharesToBurn = BigInt(Math.round(shares));\r\n      const newTotalShares = BigInt(Math.round(totalShares - shares));\r\n\r\n      console.log(`Withdrawing ${withdrawAmount} USDM for ${shares} shares`);\r\n\r\n      // Create updated VaultDatum with proper type casting\r\n      const updatedVaultDatum = new Constr(0, [\r\n        datumFields[0] as DataType,      // admin (unchanged)\r\n        newTotalShares,                  // total_shares (decreased)\r\n        datumFields[2] as DataType,      // min_deposit (unchanged)\r\n        datumFields[3] as DataType,      // oracle_pubkey (unchanged)\r\n        datumFields[4] as DataType,      // position_script_hash (unchanged)\r\n      ]);\r\n\r\n      // WithdrawLiquidity redeemer: Constr(1, [shares_to_burn])\r\n      const withdrawRedeemer = Data.to(new Constr(1, [sharesToBurn]));\r\n\r\n      // Load vault script\r\n      const vaultCompiledCode = await getVaultCompiledCode();\r\n      const vaultScript: SpendingValidator = {\r\n        type: \"PlutusV3\",\r\n        script: vaultCompiledCode,\r\n      };\r\n\r\n      const newVaultLovelace = vaultUtxo.assets[\"lovelace\"] || BigInt(0);\r\n      const newVaultUsdm = BigInt(totalUsdm - withdrawAmount);\r\n\r\n      // Check if this is a full withdrawal (emptying the vault)\r\n      const isFullWithdrawal = shares >= totalShares;\r\n\r\n      let tx;\r\n      if (isFullWithdrawal) {\r\n        // Full withdrawal: no continuing vault output\r\n        // Return all USDM and ADA to the withdrawer\r\n        console.log(\"Full withdrawal detected - emptying vault completely\");\r\n        tx = await lucid\r\n          .newTx()\r\n          .collectFrom([vaultUtxo], withdrawRedeemer)\r\n          .attach.SpendingValidator(vaultScript)\r\n          .pay.ToAddress(walletAddress, {\r\n            lovelace: newVaultLovelace,\r\n            [usdmUnit]: BigInt(totalUsdm),\r\n          })\r\n          .complete();\r\n      } else {\r\n        // Partial withdrawal: create continuing vault output\r\n        tx = await lucid\r\n          .newTx()\r\n          .collectFrom([vaultUtxo], withdrawRedeemer)\r\n          .attach.SpendingValidator(vaultScript)\r\n          .pay.ToContract(\r\n            config.vault_script_addr,\r\n            { kind: \"inline\", value: Data.to(updatedVaultDatum as DataType) },\r\n            {\r\n              lovelace: newVaultLovelace,\r\n              [usdmUnit]: newVaultUsdm,\r\n            }\r\n          )\r\n          .pay.ToAddress(walletAddress, {\r\n            [usdmUnit]: BigInt(withdrawAmount),\r\n          })\r\n          .complete();\r\n      }\r\n\r\n      console.log(\"TX built, signing...\");\r\n      const signedTx = await tx.sign.withWallet().complete();\r\n      const txHash = await signedTx.submit();\r\n\r\n      console.log(\"Vault withdrawal submitted:\", txHash);\r\n\r\n      return {\r\n        txHash,\r\n        amount: withdrawAmount,\r\n        sharesBurned: shares,\r\n      };\r\n    } catch (error) {\r\n      console.error(\"Error withdrawing from vault:\", error);\r\n      throw error;\r\n    }\r\n  }, [walletAddress]);\r\n\r\n  return (\r\n    <WalletContext.Provider\r\n      value={{\r\n        walletAddress,\r\n        network,\r\n        isConnecting,\r\n        isLaceAvailable,\r\n        connectWallet,\r\n        disconnectWallet,\r\n        openPosition,\r\n        closePosition,\r\n        depositToVault,\r\n        withdrawFromVault,\r\n      }}\r\n    >\r\n      {children}\r\n    </WalletContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useWallet() {\r\n  const context = useContext(WalletContext);\r\n  if (context === undefined) {\r\n    throw new Error(\"useWallet must be used within a WalletProvider\");\r\n  }\r\n  return context;\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1113, "column": 0}, "map": {"version":3,"sources":["file:///Users/vata/HydroX-exchange/frontend/src/components/Toast.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { createContext, useContext, useState, useCallback, ReactNode, ReactElement } from \"react\";\r\n\r\ntype ToastType = \"success\" | \"error\" | \"info\" | \"warning\";\r\n\r\ninterface ToastData {\r\n  id: string;\r\n  type: ToastType;\r\n  title: string;\r\n  message?: string;\r\n  details?: { label: string; value: string }[];\r\n  duration?: number;\r\n}\r\n\r\ninterface ToastContextType {\r\n  showToast: (toast: Omit<ToastData, \"id\">) => void;\r\n  hideToast: (id: string) => void;\r\n}\r\n\r\nconst ToastContext = createContext<ToastContextType | undefined>(undefined);\r\n\r\nexport function ToastProvider({ children }: { children: ReactNode }) {\r\n  const [toasts, setToasts] = useState<ToastData[]>([]);\r\n\r\n  const showToast = useCallback((toast: Omit<ToastData, \"id\">) => {\r\n    const id = Math.random().toString(36).substring(7);\r\n    const newToast = { ...toast, id };\r\n    setToasts((prev) => [...prev, newToast]);\r\n\r\n    // Auto dismiss after duration (default 5s, success 8s for TX)\r\n    const duration = toast.duration ?? (toast.type === \"success\" ? 8000 : 5000);\r\n    setTimeout(() => {\r\n      setToasts((prev) => prev.filter((t) => t.id !== id));\r\n    }, duration);\r\n  }, []);\r\n\r\n  const hideToast = useCallback((id: string) => {\r\n    setToasts((prev) => prev.filter((t) => t.id !== id));\r\n  }, []);\r\n\r\n  return (\r\n    <ToastContext.Provider value={{ showToast, hideToast }}>\r\n      {children}\r\n      <ToastContainer toasts={toasts} onClose={hideToast} />\r\n    </ToastContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useToast() {\r\n  const context = useContext(ToastContext);\r\n  if (!context) {\r\n    throw new Error(\"useToast must be used within ToastProvider\");\r\n  }\r\n  return context;\r\n}\r\n\r\n// Toast Container\r\nfunction ToastContainer({\r\n  toasts,\r\n  onClose,\r\n}: {\r\n  toasts: ToastData[];\r\n  onClose: (id: string) => void;\r\n}) {\r\n  if (toasts.length === 0) return null;\r\n\r\n  return (\r\n    <div className=\"fixed top-4 right-4 z-50 flex flex-col gap-3 max-w-md\">\r\n      {toasts.map((toast) => (\r\n        <ToastItem key={toast.id} toast={toast} onClose={() => onClose(toast.id)} />\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\n// Individual Toast\r\nfunction ToastItem({ toast, onClose }: { toast: ToastData; onClose: () => void }) {\r\n  const icons: Record<ToastType, ReactElement> = {\r\n    success: (\r\n      <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\r\n      </svg>\r\n    ),\r\n    error: (\r\n      <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n      </svg>\r\n    ),\r\n    warning: (\r\n      <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\r\n      </svg>\r\n    ),\r\n    info: (\r\n      <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n      </svg>\r\n    ),\r\n  };\r\n\r\n  const colors: Record<ToastType, { bg: string; border: string; icon: string; text: string }> = {\r\n    success: {\r\n      bg: \"bg-[#0f0f0f]\",\r\n      border: \"border-[#00FFE0]/30\",\r\n      icon: \"text-[#00FFE0] bg-[#00FFE0]/10\",\r\n      text: \"text-[#00FFE0]\",\r\n    },\r\n    error: {\r\n      bg: \"bg-[#0f0f0f]\",\r\n      border: \"border-red-500/30\",\r\n      icon: \"text-red-400 bg-red-500/10\",\r\n      text: \"text-red-400\",\r\n    },\r\n    warning: {\r\n      bg: \"bg-[#0f0f0f]\",\r\n      border: \"border-yellow-500/30\",\r\n      icon: \"text-yellow-400 bg-yellow-500/10\",\r\n      text: \"text-yellow-400\",\r\n    },\r\n    info: {\r\n      bg: \"bg-[#0f0f0f]\",\r\n      border: \"border-blue-500/30\",\r\n      icon: \"text-blue-400 bg-blue-500/10\",\r\n      text: \"text-blue-400\",\r\n    },\r\n  };\r\n\r\n  const style = colors[toast.type];\r\n\r\n  return (\r\n    <div\r\n      className={`${style.bg} border ${style.border} rounded-lg shadow-xl backdrop-blur-sm animate-slide-in`}\r\n      style={{\r\n        animation: \"slideIn 0.3s ease-out\",\r\n      }}\r\n    >\r\n      <div className=\"p-4\">\r\n        <div className=\"flex items-start gap-3\">\r\n          {/* Icon */}\r\n          <div className={`${style.icon} p-2 rounded-lg shrink-0`}>\r\n            {icons[toast.type]}\r\n          </div>\r\n\r\n          {/* Content */}\r\n          <div className=\"flex-1 min-w-0\">\r\n            <h4 className={`font-semibold ${style.text}`}>{toast.title}</h4>\r\n            {toast.message && (\r\n              <p className=\"text-zinc-400 text-sm mt-1\">{toast.message}</p>\r\n            )}\r\n\r\n            {/* Details */}\r\n            {toast.details && toast.details.length > 0 && (\r\n              <div className=\"mt-3 space-y-1.5 bg-[#141414] rounded-md p-3 border border-[#1f1f1f]\">\r\n                {toast.details.map((detail, idx) => (\r\n                  <div key={idx} className=\"flex justify-between text-sm\">\r\n                    <span className=\"text-zinc-500\">{detail.label}</span>\r\n                    <span className=\"text-white font-mono text-xs truncate max-w-[200px]\">\r\n                      {detail.value}\r\n                    </span>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Close button */}\r\n          <button\r\n            onClick={onClose}\r\n            className=\"text-zinc-500 hover:text-zinc-300 transition-colors shrink-0\"\r\n          >\r\n            <svg className=\"w-4 h-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n            </svg>\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Progress bar */}\r\n      <div className=\"h-1 bg-[#1a1a1a] rounded-b-lg overflow-hidden\">\r\n        <div\r\n          className={`h-full ${toast.type === \"success\" ? \"bg-[#00FFE0]\" : toast.type === \"error\" ? \"bg-red-500\" : toast.type === \"warning\" ? \"bg-yellow-500\" : \"bg-blue-500\"}`}\r\n          style={{\r\n            animation: `shrink ${toast.duration ?? (toast.type === \"success\" ? 8000 : 5000)}ms linear forwards`,\r\n          }}\r\n        />\r\n      </div>\r\n\r\n      <style jsx>{`\r\n        @keyframes slideIn {\r\n          from {\r\n            opacity: 0;\r\n            transform: translateX(100%);\r\n          }\r\n          to {\r\n            opacity: 1;\r\n            transform: translateX(0);\r\n          }\r\n        }\r\n        @keyframes shrink {\r\n          from {\r\n            width: 100%;\r\n          }\r\n          to {\r\n            width: 0%;\r\n          }\r\n        }\r\n      `}</style>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1457, "column": 0}, "map": {"version":3,"sources":["file:///Users/vata/HydroX-exchange/frontend/src/components/Header.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState } from \"react\";\nimport Link from \"next/link\";\nimport { usePathname } from \"next/navigation\";\nimport { useWallet } from \"@/contexts/WalletContext\";\nimport { useToast } from \"@/components/Toast\";\n\n// HydroX Logo Component - matching landing page\nconst HydroXLogo = ({ className }: { className?: string }) => (\n  <svg viewBox=\"0 0 32 32\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" className={className}>\n    <rect width=\"32\" height=\"32\" rx=\"8\" fill=\"#0a0a0a\" />\n    <path\n      d=\"M16 6C16 6 10 12 10 18C10 21.3137 12.6863 24 16 24C19.3137 24 22 21.3137 22 18C22 12 16 6 16 6Z\"\n      fill=\"#00FFE0\"\n      style={{ filter: \"drop-shadow(0 0 8px rgba(0,255,224,0.6))\" }}\n    />\n    <path\n      d=\"M16 10C16 10 13 14 13 17.5C13 19.433 14.567 21 16.5 21C18.433 21 20 19.433 20 17.5C20 14 16 10 16 10Z\"\n      fill=\"#0a0a0a\"\n      fillOpacity=\"0.5\"\n    />\n  </svg>\n);\n\n// Wallet Icon\nconst WalletIcon = ({ className }: { className?: string }) => (\n  <svg className={className} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n    <path d=\"M21 12V7H5a2 2 0 0 1 0-4h14v4\" />\n    <path d=\"M3 5v14a2 2 0 0 0 2 2h16v-5\" />\n    <path d=\"M18 12a2 2 0 0 0 0 4h4v-4h-4z\" />\n  </svg>\n);\n\nconst Header = () => {\n  const [isMenuOpen, setIsMenuOpen] = useState(false);\n  const pathname = usePathname();\n  const { walletAddress, isConnecting, isLaceAvailable, connectWallet, disconnectWallet } = useWallet();\n  const { showToast } = useToast();\n\n  const handleConnectWallet = async () => {\n    try {\n      await connectWallet();\n      // No toast on success - wallet connection is shown in the header\n    } catch (error) {\n      const err = error as Error;\n      showToast({\n        type: \"error\",\n        title: \"Connection Failed\",\n        message: err.message,\n      });\n    }\n  };\n\n  const isPerpetualsActive = pathname.startsWith(\"/perpetuals\") || pathname === \"/\";\n  const isVaultsActive = pathname.startsWith(\"/vaults\");\n  const isStatsActive = pathname.startsWith(\"/stats\");\n\n  // Format address for display\n  const formatAddress = (address: string) => {\n    if (address.length <= 16) return address;\n    return `${address.slice(0, 8)}...${address.slice(-8)}`;\n  };\n\n  return (\n    <header className=\"bg-[#0a0a0a] border-b border-[#1a1a1a] text-white px-6 py-3 shrink-0 z-50\">\n      <div className=\"flex justify-between items-center w-full\">\n        <div className=\"flex items-center space-x-8\">\n          {/* Logo with HydroX theme */}\n          <Link href=\"/\" className=\"flex items-center space-x-2 group\">\n            <HydroXLogo className=\"h-8 w-8\" />\n            <h1 className=\"text-xl font-bold text-[#00FFE0] drop-shadow-[0_0_10px_rgba(0,255,224,0.5)] group-hover:drop-shadow-[0_0_15px_rgba(0,255,224,0.7)] transition-all\">\n              HydroX\n            </h1>\n          </Link>\n\n          {/* Navigation */}\n          <nav className=\"hidden md:flex space-x-1\">\n            <Link\n              href=\"/perpetuals\"\n              className={`px-4 py-2 rounded-lg transition-all text-sm font-medium ${\n                isPerpetualsActive\n                  ? \"text-[#00FFE0] bg-[#00FFE0]/10 border border-[#00FFE0]/30\"\n                  : \"text-zinc-400 hover:text-[#00FFE0] hover:bg-[#00FFE0]/5\"\n              }`}\n            >\n              Perpetuals\n            </Link>\n            <Link\n              href=\"/vaults\"\n              className={`px-4 py-2 rounded-lg transition-all text-sm font-medium ${\n                isVaultsActive\n                  ? \"text-[#00FFE0] bg-[#00FFE0]/10 border border-[#00FFE0]/30\"\n                  : \"text-zinc-400 hover:text-[#00FFE0] hover:bg-[#00FFE0]/5\"\n              }`}\n            >\n              Vaults\n            </Link>\n            <Link\n              href=\"/stats\"\n              className={`px-4 py-2 rounded-lg transition-all text-sm font-medium flex items-center gap-1.5 ${\n                isStatsActive\n                  ? \"text-yellow-500 bg-yellow-500/10 border border-yellow-500/30 border-dashed\"\n                  : \"text-yellow-500/70 hover:text-yellow-500 hover:bg-yellow-500/5 border border-dashed border-yellow-500/20\"\n              }`}\n            >\n              <svg className=\"w-3.5 h-3.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z\" />\n              </svg>\n              Stats\n            </Link>\n          </nav>\n        </div>\n\n        {/* Right side - Wallet Connection */}\n        <div className=\"hidden md:flex items-center\">\n          {walletAddress ? (\n            <div className=\"flex items-center gap-3\">\n              <div className=\"flex items-center gap-2 px-3 py-2 bg-[#00FFE0]/10 border border-[#00FFE0]/30 rounded-lg shadow-[0_0_15px_rgba(0,255,224,0.1)]\">\n                <div className=\"w-2 h-2 bg-[#00FFE0] rounded-full animate-pulse shadow-[0_0_8px_rgba(0,255,224,0.6)]\" />\n                <span className=\"text-sm font-mono text-[#00FFE0] font-medium\">\n                  {formatAddress(walletAddress)}\n                </span>\n              </div>\n              <button\n                onClick={disconnectWallet}\n                className=\"px-3 py-2 text-sm text-zinc-400 hover:text-[#00FFE0] hover:bg-[#00FFE0]/10 rounded-lg transition-all\"\n              >\n                Disconnect\n              </button>\n            </div>\n          ) : (\n            <button\n              onClick={handleConnectWallet}\n              disabled={isConnecting || !isLaceAvailable}\n              className=\"flex items-center gap-2 px-4 py-2 bg-[#00FFE0]/10 border border-[#00FFE0]/30 rounded-lg text-[#00FFE0] hover:bg-[#00FFE0]/20 hover:border-[#00FFE0]/50 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-[0_0_15px_rgba(0,255,224,0.1)]\"\n            >\n              <WalletIcon className=\"w-4 h-4\" />\n              <span className=\"text-sm font-medium\">\n                {isConnecting ? \"Connecting...\" : isLaceAvailable ? \"Connect Wallet\" : \"Install Lace\"}\n              </span>\n            </button>\n          )}\n        </div>\n\n        {/* Mobile menu button */}\n        <div className=\"md:hidden\">\n          <button\n            onClick={() => setIsMenuOpen(!isMenuOpen)}\n            className=\"p-2 rounded-lg hover:bg-[#00FFE0]/10 transition-colors text-[#00FFE0]\"\n          >\n            <svg\n              className=\"w-6 h-6\"\n              fill=\"none\"\n              stroke=\"currentColor\"\n              viewBox=\"0 0 24 24\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth=\"2\"\n                d=\"M4 6h16M4 12h16m-7 6h7\"\n              ></path>\n            </svg>\n          </button>\n        </div>\n      </div>\n\n      {/* Mobile Menu */}\n      {isMenuOpen && (\n        <div className=\"md:hidden mt-4 pt-4 border-t border-[#1a1a1a]\">\n          <nav className=\"flex flex-col space-y-1\">\n            <Link\n              href=\"/perpetuals\"\n              className={`px-4 py-2 rounded-lg ${\n                isPerpetualsActive\n                  ? \"text-[#00FFE0] bg-[#00FFE0]/10\"\n                  : \"text-zinc-400 hover:text-[#00FFE0] hover:bg-[#00FFE0]/5\"\n              }`}\n            >\n              Perpetuals\n            </Link>\n            <Link\n              href=\"/vaults\"\n              className={`px-4 py-2 rounded-lg ${\n                isVaultsActive\n                  ? \"text-[#00FFE0] bg-[#00FFE0]/10\"\n                  : \"text-zinc-400 hover:text-[#00FFE0] hover:bg-[#00FFE0]/5\"\n              }`}\n            >\n              Vaults\n            </Link>\n            <Link\n              href=\"/stats\"\n              className={`px-4 py-2 rounded-lg flex items-center gap-1.5 ${\n                isStatsActive\n                  ? \"text-yellow-500 bg-yellow-500/10 border border-yellow-500/30 border-dashed\"\n                  : \"text-yellow-500/70 hover:text-yellow-500 hover:bg-yellow-500/5\"\n              }`}\n            >\n              <svg className=\"w-3.5 h-3.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z\" />\n              </svg>\n              Stats (Dev)\n            </Link>\n          </nav>\n          <div className=\"mt-4 pt-4 border-t border-[#1a1a1a]\">\n            {walletAddress ? (\n              <div className=\"space-y-2\">\n                <div className=\"flex items-center gap-2 px-3 py-2 bg-[#00FFE0]/10 border border-[#00FFE0]/30 rounded-lg\">\n                  <div className=\"w-2 h-2 bg-[#00FFE0] rounded-full animate-pulse\" />\n                  <span className=\"text-sm font-mono text-[#00FFE0]\">\n                    {formatAddress(walletAddress)}\n                  </span>\n                </div>\n                <button\n                  onClick={disconnectWallet}\n                  className=\"w-full px-3 py-2 text-sm text-zinc-400 hover:text-[#00FFE0] hover:bg-[#00FFE0]/10 rounded-lg transition-all\"\n                >\n                  Disconnect\n                </button>\n              </div>\n            ) : (\n              <button\n                onClick={handleConnectWallet}\n                disabled={isConnecting || !isLaceAvailable}\n                className=\"w-full flex items-center justify-center gap-2 px-4 py-2 bg-[#00FFE0]/10 border border-[#00FFE0]/30 rounded-lg text-[#00FFE0] hover:bg-[#00FFE0]/20 hover:border-[#00FFE0]/50 transition-all disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                <WalletIcon className=\"w-4 h-4\" />\n                <span className=\"text-sm font-medium\">\n                  {isConnecting ? \"Connecting...\" : isLaceAvailable ? \"Connect Wallet\" : \"Install Lace\"}\n                </span>\n              </button>\n            )}\n          </div>\n        </div>\n      )}\n    </header>\n  );\n};\n\nexport default Header;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1951, "column": 0}, "map": {"version":3,"sources":["file:///Users/vata/HydroX-exchange/frontend/src/components/Footer.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\n\r\nconst Footer = () => {\r\n  const [isOnline, setIsOnline] = useState(true);\r\n\r\n  useEffect(() => {\r\n    const updateOnlineStatus = () => {\r\n      setIsOnline(navigator.onLine);\r\n    };\r\n\r\n    window.addEventListener('online', updateOnlineStatus);\r\n    window.addEventListener('offline', updateOnlineStatus);\r\n    updateOnlineStatus();\r\n\r\n    return () => {\r\n      window.removeEventListener('online', updateOnlineStatus);\r\n      window.removeEventListener('offline', updateOnlineStatus);\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <footer className=\"w-full bg-[#0a0a0a] border-t border-[#1a1a1a] text-zinc-400 px-6 py-2 text-xs shrink-0\">\r\n      <div className=\"flex items-center justify-between w-full\">\r\n        {/* Left side - Links */}\r\n        <div className=\"hidden md:flex items-center space-x-4\">\r\n          <a href=\"#\" className=\"hover:text-[#00FFE0] transition-colors\">API Docs</a>\r\n          <span className=\"text-zinc-700\">|</span>\r\n          <a href=\"#\" className=\"hover:text-[#00FFE0] transition-colors\">Support</a>\r\n          <span className=\"text-zinc-700\">|</span>\r\n          <a href=\"#\" className=\"hover:text-[#00FFE0] transition-colors\">Terms</a>\r\n        </div>\r\n\r\n        {/* Right side - Status */}\r\n        <div className=\"flex items-center space-x-4 ml-auto\">\r\n          {/* Connection status */}\r\n          <div className=\"flex items-center space-x-1.5\">\r\n            <span className={`h-2 w-2 rounded-full ${isOnline ? 'bg-[#00FFE0] animate-pulse shadow-[0_0_8px_rgba(0,255,224,0.6)]' : 'bg-red-500'}`}></span>\r\n            <span className={isOnline ? 'text-[#00FFE0]' : 'text-red-500'}>\r\n              {isOnline ? 'Connected' : 'Disconnected'}\r\n            </span>\r\n          </div>\r\n\r\n          {/* Version */}\r\n          <div className=\"text-zinc-600\">\r\n            v1.0.0\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </footer>\r\n  );\r\n};\r\n\r\nexport default Footer;\r\n"],"names":[],"mappings":";;;;;AAEA;AAFA;;;AAIA,MAAM,SAAS;IACb,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,iNAAQ,EAAC;IAEzC,IAAA,kNAAS,EAAC;QACR,MAAM,qBAAqB;YACzB,YAAY,UAAU,MAAM;QAC9B;QAEA,OAAO,gBAAgB,CAAC,UAAU;QAClC,OAAO,gBAAgB,CAAC,WAAW;QACnC;QAEA,OAAO;YACL,OAAO,mBAAmB,CAAC,UAAU;YACrC,OAAO,mBAAmB,CAAC,WAAW;QACxC;IACF,GAAG,EAAE;IAEL,qBACE,8OAAC;QAAO,WAAU;kBAChB,cAAA,8OAAC;YAAI,WAAU;;8BAEb,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAE,MAAK;4BAAI,WAAU;sCAAyC;;;;;;sCAC/D,8OAAC;4BAAK,WAAU;sCAAgB;;;;;;sCAChC,8OAAC;4BAAE,MAAK;4BAAI,WAAU;sCAAyC;;;;;;sCAC/D,8OAAC;4BAAK,WAAU;sCAAgB;;;;;;sCAChC,8OAAC;4BAAE,MAAK;4BAAI,WAAU;sCAAyC;;;;;;;;;;;;8BAIjE,8OAAC;oBAAI,WAAU;;sCAEb,8OAAC;4BAAI,WAAU;;8CACb,8OAAC;oCAAK,WAAW,CAAC,qBAAqB,EAAE,WAAW,oEAAoE,cAAc;;;;;;8CACtI,8OAAC;oCAAK,WAAW,WAAW,mBAAmB;8CAC5C,WAAW,cAAc;;;;;;;;;;;;sCAK9B,8OAAC;4BAAI,WAAU;sCAAgB;;;;;;;;;;;;;;;;;;;;;;;AAOzC;uCAEe"}}]
}