{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":["file:///Users/vata/HydroX-exchange/frontend/node_modules/%40lucid-evolution/lucid/src/core.ts","file:///Users/vata/HydroX-exchange/frontend/node_modules/%40lucid-evolution/lucid/src/lucid-evolution/utils.ts","file:///Users/vata/HydroX-exchange/frontend/node_modules/%40lucid-evolution/lucid/src/lucid-evolution/LucidEvolution.ts","file:///Users/vata/HydroX-exchange/frontend/node_modules/%40lucid-evolution/lucid/src/tx-builder/internal/Collect.ts","file:///Users/vata/HydroX-exchange/frontend/node_modules/%40lucid-evolution/lucid/src/Errors.ts","file:///Users/vata/HydroX-exchange/frontend/node_modules/%40lucid-evolution/lucid/src/tx-builder/internal/TxUtils.ts","file:///Users/vata/HydroX-exchange/frontend/node_modules/%40lucid-evolution/lucid/src/tx-builder/internal/Service.ts","file:///Users/vata/HydroX-exchange/frontend/node_modules/%40lucid-evolution/lucid/src/tx-builder/internal/Read.ts","file:///Users/vata/HydroX-exchange/frontend/node_modules/%40lucid-evolution/lucid/src/tx-builder/internal/Attach.ts","file:///Users/vata/HydroX-exchange/frontend/node_modules/%40lucid-evolution/lucid/src/tx-builder/internal/Pay.ts","file:///Users/vata/HydroX-exchange/frontend/node_modules/%40lucid-evolution/lucid/src/tx-builder/internal/Mint.ts","file:///Users/vata/HydroX-exchange/frontend/node_modules/%40lucid-evolution/lucid/src/tx-builder/internal/Interval.ts","file:///Users/vata/HydroX-exchange/frontend/node_modules/%40lucid-evolution/lucid/src/tx-builder/internal/Signer.ts","file:///Users/vata/HydroX-exchange/frontend/node_modules/%40lucid-evolution/lucid/src/tx-builder/internal/Stake.ts","file:///Users/vata/HydroX-exchange/frontend/node_modules/%40lucid-evolution/lucid/src/tx-builder/internal/Pool.ts","file:///Users/vata/HydroX-exchange/frontend/node_modules/%40lucid-evolution/lucid/src/tx-builder/internal/Governance.ts","file:///Users/vata/HydroX-exchange/frontend/node_modules/%40lucid-evolution/lucid/src/tx-builder/internal/Metadata.ts","file:///Users/vata/HydroX-exchange/frontend/node_modules/%40lucid-evolution/lucid/src/tx-builder/internal/CompleteTxBuilder.ts","file:///Users/vata/HydroX-exchange/frontend/node_modules/%40lucid-evolution/lucid/src/tx-sign-builder/TxSignBuilder.ts","file:///Users/vata/HydroX-exchange/frontend/node_modules/%40lucid-evolution/lucid/src/tx-sign-builder/internal/CompleteTxSigner.ts","file:///Users/vata/HydroX-exchange/frontend/node_modules/%40lucid-evolution/lucid/src/tx-submit/TxSubmit.ts","file:///Users/vata/HydroX-exchange/frontend/node_modules/%40lucid-evolution/lucid/src/tx-sign-builder/internal/Sign.ts","file:///Users/vata/HydroX-exchange/frontend/node_modules/%40lucid-evolution/lucid/src/tx-builder/TxBuilder.ts","file:///Users/vata/HydroX-exchange/frontend/node_modules/%40lucid-evolution/lucid/src/tx-builder/TxConfig.ts","file:///Users/vata/HydroX-exchange/frontend/node_modules/%40lucid-evolution/lucid/src/index.ts"],"sourcesContent":["import { Effect } from \"effect\";\n\nexport * as CML from \"@anastasia-labs/cardano-multiplatform-lib-nodejs\";\n\nexport const makeReturn = <A, E>(program: Effect.Effect<A, E>) => {\n  return {\n    unsafeRun: () => Effect.runPromise(program),\n    safeRun: () => Effect.runPromise(Effect.either(program)),\n    program: () => program,\n  };\n};\n","import { Json, Provider, UTxO, Unit } from \"@lucid-evolution/core-types\";\nimport { fromUnit, toUnit } from \"@lucid-evolution/utils\";\nimport { Constr, Data } from \"@lucid-evolution/plutus\";\n\nexport const datumOf = async <T = Data>(\n  provider: Provider,\n  utxo: UTxO,\n  type?: T,\n): Promise<T> => {\n  if (!utxo.datum) {\n    if (!utxo.datumHash) {\n      throw new Error(\"This UTxO does not have a datum hash.\");\n    }\n    utxo.datum = await provider.getDatum(utxo.datumHash);\n  }\n  return Data.from<T>(utxo.datum, type);\n};\n\n/** Query CIP-0068 metadata for a specifc asset. */\nexport const metadataOf = async <T = Json>(\n  provider: Provider,\n  unit: Unit,\n): Promise<T> => {\n  const { policyId, name, label } = fromUnit(unit);\n  switch (label) {\n    case 222:\n    case 333:\n    case 444: {\n      const utxo = await provider.getUtxoByUnit(toUnit(policyId, name, 100));\n      const metadata = (await datumOf(provider, utxo)) as Constr<Data>;\n      return Data.toJson(metadata.fields[0]);\n    }\n    default:\n      throw new Error(\"No variant matched.\");\n  }\n};\n","import {\n  Credential,\n  Delegation,\n  Network,\n  OutRef,\n  PrivateKey,\n  ProtocolParameters,\n  Provider,\n  Transaction,\n  TxHash,\n  Unit,\n  UnixTime,\n  UTxO,\n  Wallet,\n  WalletApi,\n} from \"@lucid-evolution/core-types\";\nimport { CML } from \"../core.js\";\nimport { datumOf, metadataOf } from \"./utils.js\";\nimport {\n  createCostModels,\n  PROTOCOL_PARAMETERS_DEFAULT,\n  unixTimeToSlot,\n} from \"@lucid-evolution/utils\";\nimport * as TxBuilder from \"../tx-builder/TxBuilder.js\";\nimport * as TxConfig from \"../tx-builder/TxConfig.js\";\nimport * as TxSignBuilder from \"../tx-sign-builder/TxSignBuilder.js\";\nimport { Data, SLOT_CONFIG_NETWORK } from \"@lucid-evolution/plutus\";\nimport {\n  makeWalletFromAddress,\n  makeWalletFromAPI,\n  makeWalletFromPrivateKey,\n  makeWalletFromSeed,\n} from \"@lucid-evolution/wallet\";\nimport { Emulator } from \"@lucid-evolution/provider\";\nimport { Effect, pipe, Data as _Data } from \"effect\";\nimport { NullableError, UnauthorizedNetwork } from \"../Errors.js\";\nimport { TimeoutExceptionTypeId } from \"effect/Cause\";\n\nexport type LucidEvolution = {\n  config: () => Partial<LucidConfig>;\n  wallet: () => Wallet;\n  overrideUTxOs: (utxos: UTxO[]) => void;\n  switchProvider: (provider: Provider) => Promise<void>;\n  newTx: () => TxBuilder.TxBuilder;\n  fromTx: (tx: Transaction) => TxSignBuilder.TxSignBuilder;\n  selectWallet: {\n    fromSeed: (\n      seed: string,\n      options?: {\n        addressType?: \"Base\" | \"Enterprise\";\n        accountIndex?: number;\n        password?: string;\n      },\n    ) => void;\n    fromPrivateKey: (privateKey: PrivateKey) => void;\n    fromAPI: (walletAPI: WalletApi) => void;\n    fromAddress: (address: string, utxos: UTxO[]) => void;\n  };\n  currentSlot: () => number;\n  unixTimeToSlot: (unixTime: UnixTime) => number;\n  utxosAt: (addressOrCredential: string | Credential) => Promise<UTxO[]>;\n  utxosAtWithUnit: (\n    addressOrCredential: string | Credential,\n    unit: string,\n  ) => Promise<UTxO[]>;\n  utxoByUnit: (unit: string) => Promise<UTxO>;\n  utxosByOutRef: (outRefs: OutRef[]) => Promise<UTxO[]>;\n  delegationAt: (rewardAddress: string) => Promise<Delegation>;\n  awaitTx: (\n    txHash: string,\n    checkInterval?: number | undefined,\n  ) => Promise<boolean>;\n  datumOf: <T extends Data>(utxo: UTxO, type?: T | undefined) => Promise<T>;\n  metadataOf: <T = any>(unit: string) => Promise<T>;\n};\n\nexport type LucidConfig = {\n  provider: Provider;\n  network: Network;\n  wallet: Wallet | undefined;\n  txbuilderconfig: CML.TransactionBuilderConfig;\n  costModels: CML.CostModels;\n  protocolParameters: ProtocolParameters;\n};\n\ntype LucidOptions = {\n  /**\n   * Predefined protocol parameters to use instead of retrieving them from the provider.\n   * If not specified, it will fetch the latest protocol parameters from the provider.\n   */\n  presetProtocolParameters?: ProtocolParameters;\n};\n\n//TODO: turn this to Effect\nexport const Lucid = async (\n  provider?: Provider | undefined,\n  network?: Network,\n  options: LucidOptions = {},\n): Promise<LucidEvolution> => {\n  const protocolParameters: ProtocolParameters | undefined =\n    options.presetProtocolParameters ||\n    (await provider?.getProtocolParameters());\n\n  const costModels = protocolParameters\n    ? createCostModels(protocolParameters.costModels)\n    : undefined;\n  const config: Partial<LucidConfig> = {\n    provider: provider,\n    network: network,\n    wallet: undefined,\n    costModels: costModels,\n    txbuilderconfig:\n      protocolParameters && costModels\n        ? TxConfig.makeTxConfig(protocolParameters, costModels)\n        : undefined,\n    protocolParameters,\n  };\n  if (config.provider && \"slot\" in config.provider) {\n    const emulator: Emulator = config.provider as Emulator;\n    Effect.gen(function* () {\n      const custom = yield* pipe(\n        validateNotNullableNetwork(network),\n        // Effect.filterOrFail(\n        //   (network) => network === \"Custom\",\n        //   () =>\n        //     new UnauthorizedNetwork({\n        //       message: `Expected Custom, received ${String(network)}`,\n        //     }),\n        // ),\n      );\n      SLOT_CONFIG_NETWORK[custom] = {\n        zeroTime: emulator.now(),\n        zeroSlot: 0,\n        slotLength: 1000,\n      };\n    }).pipe(Effect.runSync);\n  }\n  return {\n    config: () => config,\n    wallet: () => config.wallet as Wallet,\n    overrideUTxOs: (utxos: UTxO[]) => config.wallet?.overrideUTxOs(utxos),\n    switchProvider: async (provider: Provider) => {\n      const protocolParam = await provider.getProtocolParameters();\n      const costModels = createCostModels(protocolParam.costModels);\n      config.provider = provider;\n      config.costModels = costModels;\n      config.txbuilderconfig = TxConfig.makeTxConfig(protocolParam, costModels);\n      config.protocolParameters = protocolParam;\n    },\n    newTx: (): TxBuilder.TxBuilder =>\n      Effect.gen(function* () {\n        const provider = yield* Effect.fromNullable(config.provider);\n        const network = yield* Effect.fromNullable(config.network);\n        const costModels = yield* validateNotNullable(\n          config.costModels,\n          \"CostModels are not set in Lucid instance\",\n        );\n        const txbuilderconfig = yield* validateNotNullable(\n          config.txbuilderconfig,\n          \"txbuilderconfig is not set in Lucid instance\",\n        );\n        const protocolParameters = yield* validateNotNullable(\n          config.protocolParameters,\n          \"protocolParameters are not set in Lucid instance\",\n        );\n        return TxBuilder.makeTxBuilder({\n          provider,\n          network,\n          wallet: config.wallet,\n          costModels,\n          txbuilderconfig,\n          protocolParameters,\n        });\n      }).pipe(Effect.runSync),\n    fromTx: (tx: Transaction) =>\n      TxSignBuilder.makeTxSignBuilder(\n        config.wallet,\n        CML.Transaction.from_cbor_hex(tx),\n      ),\n    selectWallet: {\n      fromSeed: (\n        seed: string,\n        options?: {\n          addressType?: \"Base\" | \"Enterprise\";\n          accountIndex?: number;\n          password?: string;\n        },\n      ) =>\n        Effect.gen(function* () {\n          config.wallet = makeWalletFromSeed(\n            yield* validateNotNullableProvider(config.provider),\n            yield* validateNotNullableNetwork(network),\n            seed,\n            options,\n          );\n        }).pipe(Effect.runSync),\n      fromPrivateKey: (privateKey: PrivateKey) =>\n        Effect.gen(function* () {\n          config.wallet = makeWalletFromPrivateKey(\n            yield* validateNotNullableProvider(config.provider),\n            yield* validateNotNullableNetwork(network),\n            privateKey,\n          );\n        }).pipe(Effect.runSync),\n      fromAPI: (walletAPI: WalletApi) =>\n        Effect.gen(function* () {\n          config.wallet = makeWalletFromAPI(\n            yield* validateNotNullableProvider(config.provider),\n            walletAPI,\n          );\n        }).pipe(Effect.runSync),\n      fromAddress: (address: string, utxos: UTxO[]) =>\n        Effect.gen(function* () {\n          config.wallet = makeWalletFromAddress(\n            yield* validateNotNullableProvider(config.provider),\n            yield* validateNotNullableNetwork(network),\n            address,\n            utxos,\n          );\n        }).pipe(Effect.runSync),\n    },\n    currentSlot: () =>\n      pipe(\n        validateNotNullableNetwork(config.network),\n        Effect.map((network) => unixTimeToSlot(network, Date.now())),\n        Effect.runSync,\n      ),\n    unixTimeToSlot: (unixTime: UnixTime) =>\n      pipe(\n        validateNotNullableNetwork(config.network),\n        Effect.map((network) => unixTimeToSlot(network, unixTime)),\n        Effect.runSync,\n      ),\n    utxosAt: (addressOrCredential: string | Credential) =>\n      pipe(\n        validateNotNullableProvider(config.provider),\n        Effect.flatMap((provider) =>\n          Effect.promise(() => provider.getUtxos(addressOrCredential)),\n        ),\n        Effect.runPromise,\n      ),\n    utxosAtWithUnit: (addressOrCredential: string | Credential, unit: Unit) =>\n      pipe(\n        validateNotNullableProvider(config.provider),\n        Effect.flatMap((provider) =>\n          Effect.promise(() =>\n            provider.getUtxosWithUnit(addressOrCredential, unit),\n          ),\n        ),\n        Effect.runPromise,\n      ),\n    utxoByUnit: (unit: Unit) =>\n      pipe(\n        validateNotNullableProvider(config.provider),\n        Effect.flatMap((provider) =>\n          Effect.promise(() => provider.getUtxoByUnit(unit)),\n        ),\n        Effect.runPromise,\n      ),\n    utxosByOutRef: (outRefs: OutRef[]) =>\n      pipe(\n        validateNotNullableProvider(config.provider),\n        Effect.flatMap((provider) =>\n          Effect.promise(() => provider.getUtxosByOutRef(outRefs)),\n        ),\n        Effect.runPromise,\n      ),\n    delegationAt: (rewardAddress: string) =>\n      pipe(\n        validateNotNullableProvider(config.provider),\n        Effect.flatMap((provider) =>\n          Effect.promise(() => provider.getDelegation(rewardAddress)),\n        ),\n        Effect.runPromise,\n      ),\n    awaitTx: (txHash: TxHash, checkInterval?: number) =>\n      pipe(\n        validateNotNullableProvider(config.provider),\n        Effect.flatMap((provider) =>\n          Effect.promise(() => provider.awaitTx(txHash, checkInterval)),\n        ),\n        Effect.runPromise,\n      ),\n    datumOf: <T extends Data>(utxo: UTxO, type?: T | undefined) =>\n      pipe(\n        validateNotNullableProvider(config.provider),\n        Effect.flatMap((provider) =>\n          Effect.promise(() => datumOf(provider, utxo, type)),\n        ),\n        Effect.runPromise,\n      ),\n    metadataOf: (unit: string) =>\n      pipe(\n        validateNotNullableProvider(config.provider),\n        Effect.flatMap((provider) =>\n          Effect.promise(() => metadataOf(provider, unit)),\n        ),\n        Effect.runPromise,\n      ),\n  };\n};\n\nconst validateNotNullable = <T>(value: T | undefined, message: string) =>\n  pipe(\n    Effect.fromNullable(value),\n    Effect.orElseFail(() => new NullableError({ message })),\n  );\n\nconst validateNotNullableNetwork = (network: Network | undefined) =>\n  validateNotNullable(network, \"Network is not set in Lucid instance\");\nconst validateNotNullableProvider = (provider: Provider | undefined) =>\n  validateNotNullable(provider, \"Provider is not set in Lucid instance\");\n","import { Effect, pipe } from \"effect\";\nimport { Data } from \"@lucid-evolution/plutus\";\nimport { utxoToCore } from \"@lucid-evolution/utils\";\nimport { Redeemer, RedeemerBuilder, UTxO } from \"@lucid-evolution/core-types\";\nimport { ERROR_MESSAGE, TxBuilderError } from \"../../Errors.js\";\nimport * as CML from \"@anastasia-labs/cardano-multiplatform-lib-nodejs\";\nimport { resolveDatum, toPartial, toV1, toV2, toV3 } from \"./TxUtils.js\";\nimport { paymentCredentialOf } from \"@lucid-evolution/utils\";\nimport { datumOf } from \"../../lucid-evolution/utils.js\";\nimport { TxConfig } from \"./Service.js\";\n\nexport const collectError = (cause: unknown) =>\n  new TxBuilderError({ cause: `{ Collect: ${cause} }` });\n\nexport const collectFromUTxO =\n  (utxos: UTxO[], collectInputs: Boolean = true) =>\n  (redeemer?: Redeemer) =>\n    Effect.gen(function* () {\n      const { config } = yield* TxConfig;\n      if (utxos.length === 0) yield* collectError(ERROR_MESSAGE.EMPTY_UTXO);\n      for (const utxo of utxos) {\n        // fetch the datum when the datumHash is present\n        const resolvedDatum = yield* resolveDatum(\n          utxo.datumHash,\n          utxo.datum,\n          config.lucidConfig.provider,\n        );\n        utxo.datum = resolvedDatum;\n        // Skip adding UTxO to collectedInputs when building redeemers to prevent duplicate inputs\n        // Store inputs for later use in the txBuilder\n        if (collectInputs) config.collectedInputs.push(utxo);\n        //TODO: Add config.collectedAssets\n        const input = CML.SingleInputBuilder.from_transaction_unspent_output(\n          utxoToCore({ ...utxo, datum: resolvedDatum }),\n        );\n        const credential = paymentCredentialOf(utxo.address);\n\n        if (credential.type == \"Script\") {\n          const script = yield* pipe(\n            Effect.fromNullable(config.scripts.get(credential.hash)),\n            Effect.orElseFail(() =>\n              collectError(\n                collectError(ERROR_MESSAGE.MISSING_SCRIPT(credential.hash)),\n              ),\n            ),\n          );\n          switch (script.type) {\n            case \"Native\":\n              config.txBuilder.add_input(\n                input.native_script(\n                  CML.NativeScript.from_cbor_hex(script.script),\n                  CML.NativeScriptWitnessInfo.assume_signature_count(),\n                ),\n              );\n              break;\n            case \"PlutusV1\": {\n              const red = yield* pipe(\n                Effect.fromNullable(redeemer),\n                Effect.orElseFail(() =>\n                  collectError(ERROR_MESSAGE.MISSING_REDEEMER),\n                ),\n              );\n              config.txBuilder.add_input(\n                input.plutus_script(\n                  toPartial(toV1(script.script), red),\n                  CML.Ed25519KeyHashList.new(),\n                  CML.PlutusData.from_cbor_hex(utxo.datum!),\n                ),\n              );\n              break;\n            }\n            case \"PlutusV2\": {\n              const v2 = toV2(script.script);\n              const red = yield* pipe(\n                Effect.fromNullable(redeemer),\n                Effect.orElseFail(() =>\n                  collectError(ERROR_MESSAGE.MISSING_REDEEMER),\n                ),\n              );\n              const partial = toPartial(v2, red);\n              config.txBuilder.add_input(\n                utxo.datum && utxo.datumHash\n                  ? input.plutus_script(\n                      partial,\n                      CML.Ed25519KeyHashList.new(),\n                      CML.PlutusData.from_cbor_hex(utxo.datum),\n                    )\n                  : input.plutus_script_inline_datum(\n                      partial,\n                      CML.Ed25519KeyHashList.new(),\n                    ),\n              );\n              break;\n            }\n            case \"PlutusV3\": {\n              const v3 = toV3(script.script);\n              const red = yield* pipe(\n                Effect.fromNullable(redeemer),\n                Effect.orElseFail(() =>\n                  collectError(ERROR_MESSAGE.MISSING_REDEEMER),\n                ),\n              );\n              const partial = toPartial(v3, red);\n              config.txBuilder.add_input(\n                utxo.datum && utxo.datumHash\n                  ? input.plutus_script(\n                      partial,\n                      CML.Ed25519KeyHashList.new(),\n                      CML.PlutusData.from_cbor_hex(utxo.datum),\n                    )\n                  : input.plutus_script_inline_datum(\n                      partial,\n                      CML.Ed25519KeyHashList.new(),\n                    ),\n              );\n              break;\n            }\n          }\n        } else {\n          config.txBuilder.add_input(input.payment_key());\n        }\n      }\n    });\n\n/* \"collectFrom\" for RedeemerBuilder needs similar utxo validations as done for Redeemer.\n  These should happen before coin selection; so the effect this function returns is added\n  to the \"programs\".\n*/\nexport const collectFromUTxOPartial = (\n  utxos: UTxO[],\n  redeemerBuilder: RedeemerBuilder,\n) =>\n  Effect.gen(function* () {\n    const { config } = yield* TxConfig;\n    if (utxos.length === 0) yield* collectError(ERROR_MESSAGE.EMPTY_UTXO);\n    if (redeemerBuilder.kind === \"self\") redeemerBuilder.inputs = utxos;\n    for (const utxo of utxos) {\n      if (utxo.datumHash && !utxo.datum) {\n        const data = yield* Effect.tryPromise({\n          try: () => datumOf(config.lucidConfig.provider, utxo),\n          catch: (cause) => collectError({ cause }),\n        });\n        utxo.datum = Data.to(data);\n      }\n      // An array of unspent transaction outputs to be used as inputs when running uplc eval.\n      config.collectedInputs.push(utxo);\n      //TODO: Add config.collectedAssets\n    }\n    // NOTE: If RedeemerBuilder is of kind \"self\" the partial program will be incorrect\n    // however it won't matter as it won't be used if that's the case. But we still need\n    // that RedeemerBuilder in partialPrograms to construct it later during \"complete\"\n    const partialProgram = collectFromUTxO(utxos, false);\n    config.partialPrograms.set(redeemerBuilder, partialProgram);\n  });\n","import { Network } from \"@lucid-evolution/core-types\";\nimport { Data } from \"effect\";\n\nexport const ERROR_MESSAGE = {\n  MULTIPLE_POLICIES:\n    \"MULTIPLE_POLICIES: Only one policy id allowed. You can chain multiple mintAssets functions together if you need to mint assets with different policy ids. \",\n  EMPTY_UTXO:\n    \"EMPTY_UTXO: UTxO array is empty. If a Tx has been recently submitted, consider waiting for chain sync\",\n  MISSING_WALLET:\n    \"MISSING_WALLET: please ensure that your wallet has been properly configured and initialized\",\n  MISSING_REDEEMER: \"MISSING_REDEEMER: redeemer can not be undefined\",\n  DATUM_NOT_SET:\n    \"DATUM_NOT_SET: Script inputs becomes unspendable without datum.\",\n  EMPTY_ASSETS:\n    \"EMPTY_ASSETS: Attempting to pay to an address with an empty assets object\",\n  MISSING_REWARD_TYPE: \"MISSING_REWARD_TYPE: Address type must be Reward type.\",\n  MISSING_STAKE_CREDENTIAL:\n    \"MISSING_STAKE_CREDENTIAL: Address does not contain stake credential\",\n  MISSING_PAYMENT_CREDENTIAL:\n    \"MISSING_PAYMENT_CREDENTIAL: Address does not contain payment credential\",\n  INVALID_METADATA: \"INVALID_METADATA: metadata is invalid\",\n  SCRIPT_CREDENTIAL_NOT_ALLOWED:\n    \"SCRIPT_CREDENTIAL_NOT_ALLOWED: Only verification key credential is allowed\",\n  INVALID_SCRIPT: \"INVALID_SCRIPT: Script is invalid\",\n  EXPECTED_KEY_HASH: \"EXPECTED_KEY_HASH\",\n  INVALID_NETWORK: (\n    address: string,\n    actualNetworkId: number,\n    network: Network,\n  ) =>\n    `Invalid address: ${address}, Expected address with network id ${actualNetworkId}, current network ${network}`,\n  MISSING_SCRIPT: (hash: string) =>\n    `MISSING_SCRIPT: Script not found when building transaction, consider using attach modules. script_hash: ${hash}`,\n  MISSING_POLICY: (policyId: string) =>\n    `MISSING_POLICY: No policy found, policy_id: ${policyId}`,\n} as const;\n\nexport class NullableError extends Data.TaggedError(\"NullableError\")<{\n  readonly message: string;\n}> {}\n\nexport class UnauthorizedNetwork extends Data.TaggedError(\n  \"UnauthorizedNetwork\",\n)<{\n  readonly message: string;\n}> {}\n\nexport class TxBuilderError extends Data.TaggedError(\"TxBuilderError\")<{\n  readonly cause: unknown;\n}> {\n  get message() {\n    return `${this.cause}`;\n  }\n}\nexport type TransactionError = RunTimeError | TxBuilderError;\n\nexport class TxSignerError extends Data.TaggedError(\"TxSignerError\")<{\n  readonly cause: unknown;\n}> {\n  get message() {\n    return `${this.cause}`;\n  }\n}\n\nexport type TransactionSignError = RunTimeError | TxSignerError;\n\nexport class TxSubmitError extends Data.TaggedError(\"TxSubmitError\")<{\n  readonly cause: unknown;\n}> {\n  get message() {\n    return `${this.cause}`;\n  }\n}\n\n//NOTE: RunTimeError is used to catch all unexpected errors primarly from CML library\nexport class RunTimeError extends Data.TaggedError(\"RunTimeError\")<{\n  cause: unknown;\n}> {\n  get message() {\n    return `${this.cause}`;\n  }\n}\n","import * as CML from \"@anastasia-labs/cardano-multiplatform-lib-nodejs\";\nimport { CBORHex } from \"../types.js\";\nimport { Effect, pipe } from \"effect\";\nimport { networkToId, getAddressDetails } from \"@lucid-evolution/utils\";\nimport {\n  Address,\n  AddressDetails,\n  Redeemer,\n  RedeemerBuilder,\n  RewardAddress,\n  Credential,\n  UTxO,\n  Provider,\n} from \"@lucid-evolution/core-types\";\nimport { ERROR_MESSAGE, TxBuilderError } from \"../../Errors.js\";\nimport { LucidConfig } from \"../../lucid-evolution/LucidEvolution.js\";\nimport { TxBuilderConfig } from \"../TxBuilder.js\";\n\nimport * as TxBuilder from \"../TxBuilder.js\";\nimport { TxConfig } from \"./Service.js\";\nimport { Data } from \"@lucid-evolution/plutus\";\n\nexport const txBuilderError = (cause: unknown) =>\n  new TxBuilderError({ cause: `{ TxBuilderError : ${cause} }` });\n\n//TODO: improve error message, utils is used in different modules\nexport const toCMLAddress = (\n  address: Address | RewardAddress,\n  lucidConfig: LucidConfig,\n): Effect.Effect<CML.Address, TxBuilderError, never> =>\n  Effect.gen(function* ($) {\n    const { type } = yield* validateAddressDetails(address, lucidConfig);\n    return type === \"Byron\"\n      ? CML.ByronAddress.from_base58(address).to_address()\n      : CML.Address.from_bech32(address);\n  });\n\nexport const toV1 = (script: string) =>\n  CML.PlutusScript.from_v1(CML.PlutusV1Script.from_cbor_hex(script));\n\nexport const toV2 = (script: string) =>\n  CML.PlutusScript.from_v2(CML.PlutusV2Script.from_cbor_hex(script));\n\nexport const toV3 = (script: string) =>\n  CML.PlutusScript.from_v3(CML.PlutusV3Script.from_cbor_hex(script));\n\nexport const toPartial = (script: CML.PlutusScript, redeemer: CBORHex) =>\n  CML.PartialPlutusWitness.new(\n    CML.PlutusScriptWitness.new_script(script),\n    CML.PlutusData.from_cbor_hex(redeemer),\n  );\n\nexport const handleRedeemerBuilder = (\n  config: TxBuilderConfig,\n  partialProgram: (\n    redeemer?: string | undefined,\n  ) => Effect.Effect<void, TxBuilderError, TxConfig>,\n  redeemer?: string | RedeemerBuilder,\n) => {\n  if (typeof redeemer === \"object\") {\n    config.partialPrograms.set(redeemer, partialProgram);\n  } else {\n    const program = partialProgram(redeemer);\n    config.programs.push(program);\n  }\n};\n\n//NOTE: deprecated\n// export function toCMLTransactionHash(body: CML.TransactionBody) {\n//   const TransactionHash = C.hash_transaction(\n//     C.TransactionBody.from_bytes(fromHex(body.to_cbor_hex())),\n//   );\n//   return CML.TransactionHash.from_hex(TransactionHash.to_hex());\n// }\n\nexport function isEqual(arr1: Uint8Array, arr2: Uint8Array): boolean {\n  if (arr1.length !== arr2.length) {\n    return false;\n  }\n  return arr1.every((value, index) => value === arr2[index]);\n}\n\nexport const validateAddressDetails = (\n  address: Address | RewardAddress,\n  lucidConfig: LucidConfig,\n): Effect.Effect<AddressDetails, TxBuilderError, never> =>\n  Effect.gen(function* ($) {\n    const addressDetails = yield* $(\n      Effect.try({\n        try: () => getAddressDetails(address),\n        catch: (cause) =>\n          new TxBuilderError({\n            cause,\n          }),\n      }),\n    );\n    const actualNetworkId = networkToId(lucidConfig.network);\n    if (addressDetails.networkId !== actualNetworkId)\n      yield* new TxBuilderError({\n        cause: ERROR_MESSAGE.INVALID_NETWORK(\n          address,\n          actualNetworkId,\n          lucidConfig.network,\n        ),\n      });\n\n    return addressDetails;\n  });\n\nexport const processCertificate = (\n  stakeCredential: Credential,\n  config: TxBuilder.TxBuilderConfig,\n  buildCert: (credential: CML.Credential) => CML.SingleCertificateBuilder,\n  redeemer?: Redeemer,\n): Effect.Effect<void, TxBuilderError> =>\n  Effect.gen(function* () {\n    switch (stakeCredential.type) {\n      case \"Key\": {\n        const credential = CML.Credential.new_pub_key(\n          CML.Ed25519KeyHash.from_hex(stakeCredential.hash),\n        );\n        const certBuilder = buildCert(credential);\n        config.txBuilder.add_cert(certBuilder.payment_key());\n        break;\n      }\n\n      case \"Script\": {\n        const credential = CML.Credential.new_script(\n          CML.ScriptHash.from_hex(stakeCredential.hash),\n        );\n        const certBuilder = buildCert(credential);\n\n        const script = yield* pipe(\n          Effect.fromNullable(config.scripts.get(stakeCredential.hash)),\n          Effect.orElseFail(() =>\n            txBuilderError(ERROR_MESSAGE.MISSING_SCRIPT(stakeCredential.hash)),\n          ),\n        );\n\n        const addPlutusCertificate = (\n          scriptVersion: CML.PlutusScript,\n        ): Effect.Effect<void, TxBuilderError> => {\n          return Effect.gen(function* () {\n            const red = yield* pipe(\n              Effect.fromNullable(redeemer),\n              Effect.orElseFail(() =>\n                txBuilderError(ERROR_MESSAGE.MISSING_REDEEMER),\n              ),\n            );\n            config.txBuilder.add_cert(\n              certBuilder.plutus_script(\n                toPartial(scriptVersion, red),\n                CML.Ed25519KeyHashList.new(),\n              ),\n            );\n          });\n        };\n\n        switch (script.type) {\n          case \"PlutusV1\":\n            yield* addPlutusCertificate(toV1(script.script));\n            break;\n\n          case \"PlutusV2\":\n            yield* addPlutusCertificate(toV2(script.script));\n            break;\n          case \"PlutusV3\":\n            yield* addPlutusCertificate(toV3(script.script));\n            break;\n\n          case \"Native\":\n            config.txBuilder.add_cert(\n              certBuilder.native_script(\n                CML.NativeScript.from_cbor_hex(script.script),\n                CML.NativeScriptWitnessInfo.assume_signature_count(),\n              ),\n            );\n            break;\n        }\n        break;\n      }\n    }\n  });\n\nexport const validateAndGetStakeCredential = (\n  rewardAddress: RewardAddress,\n  config: TxBuilder.TxBuilderConfig,\n): Effect.Effect<Credential, TxBuilderError> =>\n  Effect.gen(function* () {\n    const addressDetails = yield* pipe(\n      validateAddressDetails(rewardAddress, config.lucidConfig),\n      Effect.andThen((address) =>\n        address.type !== \"Reward\"\n          ? txBuilderError(ERROR_MESSAGE.MISSING_REWARD_TYPE)\n          : Effect.succeed(address),\n      ),\n    );\n\n    const stakeCredential = yield* pipe(\n      Effect.fromNullable(addressDetails.stakeCredential),\n      Effect.orElseFail(() =>\n        txBuilderError(ERROR_MESSAGE.MISSING_STAKE_CREDENTIAL),\n      ),\n    );\n\n    return stakeCredential;\n  });\n\nexport const resolveDatum = (\n  datumHash: UTxO[\"datumHash\"],\n  datum: UTxO[\"datum\"],\n  provider: Provider,\n) =>\n  Effect.gen(function* () {\n    // Only fetch the datum if the datumHash is present and the datum is not present.\n    if (!datumHash || datum) return datum;\n    return yield* Effect.tryPromise({\n      try: () => provider.getDatum(datumHash),\n      catch: txBuilderError,\n    });\n  });\n","import { Context, Effect } from \"effect\";\nimport { TxBuilderConfig } from \"../TxBuilder.js\";\n\nexport class TxConfig extends Context.Tag(\"TxConfig\")<\n  TxConfig,\n  {\n    readonly config: TxBuilderConfig;\n  }\n>() {}\n","import { Effect } from \"effect\";\nimport { utxoToCore } from \"@lucid-evolution/utils\";\nimport { UTxO } from \"@lucid-evolution/core-types\";\nimport { ERROR_MESSAGE, TxBuilderError } from \"../../Errors.js\";\nimport { resolveDatum } from \"./TxUtils.js\";\nimport { TxConfig } from \"./Service.js\";\n\nexport const readError = (cause: unknown) =>\n  new TxBuilderError({ cause: `{ Read : ${cause} }` });\n\nexport const readFrom = (utxos: UTxO[]) =>\n  Effect.gen(function* () {\n    const { config } = yield* TxConfig;\n    if (utxos.length === 0) yield* readError(ERROR_MESSAGE.EMPTY_UTXO);\n    for (const utxo of utxos) {\n      // fetch the datum when the datumHash is present\n      const resolvedDatum = yield* resolveDatum(\n        utxo.datumHash,\n        utxo.datum,\n        config.lucidConfig.provider,\n      );\n\n      const coreUtxo = utxoToCore({ ...utxo, datum: resolvedDatum });\n      const exists = config.readInputs.some(\n        (input) =>\n          input.txHash === utxo.txHash &&\n          input.outputIndex === utxo.outputIndex,\n      );\n\n      if (!exists) {\n        config.txBuilder.add_reference_input(coreUtxo);\n        // Store inputs for later use in the txBuilder\n        config.readInputs.push(utxo);\n      }\n    }\n  });\n","import { applyDoubleCborEncoding } from \"@lucid-evolution/utils\";\nimport {\n  CertificateValidator,\n  MintingPolicy,\n  ProposeValidator,\n  SpendingValidator,\n  Validator,\n  VoteValidator,\n  WithdrawalValidator,\n} from \"@lucid-evolution/core-types\";\nimport { CML } from \"../../core.js\";\n\nexport const attachScript = ({ type, script }: Validator) => {\n  //TODO: script should be a branded type\n  switch (type) {\n    case \"Native\":\n      return {\n        key: CML.NativeScript.from_cbor_hex(script).hash().to_hex(),\n        value: { type, script },\n      };\n    case \"PlutusV1\":\n      return {\n        key: CML.PlutusV1Script.from_cbor_hex(applyDoubleCborEncoding(script))\n          .hash()\n          .to_hex(),\n        value: { type, script: applyDoubleCborEncoding(script) },\n      };\n    case \"PlutusV2\":\n      return {\n        key: CML.PlutusV2Script.from_cbor_hex(applyDoubleCborEncoding(script))\n          .hash()\n          .to_hex(),\n        value: { type, script: applyDoubleCborEncoding(script) },\n      };\n    case \"PlutusV3\":\n      return {\n        key: CML.PlutusV3Script.from_cbor_hex(applyDoubleCborEncoding(script))\n          .hash()\n          .to_hex(),\n        value: { type, script: applyDoubleCborEncoding(script) },\n      };\n    default:\n      throw new Error(`Exhaustive check failed: Unhandled case ${type}`);\n  }\n};\nexport const attachSpendingValidator = (spendingValidator: SpendingValidator) =>\n  attachScript(spendingValidator);\n\nexport const attachMintingPolicy = (mintingPolicy: MintingPolicy) =>\n  attachScript(mintingPolicy);\n\nexport const attachCertificateValidator = (\n  certValidator: CertificateValidator,\n) => attachScript(certValidator);\n\nexport const attachWithdrawalValidator = (\n  withdrawalValidator: WithdrawalValidator,\n) => attachScript(withdrawalValidator);\n\nexport const attachVoteValidator = (voteValidator: VoteValidator) =>\n  attachScript(voteValidator);\n\nexport const attachProposeValidator = (proposeValidator: ProposeValidator) =>\n  attachScript(proposeValidator);\n","import { Effect, Scope } from \"effect\";\nimport {\n  addAssets,\n  assetsToValue,\n  coreToTxOutput,\n  toScriptRef,\n  valueToAssets,\n} from \"@lucid-evolution/utils\";\nimport { Address, Assets, Script } from \"@lucid-evolution/core-types\";\nimport { OutputDatum } from \"../types.js\";\nimport * as TxBuilder from \"../TxBuilder.js\";\nimport { CML } from \"../../core.js\";\nimport { toCMLAddress } from \"./TxUtils.js\";\nimport { ERROR_MESSAGE, TxBuilderError } from \"../../Errors.js\";\nimport { TxConfig } from \"./Service.js\";\n\nexport const payError = (cause: unknown) =>\n  new TxBuilderError({ cause: `{ Pay: ${cause} }` });\n\n/** Pay to a public key or native script address. */\nexport const payToAddress = (\n  // config: TxBuilder.TxBuilderConfig,\n  address: Address,\n  assets: Assets,\n) =>\n  Effect.gen(function* () {\n    const { config } = yield* TxConfig;\n    const outputBuilder = CML.TransactionOutputBuilder.new()\n      .with_address(yield* toCMLAddress(address, config.lucidConfig))\n      .next();\n\n    if (Object.keys(assets).length == 0)\n      yield* payError(ERROR_MESSAGE.EMPTY_ASSETS);\n\n    const value = assetsToValue(assets);\n    let outputResult = outputBuilder\n      .with_asset_and_min_required_coin(\n        value.multi_asset(),\n        config.lucidConfig.protocolParameters.coinsPerUtxoByte,\n      )\n      .build();\n\n    const setLovelaces = assets[\"lovelace\"];\n    if (setLovelaces) {\n      const minLovelace = outputResult.output().amount().coin();\n      if (setLovelaces > minLovelace) {\n        outputResult = outputBuilder.with_value(value).build();\n      }\n    }\n    // Keep track of actual total output value\n    config.totalOutputAssets = addAssets(\n      config.totalOutputAssets,\n      valueToAssets(outputResult.output().amount()),\n    );\n    config.payToOutputs = [\n      ...config.payToOutputs,\n      coreToTxOutput(outputResult.output()),\n    ];\n    config.txBuilder.add_output(outputResult);\n  });\n\n/** Pay to a public key or native script address with datum or scriptRef. */\nexport const ToAddressWithData = (\n  address: Address,\n  outputDatum?: OutputDatum,\n  assets?: Assets,\n  scriptRef?: Script,\n) =>\n  Effect.gen(function* () {\n    const { config } = yield* TxConfig;\n    //TODO: Test with datumhash\n    const outputBuilder = buildBaseOutput(address, outputDatum, scriptRef);\n\n    assets ??= {};\n    const value = assetsToValue(assets);\n    let outputResult = outputBuilder\n      .with_asset_and_min_required_coin(\n        value.multi_asset(),\n        config.lucidConfig.protocolParameters.coinsPerUtxoByte,\n      )\n      .build();\n\n    const setLovelaces = assets[\"lovelace\"];\n    if (setLovelaces) {\n      const minLovelace = outputResult.output().amount().coin();\n      if (setLovelaces > minLovelace) {\n        outputResult = outputBuilder.with_value(value).build();\n      }\n    }\n    // Keep track of actual total output value\n    config.totalOutputAssets = addAssets(\n      config.totalOutputAssets,\n      valueToAssets(outputResult.output().amount()),\n    );\n    config.payToOutputs = [\n      ...config.payToOutputs,\n      coreToTxOutput(outputResult.output()),\n    ];\n    config.txBuilder.add_output(outputResult);\n  });\n\n/** Pay to a plutus script address with datum or scriptRef. */\nexport const ToContract = (\n  address: Address,\n  outputDatum?: OutputDatum,\n  assets?: Assets,\n  scriptRef?: Script,\n) => ToAddressWithData(address, outputDatum, assets, scriptRef);\n\nexport const buildBaseOutput = (\n  address: Address,\n  outputDatum?: OutputDatum,\n  scriptRef?: Script,\n) => {\n  let baseBuilder: CML.TransactionOutputBuilder;\n  const addressBuilder = CML.TransactionOutputBuilder.new().with_address(\n    CML.Address.from_bech32(address),\n  );\n  if (outputDatum) {\n    if (outputDatum.value.trim() === \"\") {\n      throw new Error(\n        \"datum value is missing. Please provide a non-empty cbor hex data.\",\n      );\n    }\n    switch (outputDatum.kind) {\n      case \"hash\": {\n        const datumOption = CML.DatumOption.new_hash(\n          CML.DatumHash.from_hex(outputDatum.value),\n        );\n        baseBuilder = addressBuilder.with_data(datumOption);\n        break;\n      }\n      case \"asHash\": {\n        const plutusData = CML.PlutusData.from_cbor_hex(outputDatum.value);\n        baseBuilder = addressBuilder.with_communication_data(plutusData);\n        break;\n      }\n      case \"inline\": {\n        const plutusData = CML.PlutusData.from_cbor_hex(outputDatum.value);\n        const datumOption = CML.DatumOption.new_datum(plutusData);\n        baseBuilder = addressBuilder.with_data(datumOption);\n        break;\n      }\n      default:\n        throw new Error(`Unknown outputDatum: ${outputDatum}`);\n    }\n  } else {\n    baseBuilder = addressBuilder;\n  }\n\n  return scriptRef\n    ? baseBuilder.with_reference_script(toScriptRef(scriptRef)).next()\n    : baseBuilder.next();\n};\n","import { Effect, pipe } from \"effect\";\nimport { fromHex } from \"@lucid-evolution/core-utils\";\nimport { Assets, Redeemer } from \"@lucid-evolution/core-types\";\nimport * as CML from \"@anastasia-labs/cardano-multiplatform-lib-nodejs\";\nimport { toPartial, toV1, toV2, toV3 } from \"./TxUtils.js\";\nimport { ERROR_MESSAGE, TxBuilderError } from \"../../Errors.js\";\nimport * as TxBuilder from \"../TxBuilder.js\";\nimport { addAssets } from \"@lucid-evolution/utils\";\nimport { TxConfig } from \"./Service.js\";\n\nexport const mintError = (cause: unknown) =>\n  new TxBuilderError({ cause: `{ Mint: ${cause} }` });\n\n/**\n * All assets should be of the same policy id.\n * You can chain mintAssets functions together if you need to mint assets with different policy ids.\n * If the plutus script doesn't need a redeemer, you still need to specifiy the void redeemer.\n */\nexport const mintAssets = (assets: Assets) => (redeemer?: Redeemer) =>\n  Effect.gen(function* () {\n    const { config } = yield* TxConfig;\n    const units = Object.keys(assets);\n    const policyId = units[0].slice(0, 56);\n    const mintAssets = CML.MapAssetNameToNonZeroInt64.new();\n    for (const unit of units) {\n      if (unit.slice(0, 56) !== policyId) {\n        yield* mintError(ERROR_MESSAGE.MULTIPLE_POLICIES);\n      }\n      mintAssets.insert(CML.AssetName.from_hex(unit.slice(56)), assets[unit]);\n    }\n    const mintBuilder = CML.SingleMintBuilder.new(mintAssets);\n    const policy = yield* pipe(\n      Effect.fromNullable(config.scripts.get(policyId)),\n      Effect.orElseFail(() =>\n        mintError(ERROR_MESSAGE.MISSING_POLICY(policyId)),\n      ),\n    );\n    switch (policy.type) {\n      case \"Native\":\n        config.txBuilder.add_mint(\n          mintBuilder.native_script(\n            CML.NativeScript.from_cbor_hex(policy.script),\n            CML.NativeScriptWitnessInfo.assume_signature_count(),\n          ),\n        );\n        break;\n\n      case \"PlutusV1\": {\n        const red = yield* pipe(\n          Effect.fromNullable(redeemer),\n          Effect.orElseFail(() => mintError(ERROR_MESSAGE.MISSING_REDEEMER)),\n        );\n        config.txBuilder.add_mint(\n          mintBuilder.plutus_script(\n            toPartial(toV1(policy.script), red),\n            CML.Ed25519KeyHashList.new(),\n          ),\n        );\n        break;\n      }\n      case \"PlutusV2\": {\n        const red = yield* pipe(\n          Effect.fromNullable(redeemer),\n          Effect.orElseFail(() => mintError(ERROR_MESSAGE.MISSING_REDEEMER)),\n        );\n        config.txBuilder.add_mint(\n          mintBuilder.plutus_script(\n            toPartial(toV2(policy.script), red),\n            CML.Ed25519KeyHashList.new(),\n          ),\n        );\n        break;\n      }\n      case \"PlutusV3\": {\n        const red = yield* pipe(\n          Effect.fromNullable(redeemer),\n          Effect.orElseFail(() => mintError(ERROR_MESSAGE.MISSING_REDEEMER)),\n        );\n        config.txBuilder.add_mint(\n          mintBuilder.plutus_script(\n            toPartial(toV3(policy.script), red),\n            CML.Ed25519KeyHashList.new(),\n          ),\n        );\n        break;\n      }\n    }\n  });\n","import { Effect } from \"effect\";\nimport { UnixTime } from \"@lucid-evolution/core-types\";\nimport * as TxBuilder from \"../TxBuilder.js\";\nimport { unixTimeToSlot } from \"@lucid-evolution/utils\";\nimport { TxConfig } from \"./Service.js\";\n\nexport const validFrom = (unixTime: UnixTime) =>\n  Effect.gen(function* () {\n    const { config } = yield* TxConfig;\n    const slot = unixTimeToSlot(config.lucidConfig.network, unixTime);\n    config.txBuilder.set_validity_start_interval(BigInt(slot));\n  });\nexport const validTo = (unixTime: UnixTime) =>\n  Effect.gen(function* () {\n    const { config } = yield* TxConfig;\n    const slot = unixTimeToSlot(config.lucidConfig.network, unixTime);\n    config.txBuilder.set_ttl(BigInt(slot));\n  });\n","import {\n  Address,\n  PaymentKeyHash,\n  RewardAddress,\n  StakeKeyHash,\n} from \"@lucid-evolution/core-types\";\nimport * as TxBuilder from \"../TxBuilder.js\";\nimport { Effect, pipe } from \"effect\";\nimport * as CML from \"@anastasia-labs/cardano-multiplatform-lib-nodejs\";\nimport { ERROR_MESSAGE, TxBuilderError } from \"../../Errors.js\";\nimport { validateAddressDetails } from \"./TxUtils.js\";\nimport { TxConfig } from \"./Service.js\";\n\nexport const addSignerError = (cause: unknown) =>\n  new TxBuilderError({ cause: `{ Signer: ${cause} }` });\n\nexport const addSigner = (address: Address | RewardAddress) =>\n  Effect.gen(function* () {\n    const { config } = yield* TxConfig;\n    const addressDetails = yield* validateAddressDetails(\n      address,\n      config.lucidConfig,\n    );\n\n    const credential =\n      addressDetails.type === \"Reward\"\n        ? yield* pipe(\n            Effect.fromNullable(addressDetails.stakeCredential),\n            Effect.orElseFail(() =>\n              addSignerError(ERROR_MESSAGE.MISSING_STAKE_CREDENTIAL),\n            ),\n          )\n        : yield* pipe(\n            Effect.fromNullable(addressDetails.paymentCredential),\n            Effect.orElseFail(() =>\n              addSignerError(ERROR_MESSAGE.MISSING_PAYMENT_CREDENTIAL),\n            ),\n          );\n\n    if (credential.type === \"Script\")\n      yield* addSignerError(ERROR_MESSAGE.SCRIPT_CREDENTIAL_NOT_ALLOWED);\n\n    return credential.hash;\n  }).pipe(Effect.flatMap((keyHash) => addSignerKey(keyHash)));\n\n/** Add a payment or stake key hash as a required signer of the transaction. */\nexport const addSignerKey = (keyHash: PaymentKeyHash | StakeKeyHash) =>\n  Effect.gen(function* () {\n    const { config } = yield* TxConfig;\n    config.txBuilder.add_required_signer(CML.Ed25519KeyHash.from_hex(keyHash));\n  });\n","import { Lovelace, Redeemer, RewardAddress } from \"@lucid-evolution/core-types\";\nimport * as TxBuilder from \"../TxBuilder.js\";\nimport { Effect, pipe } from \"effect\";\nimport { ERROR_MESSAGE, TxBuilderError } from \"../../Errors.js\";\nimport * as CML from \"@anastasia-labs/cardano-multiplatform-lib-nodejs\";\nimport {\n  toPartial,\n  toV1,\n  toV2,\n  toV3,\n  validateAddressDetails,\n} from \"./TxUtils.js\";\nimport { TxConfig } from \"./Service.js\";\n\nexport const stakeError = (cause: unknown) =>\n  new TxBuilderError({ cause: `{ Stake: ${cause} }` });\n\nexport const registerStake = (rewardAddress: RewardAddress) =>\n  Effect.gen(function* () {\n    const { config } = yield* TxConfig;\n    const addressDetails = yield* pipe(\n      validateAddressDetails(rewardAddress, config.lucidConfig),\n      Effect.andThen((address) =>\n        address.type !== \"Reward\"\n          ? stakeError(ERROR_MESSAGE.MISSING_REWARD_TYPE)\n          : Effect.succeed(address),\n      ),\n    );\n\n    const stakeCredential = yield* pipe(\n      Effect.fromNullable(addressDetails.stakeCredential),\n      Effect.orElseFail(() =>\n        stakeError(ERROR_MESSAGE.MISSING_STAKE_CREDENTIAL),\n      ),\n    );\n\n    const credential =\n      stakeCredential.type === \"Key\"\n        ? CML.Credential.new_pub_key(\n            CML.Ed25519KeyHash.from_hex(stakeCredential.hash),\n          )\n        : CML.Credential.new_script(\n            CML.ScriptHash.from_hex(stakeCredential.hash),\n          );\n    const certBuilder = CML.SingleCertificateBuilder.new(\n      CML.Certificate.new_stake_registration(credential),\n    );\n    config.txBuilder.add_cert(certBuilder.skip_witness());\n  });\n\nexport const deRegisterStake = (\n  rewardAddress: RewardAddress,\n  redeemer?: Redeemer,\n) =>\n  Effect.gen(function* () {\n    const { config } = yield* TxConfig;\n    const addressDetails = yield* pipe(\n      validateAddressDetails(rewardAddress, config.lucidConfig),\n      Effect.andThen((address) =>\n        address.type !== \"Reward\"\n          ? stakeError(ERROR_MESSAGE.MISSING_REWARD_TYPE)\n          : Effect.succeed(address),\n      ),\n    );\n\n    const stakeCredential = yield* pipe(\n      Effect.fromNullable(addressDetails.stakeCredential),\n      Effect.orElseFail(() =>\n        stakeError(ERROR_MESSAGE.MISSING_STAKE_CREDENTIAL),\n      ),\n    );\n\n    const createCertBuilder = (\n      credential: CML.Credential,\n      config: TxBuilder.TxBuilderConfig,\n    ): CML.SingleCertificateBuilder => {\n      return CML.SingleCertificateBuilder.new(\n        CML.Certificate.new_unreg_cert(\n          credential,\n          config.lucidConfig.protocolParameters.keyDeposit,\n        ),\n      );\n    };\n\n    switch (stakeCredential.type) {\n      case \"Key\": {\n        const credential = CML.Credential.new_pub_key(\n          CML.Ed25519KeyHash.from_hex(stakeCredential.hash),\n        );\n        const certBuilder = createCertBuilder(credential, config);\n        config.txBuilder.add_cert(certBuilder.payment_key());\n        break;\n      }\n\n      case \"Script\": {\n        const credential = CML.Credential.new_script(\n          CML.ScriptHash.from_hex(stakeCredential.hash),\n        );\n        const certBuilder = createCertBuilder(credential, config);\n        const script = yield* pipe(\n          Effect.fromNullable(config.scripts.get(stakeCredential.hash)),\n          Effect.orElseFail(() =>\n            stakeError(ERROR_MESSAGE.MISSING_SCRIPT(stakeCredential.hash)),\n          ),\n        );\n        const handleRedeemer = () =>\n          pipe(\n            Effect.fromNullable(redeemer),\n            Effect.orElseFail(() => stakeError(ERROR_MESSAGE.MISSING_REDEEMER)),\n          );\n        switch (script.type) {\n          case \"PlutusV1\": {\n            const red = yield* handleRedeemer();\n            config.txBuilder.add_cert(\n              certBuilder.plutus_script(\n                toPartial(toV1(script.script), red),\n                CML.Ed25519KeyHashList.new(),\n              ),\n            );\n            break;\n          }\n\n          case \"PlutusV2\": {\n            const red = yield* handleRedeemer();\n            config.txBuilder.add_cert(\n              certBuilder.plutus_script(\n                toPartial(toV2(script.script), red),\n                CML.Ed25519KeyHashList.new(),\n              ),\n            );\n            break;\n          }\n          case \"PlutusV3\": {\n            const red = yield* handleRedeemer();\n            config.txBuilder.add_cert(\n              certBuilder.plutus_script(\n                toPartial(toV3(script.script), red),\n                CML.Ed25519KeyHashList.new(),\n              ),\n            );\n            break;\n          }\n          case \"Native\": {\n            config.txBuilder.add_cert(\n              certBuilder.native_script(\n                CML.NativeScript.from_cbor_hex(script.script),\n                CML.NativeScriptWitnessInfo.assume_signature_count(),\n              ),\n            );\n            break;\n          }\n        }\n      }\n    }\n  });\n\nexport const withdraw =\n  (rewardAddress: RewardAddress, amount: Lovelace) => (redeemer?: Redeemer) =>\n    Effect.gen(function* () {\n      const { config } = yield* TxConfig;\n      const addressDetails = yield* pipe(\n        validateAddressDetails(rewardAddress, config.lucidConfig),\n        Effect.andThen((address) =>\n          address.type !== \"Reward\"\n            ? stakeError(ERROR_MESSAGE.MISSING_REWARD_TYPE)\n            : Effect.succeed(address),\n        ),\n      );\n\n      const withdrawBuilder = yield* pipe(\n        Effect.fromNullable(\n          CML.RewardAddress.from_address(\n            CML.Address.from_bech32(rewardAddress),\n          ),\n        ),\n        Effect.orElseFail(() =>\n          stakeError(ERROR_MESSAGE.MISSING_STAKE_CREDENTIAL),\n        ),\n        Effect.andThen((address) =>\n          CML.SingleWithdrawalBuilder.new(address, amount),\n        ),\n      );\n\n      const stakeCredential = yield* pipe(\n        Effect.fromNullable(addressDetails.stakeCredential),\n        Effect.orElseFail(() =>\n          stakeError(ERROR_MESSAGE.MISSING_STAKE_CREDENTIAL),\n        ),\n      );\n\n      const handleRedeemer = () =>\n        pipe(\n          Effect.fromNullable(redeemer),\n          Effect.orElseFail(() => stakeError(ERROR_MESSAGE.MISSING_REDEEMER)),\n        );\n\n      switch (stakeCredential.type) {\n        case \"Key\": {\n          config.txBuilder.add_withdrawal(withdrawBuilder.payment_key());\n          break;\n        }\n\n        case \"Script\": {\n          const script = yield* pipe(\n            Effect.fromNullable(config.scripts.get(stakeCredential.hash)),\n            Effect.orElseFail(() =>\n              stakeError(ERROR_MESSAGE.MISSING_SCRIPT(stakeCredential.hash)),\n            ),\n          );\n\n          switch (script.type) {\n            case \"PlutusV1\": {\n              const red = yield* handleRedeemer();\n              config.txBuilder.add_withdrawal(\n                withdrawBuilder.plutus_script(\n                  toPartial(toV1(script.script), red),\n                  CML.Ed25519KeyHashList.new(),\n                ),\n              );\n              break;\n            }\n\n            case \"PlutusV2\": {\n              const red = yield* handleRedeemer();\n              config.txBuilder.add_withdrawal(\n                withdrawBuilder.plutus_script(\n                  toPartial(toV2(script.script), red),\n                  CML.Ed25519KeyHashList.new(),\n                ),\n              );\n              break;\n            }\n\n            case \"PlutusV3\": {\n              const red = yield* handleRedeemer();\n              config.txBuilder.add_withdrawal(\n                withdrawBuilder.plutus_script(\n                  toPartial(toV3(script.script), red),\n                  CML.Ed25519KeyHashList.new(),\n                ),\n              );\n              break;\n            }\n            case \"Native\": {\n              config.txBuilder.add_withdrawal(\n                withdrawBuilder.native_script(\n                  CML.NativeScript.from_cbor_hex(script.script),\n                  CML.NativeScriptWitnessInfo.assume_signature_count(),\n                ),\n              );\n              break;\n            }\n          }\n        }\n      }\n    });\n","import {\n  PoolId,\n  PoolParams,\n  Redeemer,\n  RewardAddress,\n} from \"@lucid-evolution/core-types\";\nimport { ERROR_MESSAGE, TxBuilderError } from \"../../Errors.js\";\nimport * as TxBuilder from \"../TxBuilder.js\";\nimport { Effect, pipe } from \"effect\";\nimport {\n  toCMLAddress,\n  toPartial,\n  toV1,\n  toV2,\n  toV3,\n  validateAddressDetails,\n} from \"./TxUtils.js\";\nimport * as CML from \"@anastasia-labs/cardano-multiplatform-lib-nodejs\";\nimport { LucidConfig } from \"../../lucid-evolution/LucidEvolution.js\";\nimport { fromText } from \"@lucid-evolution/core-utils\";\nimport { TxConfig } from \"./Service.js\";\n\nexport const poolError = (cause: unknown) =>\n  new TxBuilderError({ cause: `{ Pool : ${cause} }` });\n\nexport const delegateTo = (\n  rewardAddress: RewardAddress,\n  poolId: PoolId,\n  redeemer?: Redeemer,\n) =>\n  Effect.gen(function* () {\n    const { config } = yield* TxConfig;\n    const addressDetails = yield* pipe(\n      validateAddressDetails(rewardAddress, config.lucidConfig),\n      Effect.andThen((address) =>\n        address.type !== \"Reward\"\n          ? poolError(ERROR_MESSAGE.MISSING_REWARD_TYPE)\n          : Effect.succeed(address),\n      ),\n    );\n\n    const stakeCredential = yield* pipe(\n      Effect.fromNullable(addressDetails.stakeCredential),\n      Effect.orElseFail(() =>\n        poolError(ERROR_MESSAGE.MISSING_STAKE_CREDENTIAL),\n      ),\n    );\n\n    switch (stakeCredential.type) {\n      case \"Key\": {\n        const credential = CML.Credential.new_pub_key(\n          CML.Ed25519KeyHash.from_hex(stakeCredential.hash),\n        );\n        const certBuilder = CML.SingleCertificateBuilder.new(\n          CML.Certificate.new_stake_delegation(\n            credential,\n            CML.Ed25519KeyHash.from_bech32(poolId),\n          ),\n        );\n        config.txBuilder.add_cert(certBuilder.payment_key());\n        break;\n      }\n\n      case \"Script\": {\n        const credential = CML.Credential.new_script(\n          CML.ScriptHash.from_hex(stakeCredential.hash),\n        );\n        const certBuilder = CML.SingleCertificateBuilder.new(\n          CML.Certificate.new_stake_delegation(\n            credential,\n            CML.Ed25519KeyHash.from_bech32(poolId),\n          ),\n        );\n        const script = yield* pipe(\n          Effect.fromNullable(config.scripts.get(stakeCredential.hash)),\n          Effect.orElseFail(() =>\n            poolError(ERROR_MESSAGE.MISSING_SCRIPT(stakeCredential.hash)),\n          ),\n        );\n        const handleRedeemer = () =>\n          pipe(\n            Effect.fromNullable(redeemer),\n            Effect.orElseFail(() => poolError(ERROR_MESSAGE.MISSING_REDEEMER)),\n          );\n        switch (script.type) {\n          case \"PlutusV1\": {\n            const red = yield* handleRedeemer();\n            config.txBuilder.add_cert(\n              certBuilder.plutus_script(\n                toPartial(toV1(script.script), red),\n                CML.Ed25519KeyHashList.new(),\n              ),\n            );\n            break;\n          }\n\n          case \"PlutusV2\": {\n            const red = yield* handleRedeemer();\n            config.txBuilder.add_cert(\n              certBuilder.plutus_script(\n                toPartial(toV2(script.script), red),\n                CML.Ed25519KeyHashList.new(),\n              ),\n            );\n            break;\n          }\n\n          case \"PlutusV3\": {\n            const red = yield* handleRedeemer();\n            config.txBuilder.add_cert(\n              certBuilder.plutus_script(\n                toPartial(toV3(script.script), red),\n                CML.Ed25519KeyHashList.new(),\n              ),\n            );\n            break;\n          }\n          case \"Native\": {\n            config.txBuilder.add_cert(\n              certBuilder.native_script(\n                CML.NativeScript.from_cbor_hex(script.script),\n                CML.NativeScriptWitnessInfo.assume_signature_count(),\n              ),\n            );\n            break;\n          }\n        }\n      }\n    }\n  });\n\n/** Register a stake pool. A pool deposit is required. The metadataUrl needs to be hosted already before making the registration. */\nexport const registerPool = (poolParams: PoolParams) =>\n  Effect.gen(function* () {\n    const { config } = yield* TxConfig;\n    const poolRegistration = yield* createPoolRegistration(\n      poolParams,\n      config.lucidConfig,\n    );\n    const certBuilder = CML.SingleCertificateBuilder.new(\n      CML.Certificate.new_pool_registration(poolRegistration.pool_params()),\n    );\n\n    config.txBuilder.add_cert(certBuilder.skip_witness());\n  });\n\nconst createPoolRegistration = (poolParams: PoolParams, lucid: LucidConfig) =>\n  Effect.gen(function* () {\n    const poolOwners = CML.Ed25519KeyHashList.new();\n    for (const owner of poolParams.owners) {\n      const addressDetails = yield* validateAddressDetails(owner, lucid);\n      const stakeCredential = yield* pipe(\n        Effect.fromNullable(addressDetails.stakeCredential),\n        Effect.orElseFail(() =>\n          poolError(ERROR_MESSAGE.MISSING_STAKE_CREDENTIAL),\n        ),\n      );\n      stakeCredential.type === \"Key\"\n        ? poolOwners.add(CML.Ed25519KeyHash.from_hex(stakeCredential.hash))\n        : poolError(ERROR_MESSAGE.SCRIPT_CREDENTIAL_NOT_ALLOWED);\n    }\n    const metadataHash = yield* getMetadataHash(poolParams.metadataUrl);\n    const relays = CML.RelayList.new();\n    for (const relay of poolParams.relays) {\n      switch (relay.type) {\n        case \"SingleHostIp\": {\n          //TODO: missing test\n          const ipV4 = relay.ipV4\n            ? CML.Ipv4.from_cbor_bytes(\n                new Uint8Array(relay.ipV4.split(\".\").map((b) => parseInt(b))),\n              )\n            : undefined;\n          //TODO: missing test\n          const ipV6 = relay.ipV6\n            ? CML.Ipv6.from_cbor_hex(relay.ipV6.replaceAll(\":\", \"\"))\n            : undefined;\n          relays.add(CML.Relay.new_single_host_addr(relay.port, ipV4, ipV6));\n          break;\n        }\n        //TODO: missing test\n        case \"SingleHostDomainName\": {\n          relays.add(\n            CML.Relay.new_single_host_name(\n              relay.port,\n              CML.DNSName.from_cbor_hex(fromText(relay.domainName!)),\n            ),\n          );\n          break;\n        }\n        case \"MultiHost\": {\n          relays.add(\n            CML.Relay.new_multi_host_name(\n              CML.DNSName.from_cbor_hex(fromText(relay.domainName!)),\n            ),\n          );\n          break;\n        }\n      }\n    }\n    return CML.PoolRegistration.new(\n      CML.PoolParams.new(\n        CML.Ed25519KeyHash.from_bech32(poolParams.poolId),\n        CML.VRFKeyHash.from_hex(poolParams.vrfKeyHash),\n        poolParams.pledge,\n        poolParams.cost,\n        CML.UnitInterval.new(\n          BigInt(poolParams.margin),\n          BigInt(poolParams.margin),\n        ),\n        CML.RewardAddress.from_address(\n          yield* toCMLAddress(poolParams.rewardAddress, lucid),\n        )!,\n        poolOwners,\n        relays,\n        metadataHash\n          ? CML.PoolMetadata.new(\n              CML.Url.from_cbor_hex(fromText(poolParams.metadataUrl!)),\n              metadataHash,\n            )\n          : undefined,\n      ),\n    );\n  });\n\nconst getMetadataHash = (metadataUrl?: string) =>\n  Effect.gen(function* () {\n    if (metadataUrl) {\n      const metadata = yield* pipe(\n        Effect.tryPromise({\n          try: () => fetch(metadataUrl),\n          catch: (cause) => poolError(cause),\n        }),\n        Effect.andThen((resp) => Effect.promise(() => resp.arrayBuffer())),\n      );\n      const metadataHash = CML.PoolMetadataHash.from_raw_bytes(\n        new Uint8Array(metadata),\n      );\n      return metadataHash;\n    } else {\n      return null;\n    }\n  });\n","import {\n  Anchor,\n  DRep,\n  PoolId,\n  Redeemer,\n  RewardAddress,\n  Credential,\n  AlwaysAbstain,\n  AlwaysNoConfidence,\n} from \"@lucid-evolution/core-types\";\nimport * as CML from \"@anastasia-labs/cardano-multiplatform-lib-nodejs\";\nimport { TxBuilderError } from \"../../Errors.js\";\nimport { Effect } from \"effect\";\nimport {\n  processCertificate,\n  validateAndGetStakeCredential,\n} from \"./TxUtils.js\";\nimport { TxConfig } from \"./Service.js\";\n\nexport const isDRepCredential = (deleg: DRep): deleg is Credential =>\n  !(\"__typename\" in deleg);\n\nexport const isDRepAlwaysAbstain = (deleg: DRep): deleg is AlwaysAbstain =>\n  !isDRepCredential(deleg) && deleg.__typename === \"AlwaysAbstain\";\n\nexport const isDRepAlwaysNoConfidence = (\n  deleg: DRep,\n): deleg is AlwaysNoConfidence =>\n  !isDRepCredential(deleg) && deleg.__typename === \"AlwaysNoConfidence\";\n\nexport const toCMLDRep = (drep: DRep): CML.DRep => {\n  if (isDRepAlwaysAbstain(drep)) {\n    return CML.DRep.new_always_abstain();\n  } else if (isDRepAlwaysNoConfidence(drep)) {\n    return CML.DRep.new_always_no_confidence();\n  } else if (isDRepCredential(drep)) {\n    switch (drep.type) {\n      case \"Key\":\n        return CML.DRep.new_key(CML.Ed25519KeyHash.from_hex(drep.hash));\n      case \"Script\":\n        return CML.DRep.new_script(CML.ScriptHash.from_hex(drep.hash));\n      default:\n        throw new Error(`Unsupported DRep type: ${drep.type}`);\n    }\n  }\n  throw new Error(`Unexpected DRep type: ${drep}`);\n};\n\nexport const governanceError = (cause: unknown) =>\n  new TxBuilderError({ cause: `{ Governance: ${cause} }` });\n\nexport const delegateVoteToDRep = (\n  rewardAddress: RewardAddress,\n  drep: DRep,\n  redeemer?: Redeemer,\n) =>\n  Effect.gen(function* () {\n    const { config } = yield* TxConfig;\n    const stakeCredential = yield* validateAndGetStakeCredential(\n      rewardAddress,\n      config,\n    );\n    const cmlDRep: CML.DRep = toCMLDRep(drep);\n    const buildCert = (credential: CML.Credential) =>\n      CML.SingleCertificateBuilder.new(\n        CML.Certificate.new_vote_deleg_cert(credential, cmlDRep),\n      );\n\n    yield* processCertificate(stakeCredential, config, buildCert, redeemer);\n  });\n\nexport const delegateVoteToPoolAndDRep = (\n  rewardAddress: RewardAddress,\n  poolId: PoolId,\n  drep: DRep,\n  redeemer?: Redeemer,\n) =>\n  Effect.gen(function* () {\n    const { config } = yield* TxConfig;\n    const stakeCredential = yield* validateAndGetStakeCredential(\n      rewardAddress,\n      config,\n    );\n    const cmlDRep = toCMLDRep(drep);\n    const buildCert = (credential: CML.Credential) =>\n      CML.SingleCertificateBuilder.new(\n        CML.Certificate.new_stake_vote_deleg_cert(\n          credential,\n          CML.Ed25519KeyHash.from_bech32(poolId),\n          cmlDRep,\n        ),\n      );\n\n    yield* processCertificate(stakeCredential, config, buildCert, redeemer);\n  });\n\nexport const registerAndDelegateToPool = (\n  rewardAddress: RewardAddress,\n  poolId: PoolId,\n  redeemer?: Redeemer,\n) =>\n  Effect.gen(function* () {\n    const { config } = yield* TxConfig;\n    const stakeCredential = yield* validateAndGetStakeCredential(\n      rewardAddress,\n      config,\n    );\n\n    const buildCert = (credential: CML.Credential) =>\n      CML.SingleCertificateBuilder.new(\n        CML.Certificate.new_stake_reg_deleg_cert(\n          credential,\n          CML.Ed25519KeyHash.from_bech32(poolId),\n          config.lucidConfig.protocolParameters.keyDeposit,\n        ),\n      );\n\n    yield* processCertificate(stakeCredential, config, buildCert, redeemer);\n  });\n\nexport const registerAndDelegateToDRep = (\n  rewardAddress: RewardAddress,\n  drep: DRep,\n  redeemer?: Redeemer,\n) =>\n  Effect.gen(function* () {\n    const { config } = yield* TxConfig;\n    const stakeCredential = yield* validateAndGetStakeCredential(\n      rewardAddress,\n      config,\n    );\n    const cmlDRep = toCMLDRep(drep);\n    const buildCert = (credential: CML.Credential) =>\n      CML.SingleCertificateBuilder.new(\n        CML.Certificate.new_vote_reg_deleg_cert(\n          credential,\n          cmlDRep,\n          config.lucidConfig.protocolParameters.keyDeposit,\n        ),\n      );\n\n    yield* processCertificate(stakeCredential, config, buildCert, redeemer);\n  });\n\nexport const registerAndDelegateToPoolAndDRep = (\n  rewardAddress: RewardAddress,\n  poolId: PoolId,\n  drep: DRep,\n  redeemer?: Redeemer,\n) =>\n  Effect.gen(function* () {\n    const { config } = yield* TxConfig;\n    const stakeCredential = yield* validateAndGetStakeCredential(\n      rewardAddress,\n      config,\n    );\n    const cmlDRep = toCMLDRep(drep);\n    const buildCert = (credential: CML.Credential) =>\n      CML.SingleCertificateBuilder.new(\n        CML.Certificate.new_stake_vote_reg_deleg_cert(\n          credential,\n          CML.Ed25519KeyHash.from_bech32(poolId),\n          cmlDRep,\n          config.lucidConfig.protocolParameters.keyDeposit,\n        ),\n      );\n\n    yield* processCertificate(stakeCredential, config, buildCert, redeemer);\n  });\n\nexport const registerDRep = (\n  rewardAddress: RewardAddress,\n  anchor?: Anchor,\n  redeemer?: Redeemer,\n) =>\n  Effect.gen(function* () {\n    const { config } = yield* TxConfig;\n    const stakeCredential = yield* validateAndGetStakeCredential(\n      rewardAddress,\n      config,\n    );\n    const cmlAnchor = anchor\n      ? CML.Anchor.new(\n          CML.Url.from_json(anchor.url),\n          CML.AnchorDocHash.from_hex(anchor.dataHash),\n        )\n      : undefined;\n\n    const buildCert = (credential: CML.Credential) =>\n      CML.SingleCertificateBuilder.new(\n        CML.Certificate.new_reg_drep_cert(\n          credential,\n          config.lucidConfig.protocolParameters.drepDeposit,\n          cmlAnchor,\n        ),\n      );\n    yield* processCertificate(stakeCredential, config, buildCert, redeemer);\n  });\n\nexport const deregisterDRep = (\n  rewardAddress: RewardAddress,\n  redeemer?: Redeemer,\n) =>\n  Effect.gen(function* () {\n    const { config } = yield* TxConfig;\n    const stakeCredential = yield* validateAndGetStakeCredential(\n      rewardAddress,\n      config,\n    );\n\n    const buildCert = (credential: CML.Credential) =>\n      CML.SingleCertificateBuilder.new(\n        CML.Certificate.new_unreg_drep_cert(\n          credential,\n          config.lucidConfig.protocolParameters.drepDeposit,\n        ),\n      );\n\n    yield* processCertificate(stakeCredential, config, buildCert, redeemer);\n  });\n\nexport const updateDRep = (\n  rewardAddress: RewardAddress,\n  anchor?: Anchor,\n  redeemer?: Redeemer,\n) =>\n  Effect.gen(function* () {\n    const { config } = yield* TxConfig;\n    const stakeCredential = yield* validateAndGetStakeCredential(\n      rewardAddress,\n      config,\n    );\n    const cmlAnchor = anchor\n      ? CML.Anchor.new(\n          CML.Url.from_json(anchor.url),\n          CML.AnchorDocHash.from_hex(anchor.dataHash),\n        )\n      : undefined;\n    const buildCert = (credential: CML.Credential) =>\n      CML.SingleCertificateBuilder.new(\n        CML.Certificate.new_update_drep_cert(credential, cmlAnchor),\n      );\n    yield* processCertificate(stakeCredential, config, buildCert, redeemer);\n  });\n\nexport const authCommitteeHot = (\n  coldAddress: RewardAddress,\n  hotAddress: RewardAddress,\n  redeemer?: Redeemer,\n) =>\n  Effect.gen(function* () {\n    const { config } = yield* TxConfig;\n    const coldCred = yield* validateAndGetStakeCredential(coldAddress, config);\n    const hotCred = yield* validateAndGetStakeCredential(hotAddress, config);\n    const hotCredential: CML.Credential =\n      hotCred.type === \"Key\"\n        ? CML.Credential.new_pub_key(CML.Ed25519KeyHash.from_hex(hotCred.hash))\n        : CML.Credential.new_script(CML.ScriptHash.from_hex(hotCred.hash));\n    const buildCert = (credential: CML.Credential) =>\n      CML.SingleCertificateBuilder.new(\n        CML.Certificate.new_auth_committee_hot_cert(credential, hotCredential),\n      );\n\n    yield* processCertificate(coldCred, config, buildCert, redeemer);\n  });\n\nexport const resignCommitteeHot = (\n  coldAddress: RewardAddress,\n  anchor?: Anchor,\n  redeemer?: Redeemer,\n) =>\n  Effect.gen(function* () {\n    const { config } = yield* TxConfig;\n    const coldCred = yield* validateAndGetStakeCredential(coldAddress, config);\n    const cmlAnchor = anchor\n      ? CML.Anchor.new(\n          CML.Url.from_json(anchor.url),\n          CML.AnchorDocHash.from_hex(anchor.dataHash),\n        )\n      : undefined;\n\n    const buildCert = (credential: CML.Credential) =>\n      CML.SingleCertificateBuilder.new(\n        CML.Certificate.new_resign_committee_cold_cert(credential, cmlAnchor),\n      );\n\n    yield* processCertificate(coldCred, config, buildCert, redeemer);\n  });\n","import { Label } from \"@lucid-evolution/core-types\";\nimport * as TxBuilder from \"../TxBuilder.js\";\nimport { Effect } from \"effect\";\nimport { CML } from \"../../core.js\";\nimport * as S from \"@effect/schema/Schema\";\nimport { toHex } from \"@lucid-evolution/core-utils\";\n\nexport const attachMetadata = (\n  config: TxBuilder.TxBuilderConfig,\n  label: Label,\n  metadata: TransactionMetadata,\n) =>\n  Effect.gen(function* () {\n    const auxiliaryData = CML.AuxiliaryData.new();\n    const meta = CML.Metadata.new();\n    meta.set(\n      BigInt(label),\n      CML.TransactionMetadatum.from_json(\n        JSON.stringify(toCardanoMetadata(metadata)),\n      ),\n    );\n    auxiliaryData.add_metadata(meta);\n    config.txBuilder.add_auxiliary_data(auxiliaryData);\n    auxiliaryData.free();\n    meta.free();\n  });\n\n//CDDL conformance\n//   transaction_metadatum =\n//   { * transaction_metadatum => transaction_metadatum }\n// / [ * transaction_metadatum ]\n// / int\n// / bytes .size (0..64)\n// / text .size (0..64)\n\nexport type CardanoMetadata =\n  | {\n      string: string;\n    }\n  | {\n      int: number;\n    }\n  | {\n      bytes: string;\n    }\n  | {\n      list: ReadonlyArray<CardanoMetadata>;\n    }\n  | {\n      map: ReadonlyArray<{\n        k: CardanoMetadata;\n        v: CardanoMetadata;\n      }>;\n    };\n\nexport type TransactionMetadata =\n  | string\n  | number\n  | Uint8Array\n  | ReadonlyArray<TransactionMetadata>\n  | { [key: string]: TransactionMetadata };\n\nconst TextSchema = S.String.pipe(S.maxLength(64));\n\nconst TransactionMetadataSchema: S.Schema<TransactionMetadata> = S.Union(\n  TextSchema,\n  S.Number,\n  S.Uint8ArrayFromSelf,\n  S.Array(S.suspend(() => TransactionMetadataSchema)),\n  S.Record(\n    S.String,\n    S.suspend(() => TransactionMetadataSchema),\n  ),\n);\n\nexport const toCardanoMetadata = (\n  json: TransactionMetadata,\n): CardanoMetadata => {\n  const d = S.asserts(TransactionMetadataSchema)(json);\n  if (S.is(TextSchema)(json)) {\n    return { string: json };\n  }\n  if (typeof json === \"number\") {\n    return { int: json };\n  }\n  if (json instanceof Uint8Array) {\n    return { bytes: toHex(json) };\n  }\n  if (Array.isArray(json)) {\n    return { list: json.map((value) => toCardanoMetadata(value)) };\n  }\n  if (typeof json === \"object\" && json !== null) {\n    const mapEntries = Object.entries(json).map(([k, v]) => ({\n      k: toCardanoMetadata(k),\n      v: toCardanoMetadata(v),\n    }));\n    return { map: mapEntries };\n  }\n  throw new Error(\"Unsupported type\");\n};\n","import {\n  Effect,\n  pipe,\n  Record,\n  Array as _Array,\n  BigInt as _BigInt,\n  Tuple,\n  Option,\n} from \"effect\";\nimport {\n  Address,\n  Assets,\n  EvalRedeemer,\n  UTxO,\n  Wallet,\n} from \"@lucid-evolution/core-types\";\nimport {\n  ERROR_MESSAGE,\n  RunTimeError,\n  TransactionError,\n  TxBuilderError,\n} from \"../../Errors.js\";\nimport { CML } from \"../../core.js\";\nimport * as UPLC from \"@lucid-evolution/uplc\";\nimport * as TxBuilder from \"../TxBuilder.js\";\nimport * as TxSignBuilder from \"../../tx-sign-builder/TxSignBuilder.js\";\nimport {\n  assetsToValue,\n  coreToTxOutput,\n  isEqualUTxO,\n  selectUTxOs,\n  sortUTxOs,\n  stringify,\n  utxoToCore,\n  utxoToTransactionInput,\n  utxoToTransactionOutput,\n  toCMLRedeemerTag,\n} from \"@lucid-evolution/utils\";\nimport { SLOT_CONFIG_NETWORK } from \"@lucid-evolution/plutus\";\nimport { collectFromUTxO } from \"./Collect.js\";\nimport { TxConfig } from \"./Service.js\";\nimport { isError } from \"effect/Predicate\";\n\nexport type CompleteOptions = {\n  /**\n   * Enable coin selection algorithm\n   * @default true\n   */\n  coinSelection?: boolean;\n\n  /**\n   * Address to send change to\n   * @default wallet.address()\n   */\n  changeAddress?: Address;\n\n  /**\n   * Enable local UPLC evaluation\n   * @default true\n   */\n  localUPLCEval?: boolean;\n\n  /**\n   * Amount to set as collateral\n   * @default 5_000_000n\n   */\n  setCollateral?: bigint;\n\n  /**\n   * Use canonical ordering\n   * @default false\n   */\n  canonical?: boolean;\n\n  /**\n   * Include leftover lovelace in the transaction fee if there are no additional inputs available to cover the change output address.\n   * @default false\n   */\n  includeLeftoverLovelaceAsFee?: boolean;\n\n  /**\n   * Preset UTXOs from the wallet to include in coin selection.\n   * If not provided, wallet UTXOs will be fetched by the provider.\n   *\n   * Note:\n   * UTXOs already specified in `collectFrom` will not cause duplication\n   * @default []\n   */\n  presetWalletInputs?: UTxO[];\n};\n\ntype CoinSelectionResult = {\n  selected: UTxO[];\n  burnable: Assets;\n};\n\nexport const completeTxError = (cause: unknown) =>\n  new TxBuilderError({ cause: `{ Complete: ${cause} }` });\n\nexport const complete = (options: CompleteOptions = {}) =>\n  Effect.gen(function* () {\n    const { config } = yield* TxConfig;\n    const wallet: Wallet = yield* pipe(\n      Effect.fromNullable(config.lucidConfig.wallet),\n      Effect.orElseFail(() => completeTxError(ERROR_MESSAGE.MISSING_WALLET)),\n    );\n    const walletAddress: string = yield* Effect.promise(() => wallet.address());\n\n    // Extract and set default options for the transaction configuration\n    const {\n      coinSelection = true,\n      changeAddress = walletAddress,\n      localUPLCEval = true,\n      setCollateral = 5_000_000n,\n      canonical = false,\n      includeLeftoverLovelaceAsFee = false,\n      presetWalletInputs = [],\n    } = options;\n\n    const walletInputs: UTxO[] =\n      presetWalletInputs.length === 0\n        ? yield* Effect.tryPromise({\n            try: () => wallet.getUtxos(),\n            catch: (error) => completeTxError(error),\n          })\n        : presetWalletInputs;\n\n    // Execute programs sequentially\n    yield* Effect.all(config.programs);\n    const hasPlutusScriptExecutions: boolean = Array.from(\n      config.scripts.values(),\n    ).some((value) => value.type !== \"Native\");\n\n    // First round of coin selection and UPLC evaluation. The fee estimation is lacking\n    // the script execution costs as they aren't available yet.\n    yield* selectionAndEvaluation(\n      walletInputs,\n      changeAddress,\n      coinSelection,\n      localUPLCEval,\n      includeLeftoverLovelaceAsFee,\n      false,\n    );\n    // Second round of coin selection by including script execution costs in fee estimation.\n    // UPLC evaluation need to be performed again if new inputs are selected during coin selection.\n    // Because increasing the inputs can increase the script execution budgets.\n    // Set collateral input if there are script executions\n    if (hasPlutusScriptExecutions) {\n      const minFee = config.txBuilder.min_fee(true);\n      const refScriptFee = yield* calculateMinRefScriptFee(config);\n      let estimatedFee = minFee + refScriptFee;\n\n      const totalCollateral = BigInt(\n        Math.ceil(\n          Math.max(\n            (config.lucidConfig.protocolParameters.collateralPercentage *\n              Number(estimatedFee)) /\n              100,\n            Number(setCollateral),\n          ),\n        ),\n      );\n      const collateralInput = yield* findCollateral(\n        config.lucidConfig.protocolParameters.coinsPerUtxoByte,\n        totalCollateral,\n        walletInputs,\n      );\n      yield* applyCollateral(totalCollateral, collateralInput, changeAddress);\n      yield* selectionAndEvaluation(\n        walletInputs,\n        changeAddress,\n        coinSelection,\n        localUPLCEval,\n        includeLeftoverLovelaceAsFee,\n        true,\n      );\n    }\n    config.txBuilder.add_change_if_needed(\n      CML.Address.from_bech32(changeAddress),\n      true,\n    );\n    const transaction = yield* Effect.try({\n      try: () =>\n        config.txBuilder\n          .build(\n            CML.ChangeSelectionAlgo.Default,\n            CML.Address.from_bech32(changeAddress),\n          )\n          .build_unchecked(),\n      catch: (error) => completeTxError(error),\n    });\n\n    const derivedInputs = deriveInputsFromTransaction(transaction);\n\n    const derivedWalletInputs = derivedInputs.filter(\n      (utxo) => utxo.address === walletAddress,\n    );\n    const updatedWalletInputs = pipe(\n      _Array.differenceWith(isEqualUTxO)(walletInputs, config.consumedInputs),\n      (availableWalletInputs) => [\n        ...derivedWalletInputs,\n        ...availableWalletInputs,\n      ],\n    );\n    return Tuple.make(\n      updatedWalletInputs,\n      derivedInputs,\n      TxSignBuilder.makeTxSignBuilder(\n        config.lucidConfig.wallet,\n        canonical\n          ? CML.Transaction.from_cbor_bytes(\n              transaction.to_canonical_cbor_bytes(),\n            )\n          : transaction,\n      ),\n    );\n  }).pipe(Effect.catchAllDefect((cause) => new RunTimeError({ cause })));\n\nexport const selectionAndEvaluation = (\n  walletInputs: UTxO[],\n  changeAddress: string,\n  coinSelection: boolean,\n  localUPLCEval: boolean,\n  includeLeftoverLovelaceAsFee: boolean,\n  script_calculation: boolean,\n) =>\n  Effect.gen(function* () {\n    const { config } = yield* TxConfig;\n    const refScriptInputs = config.readInputs.filter(\n      (input) => input.scriptRef,\n    );\n    const availableInputs = _Array.differenceWith(isEqualUTxO)(walletInputs, [\n      ...config.collectedInputs,\n      ...refScriptInputs,\n    ]);\n\n    const { selected: inputsToAdd, burnable } =\n      coinSelection !== false\n        ? yield* doCoinSelection(\n            config,\n            availableInputs,\n            script_calculation,\n            includeLeftoverLovelaceAsFee,\n          )\n        : { selected: [], burnable: { lovelace: 0n } };\n\n    // Skip UPLC evaluation for the second time if no new inputs are added\n    let estimatedFee = 0n;\n    if (_Array.isEmptyArray(inputsToAdd)) {\n      if (script_calculation) return;\n      estimatedFee += burnable.lovelace;\n    }\n    if (_Array.isNonEmptyArray(inputsToAdd)) {\n      for (const utxo of inputsToAdd) {\n        const input = CML.SingleInputBuilder.from_transaction_unspent_output(\n          utxoToCore(utxo),\n        ).payment_key();\n        config.txBuilder.add_input(input);\n      }\n      config.collectedInputs = [...config.collectedInputs, ...inputsToAdd];\n      estimatedFee = yield* estimateFee(config, script_calculation);\n    }\n\n    //NOTE: We need to keep track of all consumed inputs\n    //this is just a patch, and we should find a better way to do this\n    config.consumedInputs = [...config.collectedInputs];\n\n    // Complete partial programs if present by building their redeemers and running them\n    if (config.partialPrograms.size > 0) {\n      // NOTE: Cannot build the redeemers twice as it would lead to duplicate addition of\n      // inputs for \"SPEND\" redeemers. As CML currently does not allow updating redeemer of\n      // an existing input.\n      if (script_calculation) {\n        yield* completeTxError(\n          `RedeemerBuilder: Coin selection had to be updated after building redeemers, possibly leading to incorrect indices. Try setting a minimum fee of ${estimatedFee} lovelaces.`,\n        );\n      } else yield* completePartialPrograms();\n    }\n\n    // Build transaction to begin with UPLC evaluation\n    const txRedeemerBuilder = yield* Effect.try({\n      try: () =>\n        config.txBuilder.build_for_evaluation(\n          0,\n          CML.Address.from_bech32(changeAddress),\n        ),\n      catch: (error) => completeTxError(error),\n    });\n\n    if (txRedeemerBuilder.draft_tx().witness_set().redeemers()) {\n      if (localUPLCEval !== false) {\n        applyUPLCEval(\n          yield* evalTransaction(config, txRedeemerBuilder, walletInputs),\n          config.txBuilder,\n        );\n      } else {\n        applyUPLCEvalProvider(\n          yield* evalTransactionProvider(\n            config,\n            txRedeemerBuilder,\n            walletInputs,\n          ),\n          config.txBuilder,\n        );\n      }\n    }\n  }).pipe(Effect.catchAllDefect((cause) => new RunTimeError({ cause })));\n\n//TODO: This should\nexport const completePartialPrograms = () =>\n  Effect.gen(function* () {\n    const { config } = yield* TxConfig;\n    const sortedInputs = sortUTxOs(config.collectedInputs, \"Canonical\");\n    const indicesMap: Map<string, bigint> = new Map();\n    sortedInputs.forEach((value, index) => {\n      indicesMap.set(value.txHash + value.outputIndex, BigInt(index));\n    });\n    const newPrograms = [];\n\n    // Iterate over all the RedeemerBuilders to construct redeemers\n    // and collect obtained programs\n    for (const [\n      redeemerBuilder,\n      partialProgram,\n    ] of config.partialPrograms.entries()) {\n      if (redeemerBuilder.kind === \"selected\") {\n        const inputIndices = redeemerBuilder.inputs.flatMap((value) => {\n          const index = indicesMap.get(value.txHash + value.outputIndex);\n          if (index !== undefined) return index;\n          else return [];\n        });\n\n        if (\n          _Array.isEmptyArray(inputIndices) ||\n          inputIndices.length !== redeemerBuilder.inputs.length\n        )\n          yield* completeTxError(\n            `RedeemerBuilder: Missing indices for inputs: ${stringify(redeemerBuilder.inputs)}`,\n          );\n\n        const redeemer = redeemerBuilder.makeRedeemer(inputIndices);\n        const program = partialProgram(redeemer);\n        newPrograms.push(program);\n      } else {\n        // For RedeemerBuilder of kind \"self\", construct a unique redeemer\n        // for every UTxO and collect it's program\n        const inputs: UTxO[] = yield* pipe(\n          Effect.fromNullable(redeemerBuilder.inputs),\n          Effect.orElseFail(() =>\n            completeTxError(\n              `RedeemerBuilder: Inputs for redeemer builder not founds: ${stringify(redeemerBuilder)}`,\n            ),\n          ),\n        );\n\n        for (const input of inputs) {\n          const index = yield* pipe(\n            Effect.fromNullable(\n              indicesMap.get(input.txHash + input.outputIndex),\n            ),\n            Effect.orElseFail(() =>\n              completeTxError(`Index not found for input: ${input}`),\n            ),\n          );\n\n          const redeemer = redeemerBuilder.makeRedeemer(index);\n          const program = collectFromUTxO([input], false)(redeemer);\n          newPrograms.push(program);\n        }\n      }\n    }\n    yield* Effect.all(newPrograms);\n  });\n\nexport const applyUPLCEval = (\n  uplcEval: Uint8Array[],\n  txbuilder: CML.TransactionBuilder,\n): void => {\n  for (const bytes of uplcEval) {\n    const redeemer = CML.LegacyRedeemer.from_cbor_bytes(bytes);\n    const exUnits = CML.ExUnits.new(\n      redeemer.ex_units().mem(),\n      redeemer.ex_units().steps(),\n    );\n    txbuilder.set_exunits(\n      CML.RedeemerWitnessKey.new(redeemer.tag(), redeemer.index()),\n      exUnits,\n    );\n  }\n};\n\nexport const applyUPLCEvalProvider = (\n  evalRedeemerList: EvalRedeemer[],\n  txbuilder: CML.TransactionBuilder,\n): void => {\n  for (const evalRedeemer of evalRedeemerList) {\n    const exUnits = CML.ExUnits.new(\n      BigInt(evalRedeemer.ex_units.mem),\n      BigInt(evalRedeemer.ex_units.steps),\n    );\n    txbuilder.set_exunits(\n      CML.RedeemerWitnessKey.new(\n        toCMLRedeemerTag(evalRedeemer.redeemer_tag),\n        BigInt(evalRedeemer.redeemer_index),\n      ),\n      exUnits,\n    );\n  }\n};\n\nexport const setRedeemerstoZero = (tx: CML.Transaction): CML.Transaction => {\n  const redeemers = tx.witness_set().redeemers();\n  if (!redeemers) return tx;\n  const arrLegacyRedeemer = redeemers.as_arr_legacy_redeemer();\n  if (arrLegacyRedeemer) {\n    const redeemerList = CML.LegacyRedeemerList.new();\n    for (let i = 0; i < arrLegacyRedeemer.len(); i++) {\n      const redeemer = arrLegacyRedeemer.get(i);\n      const dummyRedeemer = CML.LegacyRedeemer.new(\n        redeemer.tag(),\n        redeemer.index(),\n        redeemer.data(),\n        CML.ExUnits.new(0n, 0n),\n      );\n      redeemerList.add(dummyRedeemer);\n    }\n\n    const dummyWitnessSet = tx.witness_set();\n    dummyWitnessSet.set_redeemers(\n      CML.Redeemers.new_arr_legacy_redeemer(redeemerList),\n    );\n    return CML.Transaction.new(\n      tx.body(),\n      dummyWitnessSet,\n      true,\n      tx.auxiliary_data(),\n    );\n  }\n  const mapRedeemerKeyToRedeemerVal =\n    redeemers.as_map_redeemer_key_to_redeemer_val();\n  if (mapRedeemerKeyToRedeemerVal) {\n    const dummyWitnessSet = tx.witness_set();\n    dummyWitnessSet.set_redeemers(\n      CML.Redeemers.new_map_redeemer_key_to_redeemer_val(\n        mapRedeemerKeyToRedeemerVal,\n      ),\n    );\n    return CML.Transaction.new(\n      tx.body(),\n      dummyWitnessSet,\n      true,\n      tx.auxiliary_data(),\n    );\n  }\n  return tx;\n};\n\nconst applyCollateral = (\n  setCollateral: bigint,\n  collateralInputs: UTxO[],\n  changeAddress: string,\n) =>\n  Effect.gen(function* () {\n    const { config } = yield* TxConfig;\n    for (const utxo of collateralInputs) {\n      const collateralInput =\n        CML.SingleInputBuilder.from_transaction_unspent_output(\n          utxoToCore(utxo),\n        ).payment_key();\n      config.txBuilder.add_collateral(collateralInput);\n    }\n    const returnassets = pipe(\n      sumAssetsFromInputs(collateralInputs),\n      Record.union({ lovelace: -setCollateral }, _BigInt.sum),\n    );\n\n    const collateralOutputBuilder =\n      CML.TransactionOutputBuilder.new().with_address(\n        CML.Address.from_bech32(changeAddress),\n      );\n    config.txBuilder.set_collateral_return(\n      collateralOutputBuilder\n        .next()\n        .with_value(assetsToValue(returnassets))\n        .build()\n        .output(),\n    );\n  });\n\nconst findCollateral = (\n  coinsPerUtxoByte: bigint,\n  setCollateral: bigint,\n  inputs: UTxO[],\n): Effect.Effect<UTxO[], TxBuilderError, never> =>\n  Effect.gen(function* () {\n    // NOTE: While the required collateral is 5 ADA, there may be instances where the UTXOs encountered do not contain enough ADA to be returned to the collateral return address.\n    // For example:\n    // A UTXO with 5.5 ADA will result in an error message such as `BabbageOutputTooSmallUTxO`, since only 0.5 ADA would be returned to the collateral return address.\n    const collateralLovelace: Assets = { lovelace: setCollateral };\n    const error = completeTxError(\n      `Your wallet does not have enough funds to cover the required ${setCollateral} Lovelace collateral. Or it contains UTxOs with reference scripts; which\n      are excluded from collateral selection.`,\n    );\n    const { selected } = yield* recursive(\n      sortUTxOs(inputs),\n      collateralLovelace,\n      coinsPerUtxoByte,\n      undefined,\n      false,\n      error,\n    );\n    if (selected.length > 3)\n      yield* completeTxError(\n        `Selected ${selected.length} inputs as collateral, but max collateral inputs is 3 to cover the ${setCollateral} Lovelace collateral ${stringify(selected)}`,\n      );\n    return selected;\n  });\n\nconst doCoinSelection = (\n  config: TxBuilder.TxBuilderConfig,\n  availableInputs: UTxO[],\n  script_calculation: boolean,\n  includeLeftoverLovelaceAsFee: boolean,\n): Effect.Effect<{ selected: UTxO[]; burnable: Assets }, TxBuilderError> =>\n  Effect.gen(function* () {\n    // NOTE: This is a fee estimation. If the amount is not enough, it may require increasing the fee.\n    const estimatedFee: Assets = {\n      lovelace: yield* estimateFee(config, script_calculation),\n    };\n\n    const negatedMintedAssets = negateAssets(config.mintedAssets);\n    const negatedCollectedAssets = negateAssets(\n      sumAssetsFromInputs(config.collectedInputs),\n    );\n\n    // Calculate the net change in assets (delta)\n    const assetsDelta: Assets = pipe(\n      config.totalOutputAssets,\n      Record.union(estimatedFee, _BigInt.sum),\n      Record.union(negatedCollectedAssets, _BigInt.sum),\n      Record.union(negatedMintedAssets, _BigInt.sum),\n    );\n    // Filter and obtain only the required assets (those with a positive amount)\n    let requiredAssets = pipe(\n      assetsDelta,\n      Record.filter((amount) => amount > 0n),\n    );\n    // Filter and obtain assets that are present in the inputs and mints but are not required by the outputs\n    // Negate these assets to get their positive amounts\n    const notRequiredAssets = pipe(\n      assetsDelta,\n      Record.filter((amount) => amount < 0n),\n      negateAssets,\n    );\n\n    // Note: We are not done with coin selection even if \"requiredAssets\" is empty.\n    // Because \"notRequiredAssets\" may not contain enough ADA to cover for minimum Ada requirement\n    // when they need to be sent as change output. Hence, we allow for \"recursive\" to be invoked.\n    return yield* recursive(\n      sortUTxOs(availableInputs),\n      requiredAssets,\n      config.lucidConfig.protocolParameters.coinsPerUtxoByte,\n      notRequiredAssets,\n      includeLeftoverLovelaceAsFee,\n    );\n  });\n\n/**\n * Estimate total transaction fee and set it in CML.TransactionBuilder if required\n * @param config\n * @param script_calculation\n * @returns estimated fee\n */\nconst estimateFee = (\n  config: TxBuilder.TxBuilderConfig,\n  script_calculation: boolean,\n): Effect.Effect<bigint, TxBuilderError, never> =>\n  Effect.gen(function* () {\n    const minFee = config.txBuilder.min_fee(script_calculation);\n    const refScriptFee = yield* calculateMinRefScriptFee(config);\n    let estimatedFee = minFee + refScriptFee;\n    const customMinFee = config.minFee;\n\n    if (\n      (customMinFee !== undefined && customMinFee > minFee) ||\n      refScriptFee > 0n\n    ) {\n      estimatedFee = customMinFee\n        ? customMinFee > estimatedFee\n          ? customMinFee\n          : estimatedFee\n        : estimatedFee;\n\n      config.txBuilder.set_fee(estimatedFee);\n    }\n    return estimatedFee;\n  });\n\nconst evalTransactionProvider = (\n  config: TxBuilder.TxBuilderConfig,\n  txRedeemerBuilder: CML.TxRedeemerBuilder,\n  walletInputs: UTxO[],\n): Effect.Effect<EvalRedeemer[], TxBuilderError> =>\n  Effect.gen(function* () {\n    const txEvaluation = setRedeemerstoZero(txRedeemerBuilder.draft_tx())!;\n    // Normalize UTXOs that include both a datum and a datumHash.\n    // If a datumHash is present, the datum field is removed.\n    // This ensures consistency when preparing UTXOs for evaluation.\n    const txUtxos = [...config.collectedInputs, ...config.readInputs].map(\n      ({ datumHash, datum, ...rest }) => ({\n        ...rest,\n        datumHash,\n        datum: datumHash ? undefined : datum,\n      }),\n    );\n    const uplc_eval = yield* Effect.tryPromise({\n      try: () =>\n        config.lucidConfig.provider.evaluateTx(\n          txEvaluation.to_cbor_hex(),\n          txUtxos,\n        ),\n      catch: (error) => completeTxError(error),\n    });\n    return uplc_eval;\n  });\n\nconst evalTransaction = (\n  config: TxBuilder.TxBuilderConfig,\n  txRedeemerBuilder: CML.TxRedeemerBuilder,\n  walletInputs: UTxO[],\n): Effect.Effect<Uint8Array[], TxBuilderError> =>\n  Effect.gen(function* () {\n    const txEvaluation = setRedeemerstoZero(txRedeemerBuilder.draft_tx())!;\n    // Normalize UTXOs that include both a datum and a datumHash.\n    // If a datumHash is present, the datum field is removed.\n    // This ensures consistency when preparing UTXOs for evaluation.\n    const txUtxos = [\n      ...walletInputs,\n      ...config.collectedInputs,\n      ...config.readInputs,\n    ].map(({ datumHash, datum, ...rest }) => ({\n      ...rest,\n      datumHash,\n      datum: datumHash ? undefined : datum,\n    }));\n    const ins = txUtxos.map((utxo) => utxoToTransactionInput(utxo));\n    const outs = txUtxos.map((utxo) => utxoToTransactionOutput(utxo));\n    const slotConfig = SLOT_CONFIG_NETWORK[config.lucidConfig.network];\n    const uplc_eval: Uint8Array[] = yield* Effect.try({\n      try: () =>\n        UPLC.eval_phase_two_raw(\n          txEvaluation.to_cbor_bytes(),\n          ins.map((value) => value.to_cbor_bytes()),\n          outs.map((value) => value.to_cbor_bytes()),\n          config.lucidConfig.costModels.to_cbor_bytes(),\n          config.lucidConfig.protocolParameters.maxTxExSteps,\n          config.lucidConfig.protocolParameters.maxTxExMem,\n          BigInt(slotConfig.zeroTime),\n          BigInt(slotConfig.zeroSlot),\n          slotConfig.slotLength,\n        ),\n      catch: (error) =>\n        completeTxError(\n          `${\n            isError(error)\n              ? error\n              : JSON.stringify(error)\n                  .replace(/\\\\n\\s*/g, \" \")\n                  .trim()\n          }`,\n        ),\n    });\n    return uplc_eval;\n  });\n\nconst calculateMinLovelace = (\n  coinsPerUtxoByte: bigint,\n  multiAssets?: Assets,\n  changeAddress?: string,\n): bigint => {\n  const dummyAddress =\n    \"addr_test1qrngfyc452vy4twdrepdjc50d4kvqutgt0hs9w6j2qhcdjfx0gpv7rsrjtxv97rplyz3ymyaqdwqa635zrcdena94ljs0xy950\";\n  return CML.TransactionOutputBuilder.new()\n    .with_address(\n      CML.Address.from_bech32(changeAddress ? changeAddress : dummyAddress),\n    )\n    .next()\n    .with_asset_and_min_required_coin(\n      multiAssets\n        ? assetsToValue(multiAssets).multi_asset()\n        : CML.MultiAsset.new(),\n      coinsPerUtxoByte,\n    )\n    .build()\n    .output()\n    .amount()\n    .coin();\n};\n\nconst calculateMinRefScriptFee = (\n  config: TxBuilder.TxBuilderConfig,\n): Effect.Effect<bigint, TxBuilderError, never> =>\n  Effect.gen(function* () {\n    let fee = 0n;\n    let totalScriptSize = 0;\n\n    for (const utxo of config.readInputs) {\n      if (utxo.scriptRef) {\n        totalScriptSize = totalScriptSize + utxo.scriptRef.script.length / 2;\n      }\n    }\n    for (const utxo of config.collectedInputs) {\n      if (utxo.scriptRef) {\n        totalScriptSize = totalScriptSize + utxo.scriptRef.script.length / 2;\n      }\n    }\n    if (totalScriptSize === 0) return fee;\n\n    const fees = [15.0, 18.0, 21.6, 25.92, 31.1, 37.32, 44.79, 53.75];\n\n    let counter = 0;\n    while (totalScriptSize > 0) {\n      if (counter > fees.length - 1) {\n        yield* completeTxError(\n          \"Total reference script size in a transaction cannot exceed 200,000 bytes.\",\n        );\n      }\n\n      if (totalScriptSize > 25000)\n        fee = fee + BigInt(Math.ceil(25000 * fees[counter]));\n      else fee = fee + BigInt(Math.ceil(totalScriptSize * fees[counter]));\n      totalScriptSize = totalScriptSize - 25000;\n      counter++;\n    }\n    return fee;\n  });\n\nconst deriveInputsFromTransaction = (tx: CML.Transaction): UTxO[] => {\n  const outputs = tx.body().outputs();\n  const txHash = CML.hash_transaction(tx.body()).to_hex();\n  const utxos: UTxO[] = [];\n  for (let index = 0; index < outputs.len(); index++) {\n    const output = outputs.get(index);\n    const utxo: UTxO = {\n      txHash: txHash,\n      outputIndex: index,\n      ...coreToTxOutput(output),\n    };\n    utxos.push(utxo);\n  }\n  return utxos;\n};\n\n/**\n * Returns a new `Assets`\n *\n * Negates the amounts of all assets in the given record.\n */\nconst negateAssets = (assets: Assets): Assets =>\n  Record.map(assets, (amount) => -amount);\n\n/**\n * Returns a new Assets\n *\n * Sums the assets from an array of UTxO inputs.\n */\nconst sumAssetsFromInputs = (inputs: UTxO[]) =>\n  _Array.isEmptyArray(inputs)\n    ? {}\n    : inputs\n        .map((utxo) => utxo.assets)\n        .reduce((acc, cur) => Record.union(acc, cur, _BigInt.sum));\n\nconst calculateExtraLovelace = (\n  leftoverAssets: Assets,\n  coinsPerUtxoByte: bigint,\n): Option.Option<Assets> => {\n  return pipe(leftoverAssets, (assets) => {\n    const minLovelace = calculateMinLovelace(coinsPerUtxoByte, assets);\n    const currentLovelace = assets[\"lovelace\"] || 0n;\n    return currentLovelace >= minLovelace\n      ? Option.none()\n      : Option.some({ lovelace: minLovelace - currentLovelace });\n  });\n};\n\n/**\n * Performs coin selection to obtain the \"requiredAssets\" and then carries out\n * recursive coin selection to ensure that leftover assets (selectedAssets + externalAssets - requiredAssets)\n * have enough ADA to satisfy minimum ADA requirement for them to be sent as change output.\n * If \"requiredAssets\" is empty, it still checks for minimum ADA requirement of \"externalAssets\"\n * and does coin selection if required.\n * @param inputs\n * @param requiredAssets\n * @param coinsPerUtxoByte\n * @param externalAssets\n * @param error\n * @returns\n */\nexport const recursive = (\n  inputs: UTxO[],\n  requiredAssets: Assets,\n  coinsPerUtxoByte: bigint,\n  externalAssets: Assets = {},\n  includeLeftoverLovelaceAsFee?: boolean,\n  error?: TxBuilderError,\n): Effect.Effect<CoinSelectionResult, TxBuilderError> =>\n  Effect.gen(function* () {\n    let selected: UTxO[] = [];\n    error ??= completeTxError(\n      `Your wallet does not have enough funds to cover the required assets: ${stringify(requiredAssets)}\n      Or it contains UTxOs with reference scripts; which are excluded from coin selection.`,\n    );\n    if (!Record.isEmptyRecord(requiredAssets)) {\n      selected = selectUTxOs(inputs, requiredAssets, true);\n      if (_Array.isEmptyArray(selected)) yield* error;\n    }\n\n    const selectedAssets: Assets = sumAssetsFromInputs(selected);\n    let availableAssets: Assets = pipe(\n      selectedAssets,\n      Record.union(requiredAssets, (self, that) => self - that),\n      Record.union(externalAssets, _BigInt.sum),\n    );\n\n    let extraLovelace: Assets | undefined = pipe(\n      calculateExtraLovelace(availableAssets, coinsPerUtxoByte),\n      Option.getOrUndefined,\n    );\n    let remainingInputs = inputs;\n\n    while (extraLovelace) {\n      remainingInputs = _Array.differenceWith(isEqualUTxO)(\n        remainingInputs,\n        selected,\n      );\n\n      const extraSelected = selectUTxOs(remainingInputs, extraLovelace, true);\n      if (_Array.isEmptyArray(extraSelected)) {\n        if (includeLeftoverLovelaceAsFee)\n          return { selected: [...selected], burnable: extraLovelace };\n        yield* completeTxError(\n          `Your wallet does not have enough funds to cover required minimum ADA for change output: ${stringify(extraLovelace)}\n          Or it contains UTxOs with reference scripts; which are excluded from coin selection.`,\n        );\n      }\n      const extraSelectedAssets: Assets = sumAssetsFromInputs(extraSelected);\n      selected = [...selected, ...extraSelected];\n      availableAssets = Record.union(\n        availableAssets,\n        extraSelectedAssets,\n        _BigInt.sum,\n      );\n\n      extraLovelace = pipe(\n        calculateExtraLovelace(availableAssets, coinsPerUtxoByte),\n        Option.getOrUndefined,\n      );\n    }\n    return { selected, burnable: { lovelace: 0n } };\n  });\n","import { CML, makeReturn } from \"../core.js\";\nimport { LucidConfig } from \"../lucid-evolution/LucidEvolution.js\";\nimport { Effect } from \"effect\";\nimport * as S from \"@effect/schema/Schema\";\n//TODO: move to commont utils\nimport {\n  PrivateKey,\n  TransactionWitnesses,\n  Wallet,\n} from \"@lucid-evolution/core-types\";\nimport { TransactionSignError } from \"../Errors.js\";\nimport { TxSigned } from \"../tx-submit/TxSubmit.js\";\nimport * as CompleteTxSigner from \"./internal/CompleteTxSigner.js\";\nimport { Either } from \"effect/Either\";\nimport * as Sign from \"./internal/Sign.js\";\nimport { CBORHex, Hash } from \"../tx-builder/types.js\";\n\nexport interface TxSignBuilderConfig {\n  txComplete: CML.Transaction;\n  witnessSetBuilder: CML.TransactionWitnessSetBuilder;\n  programs: Effect.Effect<void, TransactionSignError, never>[];\n  wallet: Wallet | undefined;\n  fee: number;\n  exUnits: { cpu: number; mem: number } | null;\n}\n\nexport interface TxSignBuilder {\n  sign: {\n    /** Signs the transaction with a wallet. */\n    withWallet: () => TxSignBuilder;\n    /** Signs the transaction with a private key. */\n    withPrivateKey: (privateKey: PrivateKey) => TxSignBuilder;\n  };\n  partialSign: {\n    /** Partially signs the transaction with a wallet. */\n    withWallet: () => Promise<TransactionWitnesses>;\n    /** Partially signs the transaction with a wallet and returns an effect. */\n    withWalletEffect: () => Effect.Effect<\n      TransactionWitnesses,\n      TransactionSignError\n    >;\n    /** Safely partially signs the transaction with a wallet. */\n    withWalletSafe: () => Promise<\n      Either<TransactionWitnesses, TransactionSignError>\n    >;\n    /** Partially signs the transaction with a private key. */\n    withPrivateKey: (privateKey: PrivateKey) => Promise<TransactionWitnesses>;\n    /** Partially signs the transaction with a private key and returns an effect. */\n    withPrivateKeyEffect: (\n      privateKey: PrivateKey,\n    ) => Effect.Effect<TransactionWitnesses, TransactionSignError>;\n    /** Safely partially signs the transaction with a private key. */\n    withPrivateKeySafe: (\n      privateKey: PrivateKey,\n    ) => Promise<Either<TransactionWitnesses, TransactionSignError>>;\n  };\n  /** Assembles the transaction with the given witnesses.  */\n  assemble: (witnesses: TransactionWitnesses[]) => TxSignBuilder;\n  /**\n   * Converts the transaction to CBOR (Concise Binary Object Representation) format.\n   *\n   * Supports both canonical and non-canonical formats.\n   *\n   * Canonical format follows [RFC 7049 Section 3.9](https://datatracker.ietf.org/doc/html/rfc7049#section-3.9) rules\n   *\n   * Non-canonical format example:\n   * ```typescript\n   * .toCBOR();\n   * ```\n   * Canonical format example:\n   * ```typescript\n   * .toCBOR({ canonical: true });\n   * ```\n   */\n  toCBOR: (options?: { canonical: boolean }) => CBORHex;\n  toTransaction: () => CML.Transaction;\n  /** Converts the transaction body to JSON format. */\n  toJSON: () => object;\n  /** Computes the hash of the transaction body. */\n  toHash: () => Hash;\n  complete: () => Promise<TxSigned>;\n  /** Completes the transaction and returns an effect. */\n  completeProgram: () => Effect.Effect<TxSigned, TransactionSignError, never>;\n  /** Safely completes the transaction. */\n  completeSafe: () => Promise<Either<TxSigned, TransactionSignError>>;\n}\n\nexport const makeTxSignBuilder = (\n  wallet: Wallet | undefined,\n  tx: CML.Transaction,\n): TxSignBuilder => {\n  const redeemers = tx.witness_set().redeemers();\n  const exUnits = { cpu: 0, mem: 0 };\n  if (redeemers) {\n    const arrLegacyRedeemer = redeemers?.as_arr_legacy_redeemer();\n    if (arrLegacyRedeemer) {\n      for (let i = 0; i < arrLegacyRedeemer.len(); i++) {\n        const redeemer = arrLegacyRedeemer.get(i);\n        exUnits.cpu += parseInt(redeemer.ex_units().steps().toString());\n        exUnits.mem += parseInt(redeemer.ex_units().mem().toString());\n      }\n    }\n    const mapRedeemerKeyToRedeemerVal =\n      redeemers?.as_map_redeemer_key_to_redeemer_val();\n    if (mapRedeemerKeyToRedeemerVal) {\n      const keys = mapRedeemerKeyToRedeemerVal.keys();\n      for (let i = 0; i < (keys.len() || 0); i++) {\n        const key = keys.get(i);\n        const value = mapRedeemerKeyToRedeemerVal.get(key);\n        exUnits.cpu += parseInt(value!.ex_units().steps().toString());\n        exUnits.mem += parseInt(value!.ex_units().mem().toString());\n      }\n    }\n  }\n  const config: TxSignBuilderConfig = {\n    txComplete: tx,\n    witnessSetBuilder: CML.TransactionWitnessSetBuilder.new(),\n    programs: [],\n    wallet: wallet,\n    fee: parseInt(tx.body().fee().toString()),\n    exUnits: exUnits,\n  };\n\n  const txSignBuilder: TxSignBuilder = {\n    sign: {\n      withWallet: () => {\n        const program = Sign.withWallet(config);\n        config.programs.push(program);\n        return txSignBuilder;\n      },\n      withPrivateKey: (privateKey: PrivateKey) => {\n        const program = Sign.withPrivateKey(config, privateKey);\n        config.programs.push(program);\n        return txSignBuilder;\n      },\n    },\n    partialSign: {\n      withWallet: () => makeReturn(Sign.partialWithWallet(config)).unsafeRun(),\n      withWalletEffect: () => Sign.partialWithWallet(config),\n      withWalletSafe: () =>\n        makeReturn(Sign.partialWithWallet(config)).safeRun(),\n      withPrivateKey: (privateKey: PrivateKey) =>\n        makeReturn(Sign.partialWithPrivateKey(config, privateKey)).unsafeRun(),\n      withPrivateKeyEffect: (privateKey: PrivateKey) =>\n        Sign.partialWithPrivateKey(config, privateKey),\n      withPrivateKeySafe: (privateKey: PrivateKey) =>\n        makeReturn(Sign.partialWithPrivateKey(config, privateKey)).safeRun(),\n    },\n    assemble: (witnesses: TransactionWitnesses[]) => {\n      const program = Sign.assemble(config, witnesses);\n      config.programs.push(program);\n      return txSignBuilder;\n    },\n    toCBOR: (options = { canonical: false }) =>\n      options.canonical\n        ? config.txComplete.to_canonical_cbor_hex()\n        : config.txComplete.to_cbor_hex(),\n    toTransaction: () => config.txComplete,\n    toJSON: () =>\n      S.decodeUnknownSync(S.parseJson(S.Object))(config.txComplete.to_json()),\n    toHash: () => CML.hash_transaction(config.txComplete.body()).to_hex(),\n    complete: () =>\n      makeReturn(CompleteTxSigner.completeTxSigner(config)).unsafeRun(),\n    completeProgram: () => CompleteTxSigner.completeTxSigner(config),\n    completeSafe: () =>\n      makeReturn(CompleteTxSigner.completeTxSigner(config)).safeRun(),\n  };\n  return txSignBuilder;\n};\n","import { Effect, pipe } from \"effect\";\nimport { CML } from \"../../core.js\";\nimport {\n  ERROR_MESSAGE,\n  RunTimeError,\n  TransactionSignError,\n} from \"../../Errors.js\";\nimport * as TxSignBuilder from \"../TxSignBuilder.js\";\nimport * as TxSubmitBuilder from \"../../tx-submit/TxSubmit.js\";\nimport { signError } from \"./Sign.js\";\n\nexport const completeTxSigner = (\n  config: TxSignBuilder.TxSignBuilderConfig,\n): Effect.Effect<TxSubmitBuilder.TxSigned, TransactionSignError> =>\n  Effect.gen(function* () {\n    yield* Effect.all(config.programs, { concurrency: \"unbounded\" });\n    const plutus_datums = config.txComplete.witness_set().plutus_datums();\n    // TODO: currently add_existing does not support add_plutus_datums\n    // https://github.com/dcSpark/cardano-multiplatform-lib/pull/350/files\n    config.witnessSetBuilder.add_existing(config.txComplete.witness_set());\n    if (plutus_datums) {\n      for (let i = 0; i < plutus_datums.len(); i++) {\n        config.witnessSetBuilder.add_plutus_datum(plutus_datums.get(i));\n      }\n    }\n    const txWitnessSet = config.witnessSetBuilder.build();\n    const signedTx = CML.Transaction.new(\n      config.txComplete.body(),\n      txWitnessSet,\n      true,\n      config.txComplete.auxiliary_data(),\n    );\n    const wallet = yield* pipe(\n      Effect.fromNullable(config.wallet),\n      Effect.orElseFail(() => signError(ERROR_MESSAGE.MISSING_WALLET)),\n    );\n    return TxSubmitBuilder.makeSubmit(wallet, signedTx);\n  }).pipe(Effect.catchAllDefect((cause) => new RunTimeError({ cause })));\n","import { Effect } from \"effect\";\nimport * as S from \"@effect/schema/Schema\";\nimport { CML, makeReturn } from \"../core.js\";\nimport { Wallet } from \"@lucid-evolution/core-types\";\nimport { Either } from \"effect/Either\";\nimport { TxSubmitError } from \"../Errors.js\";\nimport { CBORHex, Hash } from \"../tx-builder/types.js\";\n\nexport interface TxSigned {\n  /** Submits the transaction and returns the transaction hash.\n   *\n   * Supports both canonical and non-canonical formats.\n   *\n   * Canonical format follows [RFC 7049 Section 3.9](https://datatracker.ietf.org/doc/html/rfc7049#section-3.9) rules\n   *\n   * Non-canonical format example:\n   * ```typescript\n   * .submit();\n   * ```\n   * Canonical format example:\n   * ```typescript\n   * .submit({ canonical: true });\n   * ```\n   */\n  submit: (options?: { canonical: boolean }) => Promise<string>;\n\n  /** Submits the transaction and returns the transaction hash or error as an effect.\n   *\n   * Supports both canonical and non-canonical formats.\n   *\n   * Canonical format follows [RFC 7049 Section 3.9](https://datatracker.ietf.org/doc/html/rfc7049#section-3.9) rules\n   *\n   * Non-canonical format example:\n   * ```typescript\n   * .submitProgram();\n   * ```\n   * Canonical format example:\n   * ```typescript\n   * .submitProgram({ canonical: true });\n   * ```\n   */\n  submitProgram: (options?: {\n    canonical: boolean;\n  }) => Effect.Effect<string, TxSubmitError, never>;\n\n  /** Safely submits the transaction, returning the transaction hash or an error as promise either type.\n   *\n   * Supports both canonical and non-canonical formats.\n   *\n   * Canonical format follows [RFC 7049 Section 3.9](https://datatracker.ietf.org/doc/html/rfc7049#section-3.9) rules\n   *\n   * Non-canonical format example:\n   * ```typescript\n   * .submitSafe();\n   * ```\n   * Canonical format example:\n   * ```typescript\n   * .submitSafe({ canonical: true });\n   * ```\n   */\n  submitSafe: (options?: {\n    canonical: boolean;\n  }) => Promise<Either<string, TxSubmitError>>;\n\n  /**\n   * Converts the transaction to CBOR (Concise Binary Object Representation) format.\n   *\n   * Supports both canonical and non-canonical formats.\n   *\n   * Canonical format follows [RFC 7049 Section 3.9](https://datatracker.ietf.org/doc/html/rfc7049#section-3.9) rules\n   *\n   * Non-canonical format example:\n   * ```typescript\n   * .toCBOR();\n   * ```\n   * Canonical format example:\n   * ```typescript\n   * .toCBOR({ canonical: true });\n   * ```\n   */\n  toCBOR: (options?: { canonical: boolean }) => CBORHex;\n  toTransaction: () => CML.Transaction;\n  /** Converts the transaction (transaction body and witnesses) to JSON format. */\n  toJSON: () => object;\n  /** Computes the hash of the transaction. */\n  toHash: () => Hash;\n}\nexport const makeSubmit = (\n  wallet: Wallet,\n  txSigned: CML.Transaction,\n): TxSigned => {\n  const submit = (options: { canonical: boolean }) =>\n    Effect.tryPromise({\n      try: () =>\n        wallet.submitTx(\n          options.canonical\n            ? txSigned.to_canonical_cbor_hex()\n            : txSigned.to_cbor_hex(),\n        ),\n      catch: (cause) => new TxSubmitError({ cause }),\n    });\n  return {\n    submit: (options = { canonical: false }) =>\n      makeReturn(submit(options)).unsafeRun(),\n    submitProgram: (options = { canonical: false }) => submit(options),\n    submitSafe: (options = { canonical: false }) =>\n      makeReturn(submit(options)).safeRun(),\n    toCBOR: (options = { canonical: false }) =>\n      options.canonical\n        ? txSigned.to_canonical_cbor_hex()\n        : txSigned.to_cbor_hex(),\n    toTransaction: () => txSigned,\n    toJSON: () =>\n      S.decodeUnknownSync(S.parseJson(S.Object))(txSigned.to_json()),\n    toHash: () => CML.hash_transaction(txSigned.body()).to_hex(),\n  };\n};\n","import { Effect, pipe } from \"effect\";\nimport { ERROR_MESSAGE, TxSignerError } from \"../../Errors.js\";\nimport * as TxSignBuilder from \"../TxSignBuilder.js\";\nimport {\n  PrivateKey,\n  TransactionWitnesses,\n  Wallet,\n} from \"@lucid-evolution/core-types\";\nimport { CML } from \"../../core.js\";\n\nexport const signError = (cause: unknown) => new TxSignerError({ cause });\n\nconst mkWitnessFromWallet = (\n  wallet: Wallet | undefined,\n  txComplete: CML.Transaction,\n): Effect.Effect<CML.TransactionWitnessSet, TxSignerError, never> =>\n  pipe(\n    Effect.fromNullable(wallet),\n    Effect.catchAll(() => signError(ERROR_MESSAGE.MISSING_WALLET)),\n    Effect.tryMapPromise({\n      try: (wallet) => wallet.signTx(txComplete),\n      catch: (cause) => signError(cause),\n    }),\n  );\n\nexport const withWallet = (\n  config: TxSignBuilder.TxSignBuilderConfig,\n): Effect.Effect<void, TxSignerError, never> =>\n  pipe(\n    mkWitnessFromWallet(config.wallet, config.txComplete),\n    Effect.map((witness) => config.witnessSetBuilder.add_existing(witness)),\n  );\n\nexport const partialWithWallet = (\n  config: TxSignBuilder.TxSignBuilderConfig,\n): Effect.Effect<TransactionWitnesses, TxSignerError> =>\n  pipe(\n    mkWitnessFromWallet(config.wallet, config.txComplete),\n    Effect.map((witness) => witness.to_cbor_hex()),\n  );\n\nconst mkWitnessFromPrivateKey = (\n  privateKey: PrivateKey,\n  txComplete: CML.Transaction,\n) =>\n  pipe(\n    Effect.try({\n      try: () => CML.PrivateKey.from_bech32(privateKey),\n      catch: signError,\n    }),\n    Effect.map((privateKey) =>\n      CML.make_vkey_witness(\n        CML.hash_transaction(txComplete.body()),\n        privateKey,\n      ),\n    ),\n  );\n\nexport const withPrivateKey = (\n  config: TxSignBuilder.TxSignBuilderConfig,\n  privateKey: PrivateKey,\n) =>\n  pipe(\n    mkWitnessFromPrivateKey(privateKey, config.txComplete),\n    Effect.map((witness) => config.witnessSetBuilder.add_vkey(witness)),\n  );\n\nexport const partialWithPrivateKey = (\n  config: TxSignBuilder.TxSignBuilderConfig,\n  privateKey: PrivateKey,\n) =>\n  pipe(\n    mkWitnessFromPrivateKey(privateKey, config.txComplete),\n    Effect.map((witness) => {\n      const witnessBuilder = CML.TransactionWitnessSetBuilder.new();\n      witnessBuilder.add_vkey(witness);\n      return witnessBuilder.build().to_cbor_hex();\n    }),\n  );\n\nexport const assemble = (\n  config: TxSignBuilder.TxSignBuilderConfig,\n  witnesses: TransactionWitnesses[],\n) =>\n  Effect.forEach(witnesses, (witness) =>\n    pipe(\n      Effect.try({\n        try: () => CML.TransactionWitnessSet.from_cbor_hex(witness),\n        catch: signError,\n      }),\n      Effect.map((witness) => config.witnessSetBuilder.add_existing(witness)),\n    ),\n  );\n","import { CML, makeReturn } from \"../core.js\";\nimport { LucidConfig } from \"../lucid-evolution/LucidEvolution.js\";\nimport { OutputDatum } from \"./types.js\";\nimport {\n  Address,\n  Anchor,\n  Assets,\n  DRep,\n  Label,\n  Lovelace,\n  PaymentKeyHash,\n  PoolId,\n  Redeemer,\n  RedeemerBuilder,\n  RewardAddress,\n  Script,\n  ScriptType,\n  StakeKeyHash,\n  TxOutput,\n  Unit,\n  UTxO,\n} from \"@lucid-evolution/core-types\";\nimport * as Collect from \"./internal/Collect.js\";\nimport * as Read from \"./internal/Read.js\";\nimport * as Attach from \"./internal/Attach.js\";\nimport * as Pay from \"./internal/Pay.js\";\nimport * as Mint from \"./internal/Mint.js\";\nimport * as Interval from \"./internal/Interval.js\";\nimport * as Signer from \"./internal/Signer.js\";\nimport * as Stake from \"./internal/Stake.js\";\nimport * as Pool from \"./internal/Pool.js\";\nimport * as Governance from \"./internal/Governance.js\";\nimport * as Metadata from \"./internal/Metadata.js\";\nimport * as CompleteTxBuilder from \"./internal/CompleteTxBuilder.js\";\nimport * as TxSignBuilder from \"../tx-sign-builder/TxSignBuilder.js\";\nimport { TransactionError } from \"../Errors.js\";\nimport { Either } from \"effect/Either\";\nimport { Effect, Layer, pipe } from \"effect\";\nimport { handleRedeemerBuilder } from \"./internal/TxUtils.js\";\nimport { addAssets } from \"@lucid-evolution/utils\";\nimport { TxConfig } from \"./internal/Service.js\";\n\nexport type TxBuilderConfig = {\n  readonly lucidConfig: LucidConfig;\n  readonly txBuilder: CML.TransactionBuilder;\n  walletInputs: UTxO[];\n  collectedInputs: UTxO[];\n  readInputs: UTxO[];\n  consumedInputs: UTxO[];\n  totalOutputAssets: Assets;\n  payToOutputs: TxOutput[];\n  mintedAssets: Assets;\n  scripts: Map<string, { type: ScriptType; script: string }>;\n  programs: Effect.Effect<void, TransactionError, TxConfig>[];\n  partialPrograms: Map<\n    RedeemerBuilder,\n    (redeemer?: string) => Effect.Effect<void, TransactionError, TxConfig>\n  >;\n  minFee: bigint | undefined;\n};\n\nexport type TxBuilder = {\n  readFrom: (utxos: UTxO[]) => TxBuilder;\n  collectFrom: (\n    utxos: UTxO[],\n    redeemer?: string | RedeemerBuilder,\n  ) => TxBuilder;\n  pay: {\n    ToAddress: (address: string, assets: Assets) => TxBuilder;\n    /**\n     * Creates an output that lock funds to a target address, with optional parameters for attaching a datum, assets, and a reference script.\n     *\n     * **Warning:** When working with Plutus V1 or V2 contracts, omitting the `outputDatum` can result in a permanently locked UTXO.\n     *\n     * @example\n     * ```ts\n     * const refScript: Script = {\n     *   type: \"PlutusV3\",\n     *   script: \"450100002499\",\n     *  };\n     *\n     * const signBuilder = await user\n     *   .newTx()\n     *   .pay.ToAddressWithData(\n     *     \"addr1q98wl3hnya9l94rt58ky533deyqe9t8zz5n9su26k8e5g23yar4q0adtaax9q9g0kphpv2ws7vxqwu6ln6pqx7j29nfqsfy9mg\",\n     *     {\n     *       kind: \"inline\",\n     *       value: \"d8799f44deadbeefff\",\n     *     },\n     *     { lovelace: 10_000_000n },\n     *     refScript\n     *   )\n     *   .complete();\n     * ```\n     */\n    ToAddressWithData: (\n      address: string,\n      outputDatum?: OutputDatum,\n      assets?: Assets | undefined,\n      scriptRef?: Script | undefined,\n    ) => TxBuilder;\n    /**\n     * Creates an output that lock funds to a target address, with optional parameters for attaching a datum, assets, and a reference script.\n     *\n     * **Warning:** When working with Plutus V1 or V2 contracts, omitting the `outputDatum` can result in a permanently locked UTXO.\n     *\n     * @example\n     * ```ts\n     * const refScript: Script = {\n     *   type: \"PlutusV3\",\n     *   script: \"450100002499\",\n     *  };\n     *\n     * const signBuilder = await user\n     *   .newTx()\n     *   .pay.ToContract(\n     *     \"addr1q98wl3hnya9l94rt58ky533deyqe9t8zz5n9su26k8e5g23yar4q0adtaax9q9g0kphpv2ws7vxqwu6ln6pqx7j29nfqsfy9mg\",\n     *     {\n     *       kind: \"inline\",\n     *       value: \"d8799f44deadbeefff\",\n     *     },\n     *     { lovelace: 10_000_000n },\n     *     refScript\n     *   )\n     *   .complete();\n     * ```\n     */\n    ToContract: (\n      address: string,\n      outputDatum?: OutputDatum,\n      assets?: Assets | undefined,\n      scriptRef?: Script | undefined,\n    ) => TxBuilder;\n  };\n  addSigner: (address: Address | RewardAddress) => TxBuilder;\n  addSignerKey: (keyHash: PaymentKeyHash | StakeKeyHash) => TxBuilder;\n  /**\n   * NOTE: Deprecate in future version\n   */\n  registerStake: (rewardAddress: RewardAddress) => TxBuilder;\n  /**\n   * NOTE: Deprecate in future version\n   */\n  deRegisterStake: (\n    rewardAddress: RewardAddress,\n    redeemer?: string,\n  ) => TxBuilder;\n  withdraw: (\n    rewardAddress: RewardAddress,\n    amount: Lovelace,\n    redeemer?: string | RedeemerBuilder,\n  ) => TxBuilder;\n  register: {\n    Stake: (rewardAddress: RewardAddress) => TxBuilder;\n    DRep: (\n      rewardAddress: RewardAddress,\n      anchor?: Anchor,\n      redeemer?: string,\n    ) => TxBuilder;\n  };\n  deregister: {\n    Stake: (rewardAddress: RewardAddress, redeemer?: string) => TxBuilder;\n    DRep: (rewardAddress: RewardAddress, redeemer?: string) => TxBuilder;\n  };\n  mintAssets: (\n    assets: Assets,\n    redeemer?: string | RedeemerBuilder,\n  ) => TxBuilder;\n  validFrom: (unixTime: number) => TxBuilder;\n  validTo: (unixTime: number) => TxBuilder;\n  /**\n   * NOTE: Deprecate in future version\n   */\n  delegateTo: (\n    rewardAddress: RewardAddress,\n    poolId: PoolId,\n    redeemer?: Redeemer,\n  ) => TxBuilder;\n  delegate: {\n    ToPool: (\n      rewardAddress: RewardAddress,\n      poolId: PoolId,\n      redeemer?: Redeemer,\n    ) => TxBuilder;\n    VoteToDRep: (\n      rewardAddress: RewardAddress,\n      drep: DRep,\n      redeemer?: Redeemer,\n    ) => TxBuilder;\n    VoteToPoolAndDRep: (\n      rewardAddress: RewardAddress,\n      poolId: PoolId,\n      drep: DRep,\n      redeemer?: Redeemer,\n    ) => TxBuilder;\n  };\n  registerAndDelegate: {\n    ToPool: (\n      rewardAddress: RewardAddress,\n      poolId: PoolId,\n      redeemer?: Redeemer,\n    ) => TxBuilder;\n    ToDRep: (\n      rewardAddress: RewardAddress,\n      drep: DRep,\n      redeemer?: Redeemer,\n    ) => TxBuilder;\n    ToPoolAndDRep: (\n      rewardAddress: RewardAddress,\n      poolId: PoolId,\n      drep: DRep,\n      redeemer?: Redeemer,\n    ) => TxBuilder;\n  };\n  updateDRep: (\n    rewardAddress: RewardAddress,\n    anchor?: Anchor,\n    redeemer?: Redeemer,\n  ) => TxBuilder;\n  authCommitteeHot: (\n    coldAddress: RewardAddress,\n    hotAddress: RewardAddress,\n  ) => TxBuilder;\n  resignCommitteeHot: (\n    coldAddress: RewardAddress,\n    anchor?: Anchor,\n  ) => TxBuilder;\n  attachMetadata: (\n    label: Label,\n    metadata: Metadata.TransactionMetadata,\n  ) => TxBuilder;\n  attach: {\n    Script: (script: Script) => TxBuilder;\n    SpendingValidator: (spendingValidator: Script) => TxBuilder;\n    MintingPolicy: (mintingPolicy: Script) => TxBuilder;\n    CertificateValidator: (certValidator: Script) => TxBuilder;\n    WithdrawalValidator: (withdrawalValidator: Script) => TxBuilder;\n    VoteValidator: (voteValidator: Script) => TxBuilder;\n    ProposeValidator: (proposeValidator: Script) => TxBuilder;\n  };\n  compose: (tx: TxBuilder | null) => TxBuilder;\n  setMinFee: (fee: bigint) => TxBuilder;\n  complete: (\n    options?: CompleteTxBuilder.CompleteOptions,\n  ) => Promise<TxSignBuilder.TxSignBuilder>;\n  completeProgram: (\n    options?: CompleteTxBuilder.CompleteOptions,\n  ) => Effect.Effect<TxSignBuilder.TxSignBuilder, TransactionError>;\n  completeSafe: (\n    options?: CompleteTxBuilder.CompleteOptions,\n  ) => Promise<Either<TxSignBuilder.TxSignBuilder, TransactionError>>;\n  chainProgram: (\n    options?: CompleteTxBuilder.CompleteOptions,\n  ) => Effect.Effect<\n    [UTxO[], UTxO[], TxSignBuilder.TxSignBuilder],\n    TransactionError,\n    never\n  >;\n  chain: (\n    options?: CompleteTxBuilder.CompleteOptions,\n  ) => Promise<[UTxO[], UTxO[], TxSignBuilder.TxSignBuilder]>;\n  chainSafe: (\n    options?: CompleteTxBuilder.CompleteOptions,\n  ) => Promise<\n    Either<[UTxO[], UTxO[], TxSignBuilder.TxSignBuilder], TransactionError>\n  >;\n  /**\n   * **Warning:** This method executes all programs and mutates the TxBuilder state.\n   *\n   * Calling `.complete()` after executing this function will lead to unexpected behavior.\n   *\n   * It is recommended to call `.config()` only for debugging purposes\n   */\n  config: () => Promise<TxBuilderConfig>;\n  /**\n   * Returns the raw TxBuilderConfig\n   */\n  rawConfig: () => TxBuilderConfig;\n  /**\n   * Returns the current lucid instance configuration\n   */\n  lucidConfig: () => LucidConfig;\n  /**\n   * Returns the current txbuilder programs\n   */\n  getPrograms: () => Effect.Effect<void, TransactionError, TxConfig>[];\n};\n\nexport function makeTxBuilder(lucidConfig: LucidConfig): TxBuilder {\n  const config: TxBuilderConfig = {\n    lucidConfig: lucidConfig,\n    txBuilder: CML.TransactionBuilder.new(lucidConfig.txbuilderconfig),\n    walletInputs: [],\n    collectedInputs: [],\n    readInputs: [],\n    consumedInputs: [],\n    totalOutputAssets: {},\n    payToOutputs: [],\n    mintedAssets: {},\n    scripts: new Map(),\n    programs: [],\n    partialPrograms: new Map(),\n    minFee: undefined,\n  };\n  const configLayer = Layer.succeed(TxConfig, { config });\n  const txBuilder: TxBuilder = {\n    readFrom: (utxos: UTxO[]) => {\n      utxos.map((utxo) => {\n        if (utxo.scriptRef) {\n          const scriptKeyValue = Attach.attachScript(utxo.scriptRef);\n          config.scripts.set(scriptKeyValue.key, scriptKeyValue.value);\n        }\n      });\n      const program = Read.readFrom(utxos);\n      config.programs.push(program);\n      return txBuilder;\n    },\n    collectFrom: (utxos: UTxO[], redeemer?: string | RedeemerBuilder) => {\n      const program =\n        typeof redeemer === \"object\"\n          ? Collect.collectFromUTxOPartial(utxos, redeemer)\n          : Collect.collectFromUTxO(utxos)(redeemer);\n      config.programs.push(program);\n      return txBuilder;\n    },\n    pay: {\n      ToAddress: (address: string, assets: Assets) => {\n        const program = Pay.payToAddress(address, assets);\n        config.programs.push(program);\n        return txBuilder;\n      },\n      ToAddressWithData: (\n        address: string,\n        outputDatum?: OutputDatum,\n        assets?: Assets,\n        scriptRef?: Script | undefined,\n      ) => {\n        const program = Pay.ToAddressWithData(\n          address,\n          outputDatum,\n          assets,\n          scriptRef,\n        );\n        config.programs.push(program);\n        return txBuilder;\n      },\n      ToContract: (\n        address: string,\n        outputDatum?: OutputDatum,\n        assets?: Assets,\n        scriptRef?: Script | undefined,\n      ) => {\n        const program = Pay.ToContract(address, outputDatum, assets, scriptRef);\n        config.programs.push(program);\n        return txBuilder;\n      },\n    },\n    addSigner: (address: Address | RewardAddress) => {\n      const program = Signer.addSigner(address);\n      config.programs.push(program);\n      return txBuilder;\n    },\n    addSignerKey: (keyHash: PaymentKeyHash | StakeKeyHash) => {\n      const program = Signer.addSignerKey(keyHash);\n      config.programs.push(program);\n      return txBuilder;\n    },\n    registerStake: (rewardAddress: RewardAddress) => {\n      const program = Stake.registerStake(rewardAddress);\n      config.programs.push(program);\n      return txBuilder;\n    },\n    register: {\n      Stake: (rewardAddress: RewardAddress) => {\n        const program = Stake.registerStake(rewardAddress);\n        config.programs.push(program);\n        return txBuilder;\n      },\n      DRep: (\n        rewardAddress: RewardAddress,\n        anchor?: Anchor,\n        redeemer?: string,\n      ) => {\n        const program = Governance.registerDRep(\n          rewardAddress,\n          anchor,\n          redeemer,\n        );\n        config.programs.push(program);\n        return txBuilder;\n      },\n    },\n    deRegisterStake: (rewardAddress: RewardAddress, redeemer?: string) => {\n      const program = Stake.deRegisterStake(rewardAddress, redeemer);\n      config.programs.push(program);\n      return txBuilder;\n    },\n    deregister: {\n      Stake: (rewardAddress: RewardAddress, redeemer?: string) => {\n        const program = Stake.deRegisterStake(rewardAddress, redeemer);\n        config.programs.push(program);\n        return txBuilder;\n      },\n      DRep: (rewardAddress: RewardAddress, redeemer?: string) => {\n        const program = Governance.deregisterDRep(rewardAddress, redeemer);\n        config.programs.push(program);\n        return txBuilder;\n      },\n    },\n    withdraw: (\n      rewardAddress: RewardAddress,\n      amount: Lovelace,\n      redeemer?: string | RedeemerBuilder,\n    ) => {\n      const partialProgram = Stake.withdraw(rewardAddress, amount);\n      //TODO: improve function workflow\n      handleRedeemerBuilder(config, partialProgram, redeemer);\n      return txBuilder;\n    },\n    mintAssets: (assets: Assets, redeemer?: string | RedeemerBuilder) => {\n      config.mintedAssets = addAssets(config.mintedAssets, assets);\n      const partialProgram = Mint.mintAssets(assets);\n      //TODO: improve function workflow\n      handleRedeemerBuilder(config, partialProgram, redeemer);\n      return txBuilder;\n    },\n    validFrom: (unixTime: number) => {\n      const program = Interval.validFrom(unixTime);\n      config.programs.push(program);\n      return txBuilder;\n    },\n    validTo: (unixTime: number) => {\n      const program = Interval.validTo(unixTime);\n      config.programs.push(program);\n      return txBuilder;\n    },\n    delegateTo: (\n      rewardAddress: RewardAddress,\n      poolId: PoolId,\n      redeemer?: Redeemer,\n    ) => {\n      const program = Pool.delegateTo(rewardAddress, poolId, redeemer);\n      config.programs.push(program);\n      return txBuilder;\n    },\n    delegate: {\n      ToPool: (\n        rewardAddress: RewardAddress,\n        poolId: PoolId,\n        redeemer?: Redeemer,\n      ) => {\n        const program = Pool.delegateTo(rewardAddress, poolId, redeemer);\n        config.programs.push(program);\n        return txBuilder;\n      },\n\n      VoteToDRep: (\n        rewardAddress: RewardAddress,\n        drep: DRep,\n        redeemer?: Redeemer,\n      ) => {\n        const program = Governance.delegateVoteToDRep(\n          rewardAddress,\n          drep,\n          redeemer,\n        );\n        config.programs.push(program);\n        return txBuilder;\n      },\n\n      VoteToPoolAndDRep: (\n        rewardAddress: RewardAddress,\n        poolId: PoolId,\n        drep: DRep,\n        redeemer?: Redeemer,\n      ) => {\n        const program = Governance.delegateVoteToPoolAndDRep(\n          rewardAddress,\n          poolId,\n          drep,\n          redeemer,\n        );\n        config.programs.push(program);\n        return txBuilder;\n      },\n    },\n    registerAndDelegate: {\n      ToPool: (\n        rewardAddress: RewardAddress,\n        poolId: PoolId,\n        redeemer?: Redeemer,\n      ) => {\n        const program = Governance.registerAndDelegateToPool(\n          rewardAddress,\n          poolId,\n          redeemer,\n        );\n        config.programs.push(program);\n        return txBuilder;\n      },\n      ToDRep: (\n        rewardAddress: RewardAddress,\n        drep: DRep,\n        redeemer?: Redeemer,\n      ) => {\n        const program = Governance.registerAndDelegateToDRep(\n          rewardAddress,\n          drep,\n          redeemer,\n        );\n        config.programs.push(program);\n        return txBuilder;\n      },\n      ToPoolAndDRep: (\n        rewardAddress: RewardAddress,\n        poolId: PoolId,\n        drep: DRep,\n        redeemer?: Redeemer,\n      ) => {\n        const program = Governance.registerAndDelegateToPoolAndDRep(\n          rewardAddress,\n          poolId,\n          drep,\n          redeemer,\n        );\n        config.programs.push(program);\n        return txBuilder;\n      },\n    },\n    updateDRep: (\n      rewardAddress: RewardAddress,\n      anchor?: Anchor,\n      redeemer?: Redeemer,\n    ) => {\n      const program = Governance.updateDRep(rewardAddress, anchor, redeemer);\n      config.programs.push(program);\n      return txBuilder;\n    },\n    authCommitteeHot: (\n      coldAddress: RewardAddress,\n      hotAddress: RewardAddress,\n      redeemer?: Redeemer,\n    ) => {\n      const program = Governance.authCommitteeHot(\n        coldAddress,\n        hotAddress,\n        redeemer,\n      );\n      config.programs.push(program);\n      return txBuilder;\n    },\n    resignCommitteeHot: (\n      coldAddress: RewardAddress,\n      anchor?: Anchor,\n      redeemer?: Redeemer,\n    ) => {\n      const program = Governance.resignCommitteeHot(\n        coldAddress,\n        anchor,\n        redeemer,\n      );\n      config.programs.push(program);\n      return txBuilder;\n    },\n    attachMetadata: (label: Label, metadata: Metadata.TransactionMetadata) => {\n      const program = Metadata.attachMetadata(config, label, metadata);\n      config.programs.push(program);\n      return txBuilder;\n    },\n    attach: {\n      Script: (script: Script) => {\n        const scriptKeyValue = Attach.attachScript(script);\n        config.scripts.set(scriptKeyValue.key, scriptKeyValue.value);\n        return txBuilder;\n      },\n      SpendingValidator: (spendingValidator: Script) => {\n        const scriptKeyValue =\n          Attach.attachSpendingValidator(spendingValidator);\n        config.scripts.set(scriptKeyValue.key, scriptKeyValue.value);\n        return txBuilder;\n      },\n      MintingPolicy: (mintingPolicy: Script) => {\n        const scriptKeyValue = Attach.attachMintingPolicy(mintingPolicy);\n        config.scripts.set(scriptKeyValue.key, scriptKeyValue.value);\n        return txBuilder;\n      },\n      CertificateValidator: (certValidator: Script) => {\n        const scriptKeyValue = Attach.attachCertificateValidator(certValidator);\n        config.scripts.set(scriptKeyValue.key, scriptKeyValue.value);\n        return txBuilder;\n      },\n      WithdrawalValidator: (withdrawalValidator: Script) => {\n        const scriptKeyValue =\n          Attach.attachWithdrawalValidator(withdrawalValidator);\n        config.scripts.set(scriptKeyValue.key, scriptKeyValue.value);\n        return txBuilder;\n      },\n      VoteValidator: (voteValidator: Script) => {\n        const scriptKeyValue = Attach.attachVoteValidator(voteValidator);\n        config.scripts.set(scriptKeyValue.key, scriptKeyValue.value);\n        return txBuilder;\n      },\n      ProposeValidator: (proposeValidator: Script) => {\n        const scriptKeyValue = Attach.attachProposeValidator(proposeValidator);\n        config.scripts.set(scriptKeyValue.key, scriptKeyValue.value);\n        return txBuilder;\n      },\n    },\n    compose: (tx: TxBuilder | null) => {\n      if (tx) {\n        const rawConfig = tx.rawConfig();\n        config.programs = [...config.programs, ...tx.getPrograms()];\n        config.scripts = new Map([...config.scripts, ...rawConfig.scripts]);\n        config.mintedAssets = Object.entries({\n          ...config.mintedAssets,\n          ...rawConfig.mintedAssets,\n        }).reduce<Assets>((acc, [key, value]) => {\n          acc[key as Unit | \"lovelace\"] =\n            (config.mintedAssets[key as Unit | \"lovelace\"] || 0n) +\n            BigInt(value);\n          return acc;\n        }, {});\n      }\n      return txBuilder;\n    },\n    setMinFee: (fee: bigint) => {\n      config.minFee = fee;\n      return txBuilder;\n    },\n    complete: (options?: CompleteTxBuilder.CompleteOptions) =>\n      makeReturn(\n        pipe(\n          CompleteTxBuilder.complete(options),\n          Effect.provide(configLayer),\n          Effect.map((result) => result[2]),\n        ),\n      ).unsafeRun(),\n    completeProgram: (options?: CompleteTxBuilder.CompleteOptions) =>\n      pipe(\n        CompleteTxBuilder.complete(options),\n        Effect.provide(configLayer),\n        Effect.map((result) => result[2]),\n      ),\n    completeSafe: (options?: CompleteTxBuilder.CompleteOptions) =>\n      makeReturn(\n        pipe(\n          CompleteTxBuilder.complete(options),\n          Effect.provide(configLayer),\n          Effect.map((result) => result[2]),\n        ),\n      ).safeRun(),\n    chainProgram: (options?: CompleteTxBuilder.CompleteOptions) =>\n      pipe(CompleteTxBuilder.complete(options), Effect.provide(configLayer)),\n    chain: (options?: CompleteTxBuilder.CompleteOptions) =>\n      makeReturn(\n        pipe(CompleteTxBuilder.complete(options), Effect.provide(configLayer)),\n      ).unsafeRun(),\n    chainSafe: (options?: CompleteTxBuilder.CompleteOptions) =>\n      makeReturn(\n        pipe(CompleteTxBuilder.complete(options), Effect.provide(configLayer)),\n      ).safeRun(),\n    rawConfig: () => config,\n    config: () =>\n      pipe(\n        Effect.gen(function* () {\n          yield* Effect.all(config.programs);\n          return config;\n        }),\n        Effect.provide(configLayer),\n        Effect.runPromise,\n      ),\n    lucidConfig: () => config.lucidConfig,\n    getPrograms: () => config.programs,\n  };\n  return txBuilder;\n}\n","import { ProtocolParameters } from \"@lucid-evolution/core-types\";\nimport { CML } from \"../core.js\";\n\nexport const makeTxConfig = (\n  protocolParameters: ProtocolParameters,\n  costModels: CML.CostModels,\n): CML.TransactionBuilderConfig => {\n  const exUnitsPrices = CML.ExUnitPrices.new(\n    CML.Rational.new(\n      BigInt(protocolParameters.priceMem * 100_000_000),\n      100_000_000n,\n    ),\n    CML.Rational.new(\n      BigInt(protocolParameters.priceStep * 100_000_000),\n      100_000_000n,\n    ),\n  );\n  const txBuilderConfig = CML.TransactionBuilderConfigBuilder.new()\n    .fee_algo(\n      CML.LinearFee.new(\n        BigInt(protocolParameters.minFeeA),\n        BigInt(protocolParameters.minFeeB),\n        BigInt(protocolParameters.minFeeRefScriptCostPerByte),\n      ),\n    )\n    .coins_per_utxo_byte(protocolParameters.coinsPerUtxoByte)\n    .pool_deposit(protocolParameters.poolDeposit)\n    .key_deposit(protocolParameters.keyDeposit)\n    .max_value_size(protocolParameters.maxValSize)\n    .max_tx_size(protocolParameters.maxTxSize)\n    .ex_unit_prices(exUnitsPrices)\n    .collateral_percentage(protocolParameters.collateralPercentage)\n    .max_collateral_inputs(protocolParameters.maxCollateralInputs)\n    .cost_models(costModels)\n    .collateral_percentage(protocolParameters.collateralPercentage)\n    .max_collateral_inputs(protocolParameters.maxCollateralInputs)\n    .build();\n\n  return txBuilderConfig;\n};\n","export * from \"./lucid-evolution/index.js\";\nexport * from \"./tx-builder/index.js\";\nexport * from \"./tx-sign-builder/index.js\";\nexport * from \"./tx-submit/TxSubmit.js\";\nexport * from \"./Errors.js\";\nexport * from \"./core.js\";\nexport * from \"@lucid-evolution/core-types\";\nexport * from \"@lucid-evolution/core-utils\";\nexport * from \"@lucid-evolution/plutus\";\nexport * from \"@lucid-evolution/provider\";\nexport * from \"@lucid-evolution/sign_data\";\nexport * from \"@lucid-evolution/utils\";\nexport * from \"@lucid-evolution/wallet\";\n"],"names":["unixTimeToSlot","Effect","pipe","Data","Data","CML","CML","Effect","Effect","Effect","Effect","pipe","Data","Effect","utxoToCore","Effect","utxoToCore","Effect","Effect","Effect","pipe","CML","Effect","mintAssets","pipe","Effect","Effect","Effect","pipe","CML","Effect","pipe","Effect","pipe","CML","Effect","pipe","config","Effect","pipe","CML","Effect","pipe","CML","Effect","Effect","Effect","Effect","Effect","pipe","Record","S","Effect","pipe","Effect","S","Effect","Effect","pipe","pipe","Effect","wallet","privateKey","witness","Effect","pipe","assetsToValue","coreToTxOutput","utxoToCore","Effect","pipe","utxoToCore","Record","assetsToValue","coreToTxOutput","Effect","pipe","addAssets","addAssets","pipe","Effect","SLOT_CONFIG_NETWORK","Effect","pipe","Effect","pipe","SLOT_CONFIG_NETWORK","provider","costModels","network","protocolParameters","options","unixTimeToSlot"],"mappings":"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"}}]
}